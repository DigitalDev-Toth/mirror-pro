/*
   2015 Toth Limitada
 @license     {@link http://www.toth.cl}
*/
var UI={desktop:'<div class="container-fluid" style="margin: 0px; padding: 0px;"><div class="row" style="margin: 0px; padding: 0px;"><div id="mirror" class="col-xs-12" style="margin: 0px; padding: 0px;"></div></div></div><div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content" style="background: #424242; color: #FFF;"><div class="modal-header" style="border-bottom: 1px solid #F69322;"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="label_title_modal"></h4></div><div class="modal-body"><div id="content_modal"></div></div></div></div></div>',
landscape:'<div class="container-fluid" style="margin: 0px; padding: 0px;"><div class="row" style="margin: 0px; padding: 0px;"><div id="mirror" class="col-xs-12" style="margin: 0px; padding: 0px;"></div></div></div><div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content" style="background: #424242; color: #FFF;"><div class="modal-header" style="border-bottom: 1px solid #F69322;"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="label_title_modal"></h4></div><div class="modal-body"><div id="content_modal"></div></div></div></div></div>',
portrait:'<div class="container-fluid" style="margin: 0px; padding: 0px;"><div class="row" style="margin: 0px; padding: 0px;"><div id="copyright" style="background: #F69322; width: 100%; height: 20px; text-align: right; color: #FFF;">Toth Limitada <span id="copyright_year"></span> &copy; Mirror Est\u00e1ndar ['+LANGUAGE.mirror.version+' <span id="version"></span>]</div><div id="mirror" class="col-xs-12" style="margin: 0px; padding: 0px; border-left: 3px solid #F69322; border-right: 3px solid #F69322; border-bottom: 3px solid #F69322;"></div></div></div><div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content" style="background: #424242; color: #FFF;"><div class="modal-header" style="border-bottom: 1px solid #F69322;"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="label_title_modal"></h4></div><div class="modal-body"><div id="content_modal"></div></div></div></div></div>',
toolsbar_desktop:'<div id="toolsbar_desktop" class="col-xs-1" style="background: #4C4C4C; height: '+$(window).height()+'px; border-left: 3px solid #F69322; border-bottom: 3px solid #F69322; margin: 0px; padding: 0px;"><div style="background: #F69322; width: 100%; height: 20px; text-align: center; color: #FFF; font-weight: bold;">Herramientas</div><div id="buttons_toolsbar" style="width: 100%; padding: 12px; padding-top: 5px; text-align: center;"></div><div id="series_toolsbar" style="position: relative; width: 100%; display: block; overflow-y: auto; overflow-x: hidden; text-align: center; margin: 0px; padding: 0px; padding-left: 4px; padding-right: 4px;"></div></div>',
toolsbar_landscape:'<div id="toolsbar_landscape" class="col-xs-1" style="background: #4C4C4C; height: '+$(window).height()+'px; border-left: 3px solid #F69322; border-bottom: 3px solid #F69322; margin: 0px; padding: 0px;"><div style="background: #F69322; width: 100%; height: 20px; text-align: center; color: #FFF; font-weight: bold;"></div><div id="buttons_toolsbar" style="width: 100%; padding-top: 5px; padding-bottom: 5px; text-align: center;"></div></div>',toolsbar_portrait:'<div id="toolsbar_portrait" class="col-xs-12" style="background: #4C4C4C; margin: 0px; padding: 0px;"><div id="buttons_toolsbar" style="width: 100%; padding: 5px; text-align: left;"></div></div>',
workspace_desktop:'<div class="col-xs-10" style="background: #6C6C6C; height: '+$(window).height()+'px; border-bottom: 3px solid #F69322; margin: 0px; padding: 0px;"><div style="background: #F69322; width: 100%; height: 20px; text-align: right; color: #FFF;">Toth Limitada <span id="copyright_year"></span> &copy; Mirror Est\u00e1ndar ['+LANGUAGE.mirror.version+' <span id="version"></span>]</div><div id="workspace" style="background: #6C6C6C; width: 100%; height: '+($(window).height()-42)+'px; margin: 0px; padding: 4px;"></div><div style="background: #4C4C4C; display: table; width: 101%; height: 20px; color: #FFF; font-size: 8pt; margin: 0px; padding: 0px;"><div id="general_information" style="display: table-cell; vertical-align: middle; padding-left: 20px;"></div></div></div>',
workspace_landscape:'<div class="col-xs-10" style="background: #6C6C6C; height: '+$(window).height()+'px; border-bottom: 3px solid #F69322; margin: 0px; padding: 0px;"><div style="background: #F69322; width: 100%; height: 20px; text-align: right; color: #FFF;">Toth Limitada <span id="copyright_year"></span> &copy; Mirror Est\u00e1ndar ['+LANGUAGE.mirror.version+' <span id="version"></span>]</div><div id="workspace" style="background: #6C6C6C; width: 100%; height: '+($(window).height()-43)+'px; margin: 0px; padding: 4px;"></div><div style="background: #4C4C4C; display: table; width: 101%; height: 20px; color: #FFF; font-size: 8pt; margin: 0px; padding: 0px;"><div id="general_information" style="display: table-cell; vertical-align: middle; padding-left: 20px;"></div></div></div>',
workspace_portrait:'<div class="col-xs-12" style="background: #6C6C6C; margin: 0px; padding: 0px;"><div id="workspace" style="background: #6C6C6C; width: 100%; margin: 0px; padding: 4px;"></div></div>',navigator_desktop:'<div id="navigator_desktop" class="col-xs-1" style="background: #4C4C4C; height: '+$(window).height()+'px; margin: 0px; padding: 4px; border-top: 20px solid #F69322; border-right: 3px solid #F69322; border-bottom: 3px solid #F69322;"></div>',navigator_landscape:'<div id="navigator_landscape" class="col-xs-1" style="background: #4C4C4C; height: '+
$(window).height()+'px; margin: 0px; padding: 4px; border-top: 20px solid #F69322; border-right: 3px solid #F69322; border-bottom: 3px solid #F69322;"></div>',navigator_portrait:'<div id="navigator_portrait" class="col-xs-12" style="background: #4C4C4C; height: 50px; margin: 0px; padding: 4px;"></div>',void_layer:'<div style="background: #616161; width: 100%; height: 100%; display: table; -webkit-user-select: none; -moz-user-select: -moz-none; -ms-user-select: none; user-select: none;"><div style="display: table-cell; vertical-align: middle; text-align: center; -webkit-user-select: none; -moz-user-select: -moz-none; -ms-user-select: none; user-select: none;"><span style="cursor: default; font-family: Oswald, sans-serif; font-size: 20pt; -webkit-user-select: none; -moz-user-select: -moz-none; -ms-user-select: none; user-select: none;">'+
LANGUAGE.workspace.void_layer+"</span></div></div>",layers_1:'<div id="layer_1" class="col-xs-12" style="position: relative; overflow: hidden; height: '+($(window).height()-51)+'px; margin: 0px; padding: 0px; border: 3px solid #FCBE39;"></div>',layers_2:'<div id="layer_1" class="col-xs-6" style="position: relative; overflow: hidden; height: '+($(window).height()-51)+'px; margin: 0px; padding: 0px; border: 3px solid #6C6C6C;"></div><div id="layer_2" class="col-xs-6" style="position: relative; overflow: hidden; height: '+
($(window).height()-51)+'px; margin: 0px; padding: 0px; border: 3px solid #6C6C6C;"></div>',layers_3:'<div class="col-xs-6" style="margin: 0px; padding: 0px;"><div id="layer_1" class="col-xs-12" style="position: relative; overflow: hidden; height: '+($(window).height()-51)/2+'px; margin: 0px; padding: 0px; border: 3px solid #6C6C6C;"></div><div id="layer_2" class="col-xs-12" style="position: relative; overflow: hidden; height: '+($(window).height()-51)/2+'px; margin: 0px; padding: 0px; border: 3px solid #6C6C6C;"></div></div><div id="layer_3" class="col-xs-6" style="position: relative; overflow: hidden; height: '+
($(window).height()-51)+'px; margin: 0px; padding: 0px; border: 3px solid #6C6C6C;"></div>',layers_4:'<div id="layer_1" class="col-xs-6" style="position: relative; overflow: hidden; height: '+($(window).height()-51)/2+'px; margin: 0px; padding: 0px; border: 3px solid #6C6C6C;"></div><div id="layer_2" class="col-xs-6" style="position: relative; overflow: hidden; height: '+($(window).height()-51)/2+'px; margin: 0px; padding: 0px; border: 3px solid #6C6C6C;"></div><div id="layer_3" class="col-xs-6" style="position: relative; overflow: hidden; height: '+
($(window).height()-51)/2+'px; margin: 0px; padding: 0px; border: 3px solid #6C6C6C;"></div><div id="layer_4" class="col-xs-6" style="position: relative; overflow: hidden; height: '+($(window).height()-51)/2+'px; margin: 0px; padding: 0px; border: 3px solid #6C6C6C;"></div>'};/*
   2015 Toth Limitada
 @license     {@link http://www.toth.cl}
*/
var FILTER={shader_fragment_windowLevel:"precision lowp float; varying vec2 vTextureCoord; uniform sampler2D uSampler; uniform highp float uLowerBound; uniform highp float uUpperBound; uniform highp float uNegative; uniform highp float uBrightness; uniform highp float uContrast; void main (void) { vec4 pixelColor = texture2D (uSampler, vTextureCoord); highp float localizer = 0.0; if (pixelColor.g == 1.0) { if (pixelColor.r == 0.0 && pixelColor.b == 0.0) { localizer = 1.0; } } if (localizer == 0.0) {highp float intensity = pixelColor.r * (uUpperBound - uLowerBound) + uLowerBound; highp float windowCenter = (1.0 - uBrightness / 1.0) * (255.0) + 0.0; highp float windowWidth = (1.0 - uContrast / 1.0) * (255.0); highp float lowerBound = windowWidth * (-0.5) + windowCenter; highp float upperBound = windowWidth * (0.5) + windowCenter; highp float rgb = (intensity - lowerBound) / (upperBound - lowerBound); pixelColor.r = rgb; pixelColor.g = rgb; pixelColor.b = rgb; if (pixelColor.r > 1.0) { pixelColor.r = 1.0; } else if(pixelColor.r < 0.0) { pixelColor.r = 0.0; } if (pixelColor.g > 1.0) { pixelColor.g = 1.0; } else if (pixelColor.g < 0.0) { pixelColor.g = 0.0; } if (pixelColor.b > 1.0) { pixelColor.b = 1.0; } else if (pixelColor.b < 0.0) { pixelColor.b = 0.0; } } if (uNegative > 0.0) { pixelColor.r = 1.0 - pixelColor.r; pixelColor.g = 1.0 - pixelColor.g; pixelColor.b = 1.0 - pixelColor.b; } gl_FragColor = pixelColor; }",
shader_fragment_brightnessContrast:"precision lowp float; varying vec2 vTextureCoord; uniform sampler2D uSampler; uniform highp float uNegative; uniform highp float uMultiplier; uniform highp float uAdder; void main (void) { vec4 pixelColor = texture2D (uSampler, vTextureCoord); highp float localizer = 0.0; if (pixelColor.g == 1.0) { if (pixelColor.r == 0.0 && pixelColor.b == 0.0) { localizer = 1.0; } } if (localizer == 0.0) {pixelColor.r = pixelColor.r * uMultiplier + uAdder; pixelColor.g = pixelColor.g * uMultiplier + uAdder; pixelColor.b = pixelColor.b * uMultiplier + uAdder; if (pixelColor.r > 1.0) { pixelColor.r = 1.0; } else if(pixelColor.r < 0.0) { pixelColor.r = 0.0; } if (pixelColor.g > 1.0) { pixelColor.g = 1.0; } else if (pixelColor.g < 0.0) { pixelColor.g = 0.0; } if (pixelColor.b > 1.0) { pixelColor.b = 1.0; } else if (pixelColor.b < 0.0) { pixelColor.b = 0.0; } } if (uNegative > 0.0) { pixelColor.r = 1.0 - pixelColor.r; pixelColor.g = 1.0 - pixelColor.g; pixelColor.b = 1.0 - pixelColor.b; } gl_FragColor = pixelColor; }"};/*
   2015 Toth Limitada
 @license     {@link http://www.toth.cl}
*/
var MIRROR=MIRROR||{};MIRROR.version="2.0.4";MIRROR.releaseDate="2015-07-29";MIRROR.copyrightDate=(new Date).getFullYear();MIRROR.language=LANGUAGE;MIRROR.ui=UI;MIRROR.filter=FILTER;
MIRROR.maker=function(a){this.studyId=a;this.layers={};this.orientation=this.browser=this.device=this.environment=this.renderType=this.load=null;this.buttons={};this.isPhone=!1;this.resizeStart=0;this.maxTotalLayers=4;this.totalLayers=1;this.imitationLayers=!1;this.thumbnails=[];this.reportsState=this.mailState=this.hounsfieldState=this.measuringAreaState=this.measuringAngleState=this.measuringSegmentState=this.measuringState=this.filmModeState=this.negativeState=this.magnifyingGlassState=this.windowLevelPresetsLungsState=
this.windowLevelPresetsChestState=this.windowLevelPresetsBrainState=this.windowLevelPresetsAngioState=this.windowLevelPresetsAbdomenState=this.windowLevelPresetsBoneState=this.windowLevelPresetsDefaultState=this.windowLevelPresetsState=this.rotationState=this.thumbnailsSeriesState=this.layersStatus=!1;this.loadingStudyCounterMobile=0;this.measuringTool="segment";this.infoState=!0;this.hammerManager=this.modalContent=this.submenuContent=null};
MIRROR.layer=function(a,b){this.make=a;this.layerId=b;this.height=this.width=0;this.resizeEnd=!0;this.leadImitation=this.selected=this.displayed=!1;this.serieIdCharged=null;this.positionInSerie=0;this.layerInformation=this.dicomInformation=this.localizer=this.textureSprite=this.pivotSprite=this.transformationSprite=this.filterSprite=this.container=this.renderer=this.stage=this.renderer=null;this.eventWhich=0;this.globalDown={x:0,y:0};this.localDown={x:0,y:0};this.localDownTexture={x:0,y:0};this.globalMove=
{x:0,y:0};this.transformations=[];this.transformated=!1;this.scale=this.lastResponsiveScale=this.lastScale=1;this.ratio=0;this.lastRatioAccumulated=this.ratioAccumulated=1;this.diffZoom={x:0,y:0};this.pan={x:0,y:0};this.diffPan={x:0,y:0};this.rotate=this.rotation=0;this.diffRotation={x:0,y:0};this.deltaFilter={x:1,y:1};this.brightness=1;this.diffBrightness=0;this.contrastCSS=this.brightnessCSS=this.contrast=1;this.negativeCSS=0;this.hounsfield=this.measuring=this.windowCenter=this.windowWidth=null;
this.lastY=0;this.filmInterval=this.hammerManager=null};MIRROR.loader=function(a,b){this.make=a;this.studyId=b;this.studyDescription=null;this.studyCharged=!1;this.totalSeriesCharged=this.totalSeries=0;this.blockAttachSerieMobile=!1;this.series={};this.intervalChargeSerie=null;this.charging=!1;this.tailCharging=[]};
MIRROR.serie=function(a,b,c,d,e,g,f,h,k,n,l,m,p,r,q,t,u,v,w,x,y,z,A){this.load=a;this.serieId=b;this.pixelSpacing=void 0===c||""===c||null===c?null:parseFloat(c);this.windowWidth=void 0===d||""===d||null===d?null:parseFloat(d);this.windowCenter=void 0===e||""===e||null===e?null:parseFloat(e);this.rescaleSlope=void 0===g||""===g||null===g?null:parseFloat(g);this.rescaleIntercept=void 0===f||""===f||null===f?null:parseFloat(f);this.lowerBound=null!==this.windowWidth&&null!==this.windowCenter?-.5*this.windowWidth+
this.windowCenter:null;this.upperBound=null!==this.windowWidth&&null!==this.windowCenter?.5*this.windowWidth+this.windowCenter:null;this.dimensions=void 0===h||""===h||null===h||0===h.length?null:h;this.reports=void 0===k||""===k||null===k?null:k;this.patientName=void 0===n||""===n||null===n?null:n;this.patientRut=void 0===l||""===l||null===l?null:l;this.patientSex=void 0===m||""===m||null===m?null:m;this.serieName=void 0===p||""===p||null===p?null:p;this.institution=void 0===r||""===r||null===r?
null:r;this.serieBodyPart=void 0===q||""===q||null===q?null:q;this.serieDescription=void 0===t||""===t||null===t?null:t;this.modality=void 0===u||""===u||null===u?null:u;this.sliceThickness=void 0===v||""===v||null===v?null:parseFloat(v);this.frameOfReferenceUID=void 0===w||""===w||null===w?null:w;this.totalElements=void 0===x||""===x||null===x?null:x;this.bitsStored=void 0===y||""===y||null===y?null:parseInt(y);this.numberOfFrames=void 0===z||""===z||null===z?null:parseInt(z);this.frameTime=void 0===
A||""===A||null===A?null:parseFloat(A);this.imageOrientationPatient=[];this.normalVector={};this.imagePositionPatient=[];this.spaceBetweenSlices=this.imagePositionPatientDirection=this.orientationPlane=null;this.slicePosition=[];this.serie=[];this.imagesURL=[];this.dicomsPath=[];this.imagesFrame=[];this.chargedWithError=this.charged=this.charging=!1;this.multiplierPaddingNavigatorBar=this.totalChargingWithError=this.totalCharging=0;this.allSameDimensions=!1};
MIRROR.measuring=function(a){this.layer=a;this.canvas=document.createElement("canvas");this.canvas.setAttribute("id","canvas_measuring_"+this.layer.layerId);this.canvas.width=this.layer.renderer.width;this.canvas.height=this.layer.renderer.height;this.canvas.style.zIndex=100;this.canvas.style.position="absolute";this.canvas.style.left="0px";this.canvas.style.top="0px";this.context=this.canvas.getContext("2d");this.shape=function(){this.points=[];this.done=!1;this.calcule=0;this.type=null;this.making=
!1};this.shapes=[];this.down=this.point=!1};MIRROR.hounsfield=function(a){this.layer=a;this.TOOL={NONE:0,POINT:1,ELIPSE:2,POLYGON:3};this.selectedTool=this.TOOL.NONE;this.shapes=[];this.selectedPoint=this.currentShape=null;this.initialize()};/*
   2015 Toth Limitada
 @license     {@link http://www.toth.cl}
*/
MIRROR.maker.prototype.init=function(){PIXI.utils._saidHello=!0;this.__globalConfiguration()};MIRROR.maker.prototype.__globalConfiguration=function(){this.__detectBrowser();this.__detectRenderType();this.__detectDevice();this.__detectOrientation();this.__loadButtons();this.__choiceEnvironment();this.__globalEventsHandler();this.__loadStudy();this.__setLayers();this.__rendering()};
MIRROR.maker.prototype.__detectRenderType=function(){var a=PIXI.autoDetectRenderer();"msie"===this.browser&&$("#renderers").append(a.view);1===a.type?this.renderType="webgl":2===a.type&&(this.renderType="canvas2d")};MIRROR.maker.prototype.__detectDevice=function(){var a=navigator.userAgent.match(/Android/i),b=navigator.userAgent.match(/iPhone|iPad|iPod/i);this.device=null!==a?"android":null!==b?"apple":"desktop"};
MIRROR.maker.prototype.__detectBrowser=function(){-1!==navigator.userAgent.indexOf("Firefox")?this.browser="firefox":-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("rv:11")?this.browser="msie":-1!==navigator.userAgent.indexOf("Chrome")&&(this.browser="chrome")};
MIRROR.maker.prototype.__detectOrientation=function(){"desktop"!==this.device&&null!==this.device&&($(window).width()>$(window).height()?(this.orientation="landscape",800>$(window).width()&&(this.isPhone=!0)):(this.orientation="portrait",800>$(window).height()&&(this.isPhone=!0)))};
MIRROR.maker.prototype.__loadButtons=function(){var a={width:"35px",height:"35px"},b={width:"50px",height:"50px"};this.buttons.abdomen={active:$('<img id="button_window_level_presets_abdomen" src="../img/abdomen_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),inactive:$('<img id="button_window_level_presets_abdomen" src="../img/abdomen_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),disable:$('<img id="button_window_level_presets_abdomen" src="../img/abdomen_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),
where:"submenu"};this.buttons.angio={active:$('<img id="button_window_level_presets_angio" src="../img/angio_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),inactive:$('<img id="button_window_level_presets_angio" src="../img/angio_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),disable:$('<img id="button_window_level_presets_angio" src="../img/angio_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),where:"submenu"};this.buttons.angle=
{active:$('<img id="button_measuring_angle" src="../img/angle_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),inactive:$('<img id="button_measuring_angle" src="../img/angle_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),disable:$('<img id="button_measuring_angle" src="../img/angle_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),where:"submenu"};this.buttons.area={active:$('<img id="button_measuring_area" src="../img/area_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),
inactive:$('<img id="button_measuring_area" src="../img/area_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),disable:$('<img id="button_measuring_area" src="../img/area_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),where:"submenu"};this.buttons.bone={active:$('<img id="button_window_level_presets_bone" src="../img/bone_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),inactive:$('<img id="button_window_level_presets_bone" src="../img/bone_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),
disable:$('<img id="button_window_level_presets_bone" src="../img/bone_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),where:"submenu"};this.buttons.brain={active:$('<img id="button_window_level_presets_brain" src="../img/brain_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),inactive:$('<img id="button_window_level_presets_brain" src="../img/brain_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),disable:$('<img id="button_window_level_presets_brain" src="../img/brain_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),
where:"submenu"};this.buttons.chest={active:$('<img id="button_window_level_presets_chest" src="../img/chest_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),inactive:$('<img id="button_window_level_presets_chest" src="../img/chest_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),disable:$('<img id="button_window_level_presets_chest" src="../img/chest_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),where:"submenu"};this.buttons.close=
{active:$('<img id="button_close" src="../img/close_active.png" class="toolBar" style="cursor: pointer;" />').css(a),inactive:$('<img id="button_close" src="../img/close_inactive.png" class="toolBar" style="cursor: pointer;" />').css(a),disable:$('<img id="button_close" src="../img/close_disable.png" class="toolBar" style="cursor: pointer;" />').css(a),where:"bar"};this.buttons["default"]={active:$('<img id="button_window_level_presets_default" src="../img/default_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),
inactive:$('<img id="button_window_level_presets_default" src="../img/default_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),disable:$('<img id="button_window_level_presets_default" src="../img/default_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),where:"submenu"};this.buttons.ellipse={active:$('<img id="button_hounsfield_ellipse" src="../img/ellipse_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),inactive:$('<img id="button_hounsfield_ellipse" src="../img/ellipse_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),
disable:$('<img id="button_hounsfield_ellipse" src="../img/ellipse_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),where:"submenu"};this.buttons.email={active:$('<img id="button_email" src="../img/email_active.png" class="toolBar" style="cursor: pointer;" data-toggle="modal" data-target="#modal" />').css(a),inactive:$('<img id="button_email" src="../img/email_inactive.png" class="toolBar" style="cursor: pointer;" data-toggle="modal" data-target="#modal" />').css(a),disable:$('<img id="button_email" src="../img/email_disable.png" class="toolBar" style="cursor: pointer;" />').css(a),
where:"bar"};this.buttons.film_mode={active:$('<img id="button_film_mode" src="../img/film_mode_active.png" class="toolBar" style="cursor: pointer;" />').css(a),inactive:$('<img id="button_film_mode" src="../img/film_mode_inactive.png" class="toolBar" style="cursor: pointer;" />').css(a),disable:$('<img id="button_film_mode" src="../img/film_mode_disable.png" class="toolBar" style="cursor: pointer;" />').css(a),where:"bar"};this.buttons.hu={active:$('<img id="button_hounsfield" src="../img/hu_active.png" class="toolBar" style="cursor: pointer;" />').css(a),
inactive:$('<img id="button_hounsfield" src="../img/hu_inactive.png" class="toolBar" style="cursor: pointer;" />').css(a),disable:$('<img id="button_hounsfield" src="../img/hu_disable.png" class="toolBar" style="cursor: pointer;" />').css(a),where:"bar"};this.buttons.imitation={active:$('<img id="button_imitation" src="../img/imitation_active.png" class="toolBar" style="cursor: pointer;" />').css(a),inactive:$('<img id="button_imitation" src="../img/imitation_inactive.png" class="toolBar" style="cursor: pointer;" />').css(a),
disable:$('<img id="button_imitation" src="../img/imitation_disable.png" class="toolBar" style="cursor: pointer;" />').css(a),where:"bar"};this.buttons.layers_1={active:$('<img id="button_layers_1" src="../img/layers_1_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),inactive:$('<img id="button_layers_1" src="../img/layers_1_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),disable:$('<img id="button_layers_1" src="../img/layers_1_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),
where:"submenu"};this.buttons.layers_2={active:$('<img id="button_layers_2" src="../img/layers_2_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),inactive:$('<img id="button_layers_2" src="../img/layers_2_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),disable:$('<img id="button_layers_2" src="../img/layers_2_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),where:"submenu"};this.buttons.layers_3={active:$('<img id="button_layers_3" src="../img/layers_3_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),
inactive:$('<img id="button_layers_3" src="../img/layers_3_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),disable:$('<img id="button_layers_3" src="../img/layers_3_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),where:"submenu"};this.buttons.layers_4={active:$('<img id="button_layers_4" src="../img/layers_4_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),inactive:$('<img id="button_layers_4" src="../img/layers_4_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),
disable:$('<img id="button_layers_4" src="../img/layers_4_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),where:"submenu"};this.buttons.layers={active:$('<img id="button_layers" src="../img/layers_active.png" class="toolBar" style="cursor: pointer;" />').css(a),inactive:$('<img id="button_layers" src="../img/layers_inactive.png" class="toolBar" style="cursor: pointer;" />').css(a),disable:$('<img id="button_layers" src="../img/layers_disable.png" class="toolBar" style="cursor: pointer;" />').css(a),
where:"bar"};this.buttons.lungs={active:$('<img id="button_window_level_presets_lungs" src="../img/lungs_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),inactive:$('<img id="button_window_level_presets_lungs" src="../img/lungs_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),disable:$('<img id="button_window_level_presets_lungs" src="../img/lungs_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),where:"submenu"};this.buttons.magnifying_glass=
{active:$('<img id="button_magnifying_glass" src="../img/magnifying_glass_active.png" class="toolBar" style="cursor: pointer;" />').css(a),inactive:$('<img id="button_magnifying_glass" src="../img/magnifying_glass_inactive.png" class="toolBar" style="cursor: pointer;" />').css(a),disable:$('<img id="button_magnifying_glass" src="../img/magnifying_glass_disable.png" class="toolBar" style="cursor: pointer;" />').css(a),where:"bar"};this.buttons.measuring={active:$('<img id="button_measuring" src="../img/measuring_active.png" class="toolBar" style="cursor: pointer;" />').css(a),
inactive:$('<img id="button_measuring" src="../img/measuring_inactive.png" class="toolBar" style="cursor: pointer;" />').css(a),disable:$('<img id="button_measuring" src="../img/measuring_disable.png" class="toolBar" style="cursor: pointer;" />').css(a),where:"bar"};this.buttons.negative={active:$('<img id="button_negative" src="../img/negative_active.png" class="toolBar" style="cursor: pointer;" />').css(a),inactive:$('<img id="button_negative" src="../img/negative_inactive.png" class="toolBar" style="cursor: pointer;" />').css(a),
disable:$('<img id="button_negative" src="../img/negative_disable.png" class="toolBar" style="cursor: pointer;" />').css(a),where:"bar"};this.buttons.point={active:$('<img id="button_hounsfield_point" src="../img/point_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),inactive:$('<img id="button_hounsfield_point" src="../img/point_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),disable:$('<img id="button_hounsfield_point" src="../img/point_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),
where:"submenu"};this.buttons.polygon={active:$('<img id="button_hounsfield_polygon" src="../img/polygon_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),inactive:$('<img id="button_hounsfield_polygon" src="../img/polygon_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),disable:$('<img id="button_hounsfield_polygon" src="../img/polygon_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),where:"submenu"};this.buttons.presets={active:$('<img id="button_window_level_presets" src="../img/presets_active.png" class="toolBar" style="cursor: pointer;" />').css(a),
inactive:$('<img id="button_window_level_presets" src="../img/presets_inactive.png" class="toolBar" style="cursor: pointer;" />').css(a),disable:$('<img id="button_window_level_presets" src="../img/presets_disable.png" class="toolBar" style="cursor: pointer;" />').css(a),where:"bar"};this.buttons.reports={active:$('<img id="button_reports" src="../img/reports_active.png" class="toolBar" style="cursor: pointer;" data-toggle="modal" data-target="#modal" />').css(a),inactive:$('<img id="button_reports" src="../img/reports_inactive.png" class="toolBar" style="cursor: pointer;" data-toggle="modal" data-target="#modal" />').css(a),
disable:$('<img id="button_reports" src="../img/reports_disable.png" class="toolBar" style="cursor: pointer;" />').css(a),where:"bar"};this.buttons.reset={active:$('<img id="button_reset" src="../img/reset_active.png" class="toolBar" style="cursor: pointer;" />').css(a),inactive:$('<img id="button_reset" src="../img/reset_inactive.png" class="toolBar" style="cursor: pointer;" />').css(a),disable:$('<img id="button_reset" src="../img/reset_disable.png" class="toolBar" style="cursor: pointer;" />').css(a),
where:"bar"};this.buttons.rotation={active:$('<img id="button_rotation" src="../img/rotation_active.png" class="toolBar" style="cursor: pointer;" />').css(a),inactive:$('<img id="button_rotation" src="../img/rotation_inactive.png" class="toolBar" style="cursor: pointer;" />').css(a),disable:$('<img id="button_rotation" src="../img/rotation_disable.png" class="toolBar" style="cursor: pointer;" />').css(a),where:"bar"};this.buttons.segment={active:$('<img id="button_measuring_segment" src="../img/segment_active.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),
inactive:$('<img id="button_measuring_segment" src="../img/segment_inactive.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),disable:$('<img id="button_measuring_segment" src="../img/segment_disable.png" class="toolSubmenu" style="cursor: pointer;" />').css(b),where:"submenu"};this.buttons.series={active:$('<img id="button_thumbnails_series" src="../img/series_active.png" class="toolBar" style="cursor: pointer;" />').css(a),inactive:$('<img id="button_thumbnails_series" src="../img/series_inactive.png" class="toolBar" style="cursor: pointer;" />').css(a),
disable:$('<img id="button_thumbnails_series" src="../img/series_disable.png" class="toolBar" style="cursor: pointer;" />').css(a),where:"bar"}};MIRROR.maker.prototype.__choiceEnvironment=function(){"desktop"===this.device?this.environment="desktop":"landscape"===this.orientation?this.environment="landscape":"portrait"===this.orientation&&(this.environment="portrait");this.__updateDOM()};
MIRROR.maker.prototype.__globalEventsHandler=function(){var a=this;$(window).on("contextmenu",function(a){a.preventDefault();return!1}).on("resize",function(){a.resizeStart++;for(var b in a.layers)a.layers[b].resizeEnd=!1;"desktop"!==a.device&&null!==a.device?(a.isPhone=!1,a.__detectOrientation(),a.__choiceEnvironment(),a.__orientationChangeLayers(),a.layersState&&a.__actions("button_layers"),a.measuringState&&a.__actions("button_measuring"),a.hounsfieldState&&a.__actions("button_measuring"),a.isPhone||
a.globalInformation()):"desktop"===a.device&&(a.__responsiveSystem(),a.layersState&&a.__actions("button_layers"),a.magnifyingGlassState&&a.__actions("button_magnifying_glass"),a.measuringState&&a.__actions("button_measuring"),a.hounsfieldState&&a.__actions("button_measuring"))}).on("resizeEnd",function(){a.resizeStart=0;for(var b in a.layers)a.layers[b].resizeEnd=!0;a.__responsiveSystem()}).on("dblclick",function(b){"desktop"===a.environment&&a.__eventDoubleClicks(b)}).on("click",function(b){"desktop"===
a.environment&&a.__eventClicks(b)}).on("mousedown",function(b){"desktop"===a.environment&&a.__eventMouseDown(b)}).on("mouseup",function(){$(this).unbind("mousemove")}).on("keydown",function(b){switch(b.keyCode){case 16:b.altKey||a.__actions("button_magnifying_glass");break;case 87:a.__actions("button_rotation");break;case 73:a.__actions("button_imitation");break;case 70:a.__actions("button_film_mode");break;case 78:a.__actions("button_negative");break;case 77:a.__actions("button_measuring");break;
case 83:a.__actions("button_measuring_segment");break;case 65:a.__actions("button_measuring_angle");break;case 90:a.__actions("button_measuring_area");break;case 72:a.__actions("button_hounsfield");break;case 80:a.__actions("button_hounsfield_point");break;case 69:a.__actions("button_hounsfield_ellipse");break;case 75:a.__actions("button_hounsfield_polygon");break;case 68:a.__actions("button_reset");break;case 88:a.__actions("button_close");break;case 82:a.__actions("button_reports");break;case 67:a.__actions("button_email");
break;case 79:a.isPhone?a.__actions("button_info_phone"):a.__actions("button_info");break;case 49:b.altKey&&b.shiftKey?a.__actions("button_window_level_presets_default"):b.altKey||b.shiftKey||a.__actions("button_layers_1");break;case 50:b.altKey&&b.shiftKey?a.__actions("button_window_level_presets_bone"):b.altKey||b.shiftKey||a.__actions("button_layers_2");break;case 51:b.altKey&&b.shiftKey?a.__actions("button_window_level_presets_abdomen"):b.altKey||b.shiftKey||a.__actions("button_layers_3");break;
case 52:b.altKey&&b.shiftKey?a.__actions("button_window_level_presets_angio"):b.altKey||b.shiftKey||a.__actions("button_layers_4");break;case 53:b.altKey&&b.shiftKey&&a.__actions("button_window_level_presets_brain");break;case 54:b.altKey&&b.shiftKey&&a.__actions("button_window_level_presets_chest");break;case 55:b.altKey&&b.shiftKey&&a.__actions("button_window_level_presets_lungs")}}).on("keyup",function(b){16===b.keyCode&&a.__actions("button_magnifying_glass")}).bind("touchstart",function(b){$(this).unbind("touchmove");
"desktop"!==a.environment&&(a.__eventMouseDown(b),a.__eventClicks(b))}).bind("touchmove",function(a){a.preventDefault()});this.hammerManager=new Hammer.Manager(document.body);this.hammerManager.add(new Hammer.Tap({event:"doubletap",taps:2}));this.hammerManager.on("doubletap",function(b){"desktop"!==a.environment&&a.__eventDoubleClicks(b)})};
MIRROR.maker.prototype.__displayNavigatorBar=function(a){null!==this.layers[a].serieIdCharged?1<this.load.series[this.layers[a].serieIdCharged].totalElements&&($("#navigator_"+this.environment).html(""),$("#navigator_"+this.environment).html(this.layers[a].navigatorBar()),this.layers[a].navigatorBarIndex()):$("#navigator_"+this.environment).html("")};MIRROR.maker.prototype.__eventClicks=function(a){this.__actions(a.target.id)};
MIRROR.maker.prototype.__eventDoubleClicks=function(a){if(!this.measuringState)if("canvas_layer_1"===a.target.id||"canvas_layer_2"===a.target.id||"canvas_layer_3"===a.target.id||"canvas_layer_4"===a.target.id){if(1<this.totalLayers)if(this.layers[$("#"+a.target.id).parent().get(0).id].selected)if(this.imitationLayers){for(var b in this.layers)this.layers[b].selected&&this.layers[b].leadImitation&&(this.layers[b].leadImitation=!1,$("#"+b).css({border:"3px solid #FCBE39"}));null!==this.layers[$("#"+
a.target.id).parent().get(0).id].serieIdCharged&&(this.layers[$("#"+a.target.id).parent().get(0).id].leadImitation=!0,$("#"+a.target.id).parent().css({border:"3px solid red"}))}else this.layers[$("#"+a.target.id).parent().get(0).id].selected=!1,$("#"+a.target.id).parent().css({border:"3px solid #6C6C6C"}),this.globalInformation();else this.imitationLayers||(this.layers[$("#"+a.target.id).parent().get(0).id].selected=!0,$("#"+a.target.id).parent().css({border:"3px solid #FCBE39"}),this.globalInformation())}else("layer_1"===
$(a.target).parent().parent().get(0).id||"layer_2"===$(a.target).parent().parent().get(0).id||"layer_3"===$(a.target).parent().parent().get(0).id||"layer_4"===$(a.target).parent().parent().get(0).id)&&1<this.totalLayers&&!this.imitationLayers&&(this.layers[$(a.target).parent().parent().get(0).id].selected?(this.layers[$(a.target).parent().parent().get(0).id].selected=!1,$(a.target).parent().parent().css({border:"3px solid #6C6C6C"})):(this.layers[$(a.target).parent().parent().get(0).id].selected=
!0,$(a.target).parent().parent().css({border:"3px solid #FCBE39"})),this.globalInformation())};
MIRROR.maker.prototype.__eventMouseDown=function(a){var b=this;if(!b.measuringState)if("navigator_bar_layer_1"===a.target.id||"navigator_bar_layer_2"===a.target.id||"navigator_bar_layer_3"===a.target.id||"navigator_bar_layer_4"===a.target.id){var c=a.target.id.substr(a.target.id.length-7),d="desktop"===b.environment?a.clientX-24:a.originalEvent.touches[0].pageX,e="desktop"===b.environment?a.clientY-24:a.originalEvent.touches[0].pageY-24;"desktop"===b.environment?(0<=e&&e<$("#navigator_"+b.environment).height()&&
b.layers[c].moveInSerie(-1,e),$(window).on("mousemove",function(a){a=a.clientY-24;if(0<=a&&a<$("#navigator_"+b.environment).height()){var d=a-e;0<d?b.layers[c].moveInSerie(-1,a):0>d&&b.layers[c].moveInSerie(1,a);e=a}})):("portrait"===b.environment?0<=d&&d<$("#navigator_"+b.environment).width()&&b.layers[c].moveInSerie(-1,d):0<=e&&e<$("#navigator_"+b.environment).height()&&b.layers[c].moveInSerie(-1,e),$(window).bind("touchmove",function(a){a.preventDefault();var g=a.originalEvent.touches[0].pageX;
a=a.originalEvent.touches[0].pageY-24;"portrait"!==b.environment?0<=a&&a<$("#navigator_"+b.environment).height()&&(g=a-e,0<g?b.layers[c].moveInSerie(-1,a):0>g&&b.layers[c].moveInSerie(1,a),e=a):0<=g&&g<$("#navigator_"+b.environment).width()&&(a=g-d,0<a?b.layers[c].moveInSerie(-1,g):0>a&&b.layers[c].moveInSerie(1,g),d=g)}))}else if("canvas_layer_1"===a.target.id||"canvas_layer_2"===a.target.id||"canvas_layer_3"===a.target.id||"canvas_layer_4"===a.target.id){c=a.target.id.substr(a.target.id.length-
7);b.__displayNavigatorBar(c);for(var g in b.layers)b.layers[c].addLocalizer(g)}};
MIRROR.maker.prototype.__actions=function(a){switch(a){case "button_layers":this.layersState||this.load.charging||this.magnifyingGlassState||this.measuringState||this.hounsfieldState||this.windowLevelPresetsState?this.load.charging||this.magnifyingGlassState||this.measuringState||this.hounsfieldState||this.windowLevelPresetsState||($("#layers").html(this.buttons.layers.inactive),this.layersState=!1):(this.__toolsWithout(),$("#layers").html(this.buttons.layers.active),this.layersState=!0);if(this.layersState){var b=
$("<div><div>");a=[];var c='<div style="width: 100%; color: #FFF; font-weight: bold; text-align: center">'+MIRROR.language.submenu.layers+"</div>";1===this.totalLayers?a.push($('<div id="layers_1" style="display: inline-block;"></div>').html(this.buttons.layers_1.active)):a.push($('<div id="layers_1" style="display: inline-block;"></div>').html(this.buttons.layers_1.inactive));2===this.totalLayers?a.push($('<div id="layers_2" style="display: inline-block;"></div>').html(this.buttons.layers_2.active)):
a.push($('<div id="layers_2" style="display: inline-block;"></div>').html(this.buttons.layers_2.inactive));3===this.totalLayers&&"desktop"===this.environment?a.push($('<div id="layers_3" style="display: inline-block;"></div>').html(this.buttons.layers_3.active)):"desktop"===this.environment&&a.push($('<div id="layers_3" style="display: inline-block;"></div>').html(this.buttons.layers_3.inactive));4===this.totalLayers&&"desktop"===this.environment?a.push($('<div id="layers_4" style="display: inline-block;"></div>').html(this.buttons.layers_4.active)):
"desktop"===this.environment&&a.push($('<div id="layers_4" style="display: inline-block;"></div>').html(this.buttons.layers_4.inactive));b.append(c);for(c=0;c<a.length;c++)b.append(a[c]);this.__submenu(b)}else this.measuringState||this.hounsfieldState||this.windowLevelPresetsState||$("#submenu").remove();break;case "button_layers_1":if(!(this.magnifyingGlassState||this.measuringState||this.hounsfieldState||this.windowLevelPresetsState))for(c in this.totalLayers=1,$("#layers_1").html(this.buttons.layers_1.active),
$("#layers_2").html(this.buttons.layers_2.inactive),$("#layers_3").html(this.buttons.layers_3.inactive),$("#layers_4").html(this.buttons.layers_4.inactive),this.__updateLayers(),this.__displayNavigatorBar("layer_1"),this.__responsiveSystem(),$("#imitation").html(this.buttons.imitation.disable),this.layers)this.layers[c].removeLocalizer();break;case "button_layers_2":if(!(this.magnifyingGlassState||this.measuringState||this.hounsfieldState||this.windowLevelPresetsState))for(c in this.totalLayers=2,
$("#layers_1").html(this.buttons.layers_1.inactive),$("#layers_2").html(this.buttons.layers_2.active),$("#layers_3").html(this.buttons.layers_3.inactive),$("#layers_4").html(this.buttons.layers_4.inactive),this.__updateLayers(),this.__displayNavigatorBar("layer_1"),this.__responsiveSystem(),$("#imitation").html(this.buttons.imitation.inactive),this.layers)this.layers[c].removeLocalizer();break;case "button_layers_3":if(!(this.magnifyingGlassState||this.measuringState||this.hounsfieldState||this.windowLevelPresetsState))for(c in this.totalLayers=
3,$("#layers_1").html(this.buttons.layers_1.inactive),$("#layers_2").html(this.buttons.layers_2.inactive),$("#layers_3").html(this.buttons.layers_3.active),$("#layers_4").html(this.buttons.layers_4.inactive),this.__updateLayers(),this.__displayNavigatorBar("layer_1"),this.__responsiveSystem(),$("#imitation").html(this.buttons.imitation.inactive),this.layers)this.layers[c].removeLocalizer();break;case "button_layers_4":if(!(this.magnifyingGlassState||this.measuringState||this.hounsfieldState||this.windowLevelPresetsState))for(c in this.totalLayers=
4,$("#layers_1").html(this.buttons.layers_1.inactive),$("#layers_2").html(this.buttons.layers_2.inactive),$("#layers_3").html(this.buttons.layers_3.inactive),$("#layers_4").html(this.buttons.layers_4.active),this.__updateLayers(),this.__displayNavigatorBar("layer_1"),this.__responsiveSystem(),$("#imitation").html(this.buttons.imitation.inactive),this.layers)this.layers[c].removeLocalizer();break;case "button_thumbnails_series":this.thumbnailsSeriesState||this.measuringState||this.hounsfieldState||
this.windowLevelPresetsState?this.measuringState||this.hounsfieldState||this.windowLevelPresetsState||($("#thumbnails_series").html(this.buttons.series.inactive),this.thumbnailsSeriesState=!1):(this.__toolsWithout(),$("#thumbnails_series").html(this.buttons.series.active),this.thumbnailsSeriesState=!0);if(this.thumbnailsSeriesState){c=$("<div></div>");a=$('<div style="min-width: 120px; color: #FFF; font-weight: bold; text-align: center">'+MIRROR.language.submenu.series+"</div>");var d=$('<div id="series_thumbnails_submenu" style="position: relative; min-width: 120px; max-height: '+
($(window).height()-100)+'px; text-align: left; overflow: hidden; padding-left: 10px;"></div>');for(b in this.thumbnails)d.append(this.thumbnails[b]);c.append(a);c.append(d);this.__submenu(c);for(b in this.thumbnails)this.load.series[b].commonEventsHandler();this.load.blockAttachSerieMobile?$("#series_thumbnails_submenu").append('<div id="blockAttachSerie" style="display: table; position: absolute; left: 0px; top: 0px; width: 100%; height: '+$("#series_thumbnails_submenu").height()+'px; background: rgba(66, 66, 66, 0.8);"><div style="display: table-cell; vertical-align: middle"><img src="../img/loading.svg" /></div></div>'):
0<$("#blockAttachSerie").length&&$("#blockAttachSerie").remove()}else this.measuringState||this.hounsfieldState||this.windowLevelPresetsState||$("#submenu").remove();break;case "button_magnifying_glass":this.magnifyingGlassState||this.filmModeState||this.measuringState||this.hounsfieldState?this.filmModeState||this.measuringState||this.hounsfieldState||($("#magnifying_glass").html(this.buttons.magnifying_glass.inactive),this.magnifyingGlassState=!1,$("#film_mode").html(this.buttons.film_mode.inactive),
$("#layers").html(this.buttons.layers.inactive),$("#measuring").html(this.buttons.measuring.inactive),$("#hounsfield").html(this.buttons.hu.inactive),$("#reset").html(this.buttons.reset.inactive)):(this.__toolsWithout(),$("#magnifying_glass").html(this.buttons.magnifying_glass.active),this.magnifyingGlassState=!0,$("#film_mode").html(this.buttons.film_mode.disable),$("#layers").html(this.buttons.layers.disable),$("#measuring").html(this.buttons.measuring.disable),$("#hounsfield").html(this.buttons.hu.disable),
$("#reset").html(this.buttons.reset.disable));for(c in this.layers)this.layers[c].magnifyingGlass();break;case "button_negative":this.negativeState?($("#negative").html(this.buttons.negative.inactive),this.negativeState=!1):(this.__toolsWithout(),$("#negative").html(this.buttons.negative.active),this.negativeState=!0);for(c in this.layers)this.layers[c].negative();break;case "button_film_mode":this.filmModeState||this.magnifyingGlassState||this.measuringState||this.hounsfieldState?this.magnifyingGlassState||
this.measuringState||this.hounsfieldState||($("#film_mode").html(this.buttons.film_mode.inactive),this.filmModeState=!1,$("#magnifying_glass").html(this.buttons.magnifying_glass.inactive),$("#measuring").html(this.buttons.measuring.inactive),$("#hounsfield").html(this.buttons.hu.inactive)):(this.__toolsWithout(),$("#film_mode").html(this.buttons.film_mode.active),this.filmModeState=!0,$("#magnifying_glass").html(this.buttons.magnifying_glass.disable),$("#measuring").html(this.buttons.measuring.disable),
$("#hounsfield").html(this.buttons.hu.disable));for(c in this.layers)this.layers[c].filmMode();break;case "button_measuring":if(!(this.measuringState||this.hounsfieldState||this.windowLevelPresetsState||this.filmModeState||this.magnifyingGlassState||this.rotationState))this.__toolsWithout(),$("#measuring").html(this.buttons.measuring.active),this.measuringState=!0,$("#thumbnails_series").html(this.buttons.series.disable),$("#imitation").html(this.buttons.imitation.disable),$("#rotation").html(this.buttons.rotation.disable),
$("#magnifying_glass").html(this.buttons.magnifying_glass.disable),$("#film_mode").html(this.buttons.film_mode.disable),$("#layers").html(this.buttons.layers.disable),$("#hounsfield").html(this.buttons.hu.disable),$("#window_level_presets").html(this.buttons.presets.disable),$("#reset").html(this.buttons.reset.disable);else if(!(this.hounsfieldState||this.windowLevelPresetsState||this.filmModeState||this.magnifyingGlassState||this.rotationState)){$("#measuring").html(this.buttons.measuring.inactive);
this.measuringAreaState=this.measuringAngleState=this.measuringSegmentState=this.measuringState=!1;for(c in this.layers)this.layers[c].commonMeasuring();$("#thumbnails_series").html(this.buttons.series.inactive);1<this.totalLayers&&$("#imitation").html(this.buttons.imitation.inactive);$("#rotation").html(this.buttons.rotation.inactive);$("#magnifying_glass").html(this.buttons.magnifying_glass.inactive);$("#film_mode").html(this.buttons.film_mode.inactive);$("#layers").html(this.buttons.layers.inactive);
$("#hounsfield").html(this.buttons.hu.inactive);$("#window_level_presets").html(this.buttons.presets.inactive);$("#reset").html(this.buttons.reset.inactive)}if(this.measuringState){b=$("<div></div>");a=$('<div style="display: table-cell;"></div>');c='<div style="width: 100%; color: #FFF; font-weight: bold; text-align: center">'+MIRROR.language.submenu.measuring+"</div>";d=[];d.push($('<div id="measuring_segment" style="display: inline-block;"></div>').html(this.buttons.segment.inactive));d.push($('<div id="measuring_angle" style="display: inline-block;"></div>').html(this.buttons.angle.inactive));
d.push($('<div id="measuring_area" style="display: inline-block;"></div>').html(this.buttons.area.inactive));a.append(c);for(c=0;c<d.length;c++)a.append(d[c]);b.append(a);b.append('<div style="display: table-cell; width: 10px;"></div><div id="button_submenu_min" style="display: table-cell; cursor: pointer; background: #6C6C6C; width: 10px; vertical-align: middle; font-family: Oswald, sans-serif; font-size: 20pt; border-top-right-radius: 5px; border-bottom-right-radius: 5px;"><</div>');this.__submenu(b);
"segment"===this.measuringTool?this.__actions("button_measuring_segment"):"angle"===this.measuringTool?this.__actions("button_measuring_angle"):"area"===this.measuringTool&&this.__actions("button_measuring_area")}else this.hounsfieldState||this.windowLevelPresetsState||$("#submenu").remove();break;case "button_measuring_segment":!this.measuringState||this.measuringSegmentState||this.hounsfieldState||this.windowLevelPresetsState||this.filmModeState||this.magnifyingGlassState||(this.__toolsWithoutMeasuring(),
$("#measuring_segment").html(this.buttons.segment.active),this.measuringSegmentState=!0,this.measuringTool="segment");for(c in this.layers)this.layers[c].measuringTool="segment",this.layers[c].commonMeasuring();break;case "button_measuring_angle":!this.measuringState||this.measuringAngleState||this.hounsfieldState||this.windowLevelPresetsState||this.filmModeState||this.magnifyingGlassState||(this.__toolsWithoutMeasuring(),$("#measuring_angle").html(this.buttons.angle.active),this.measuringAngleState=
!0,this.measuringTool="angle");for(c in this.layers)this.layers[c].measuringTool="angle",this.layers[c].commonMeasuring();break;case "button_measuring_area":!this.measuringState||this.measuringAreaState||this.hounsfieldState||this.windowLevelPresetsState||this.filmModeState||this.magnifyingGlassState||(this.__toolsWithoutMeasuring(),$("#measuring_area").html(this.buttons.area.active),this.measuringAreaState=!0,this.measuringTool="area");for(c in this.layers)this.layers[c].measuringTool="area",this.layers[c].commonMeasuring();
break;case "button_hounsfield":if(!(this.hounsfieldState||this.measuringState||this.windowLevelPresetsState||this.filmModeState||this.magnifyingGlassState||this.rotationState)){this.__toolsWithout();$("#hounsfield").html(this.buttons.hu.active);this.hounsfieldState=!0;for(c in this.layers)this.layers[c].hounsfield.initialize();$("#thumbnails_series").html(this.buttons.series.disable);$("#imitation").html(this.buttons.imitation.disable);$("#rotation").html(this.buttons.rotation.disable);$("#magnifying_glass").html(this.buttons.magnifying_glass.disable);
$("#film_mode").html(this.buttons.film_mode.disable);$("#layers").html(this.buttons.layers.disable);$("#measuring").html(this.buttons.measuring.disable);$("#window_level_presets").html(this.buttons.presets.disable);$("#reset").html(this.buttons.reset.disable)}else if(!(!this.hounsfieldState||this.measuringState||this.windowLevelPresetsState||this.filmModeState||this.magnifyingGlassState||this.rotationState)){$("#hounsfield").html(this.buttons.hu.inactive);this.hounsfieldState=!1;for(c in this.layers)this.layers[c].hounsfield.clear();
$("#thumbnails_series").html(this.buttons.series.inactive);1<this.totalLayers&&$("#imitation").html(this.buttons.imitation.inactive);$("#rotation").html(this.buttons.rotation.inactive);$("#magnifying_glass").html(this.buttons.magnifying_glass.inactive);$("#film_mode").html(this.buttons.film_mode.inactive);$("#layers").html(this.buttons.layers.inactive);$("#measuring").html(this.buttons.measuring.inactive);$("#window_level_presets").html(this.buttons.presets.inactive);$("#reset").html(this.buttons.reset.inactive)}if(this.hounsfieldState){b=
$("<div></div>");a=$('<div style="display: table-cell;"></div>');c='<div style="width: 100%; color: #FFF; font-weight: bold; text-align: center">'+MIRROR.language.submenu.hounsfield+"</div>";d=[];d.push($('<div id="hounsfield_point" style="display: inline-block;"></div>').html(this.buttons.point.inactive));d.push($('<div id="hounsfield_ellipse" style="display: inline-block;"></div>').html(this.buttons.ellipse.inactive));d.push($('<div id="hounsfield_polygon" style="display: inline-block;"></div>').html(this.buttons.polygon.inactive));
a.append(c);for(c=0;c<d.length;c++)a.append(d[c]);b.append(a);b.append('<div style="display: table-cell; width: 10px;"></div><div id="button_submenu_min" style="display: table-cell; cursor: pointer; background: #6C6C6C; width: 10px; vertical-align: middle; font-family: Oswald, sans-serif; font-size: 20pt; border-top-right-radius: 5px; border-bottom-right-radius: 5px;"><</div>');this.__submenu(b)}else this.measuringState||this.windowLevelPresetsState||$("#submenu").remove();break;case "button_hounsfield_point":if(this.hounsfieldState&&
!this.measuringState&&!this.windowLevelPresetsState&&!this.filmModeState&&!this.magnifyingGlassState)for(c in $("#hounsfield_point").html(this.buttons.point.active),$("#hounsfield_ellipse").html(this.buttons.ellipse.inactive),$("#hounsfield_polygon").html(this.buttons.polygon.inactive),this.layers)this.layers[c].hounsfield.selectPointTool();break;case "button_hounsfield_ellipse":if(this.hounsfieldState&&!this.measuringState&&!this.windowLevelPresetsState&&!this.filmModeState&&!this.magnifyingGlassState)for(c in $("#hounsfield_point").html(this.buttons.point.inactive),
$("#hounsfield_ellipse").html(this.buttons.ellipse.active),$("#hounsfield_polygon").html(this.buttons.polygon.inactive),this.layers)this.layers[c].hounsfield.selectElipseTool();break;case "button_hounsfield_polygon":if(this.hounsfieldState&&!this.measuringState&&!this.windowLevelPresetsState&&!this.filmModeState&&!this.magnifyingGlassState)for(c in $("#hounsfield_point").html(this.buttons.point.inactive),$("#hounsfield_ellipse").html(this.buttons.ellipse.inactive),$("#hounsfield_polygon").html(this.buttons.polygon.active),
this.layers)this.layers[c].hounsfield.selectPolygonTool();break;case "button_rotation":this.rotationState||this.measuringState||this.hounsfieldState?this.measuringState||this.hounsfieldState||($("#rotation").html(this.buttons.rotation.inactive),this.rotationState=!1,$("#measuring").html(this.buttons.measuring.inactive),$("#hounsfield").html(this.buttons.hu.inactive)):($("#rotation").html(this.buttons.rotation.active),this.rotationState=!0,$("#measuring").html(this.buttons.measuring.disable),$("#hounsfield").html(this.buttons.hu.disable));
break;case "button_window_level_presets":this.windowLevelPresetsState||this.measuringState||this.hounsfieldState?this.measuringState||this.hounsfieldState||($("#window_level_presets").html(this.buttons.presets.inactive),this.windowLevelPresetsState=!1,$("#thumbnails_series").html(this.buttons.series.inactive),$("#layers").html(this.buttons.layers.inactive),$("#measuring").html(this.buttons.measuring.inactive),$("#hounsfield").html(this.buttons.hu.inactive)):(this.__toolsWithout(),$("#window_level_presets").html(this.buttons.presets.active),
this.windowLevelPresetsState=!0,$("#thumbnails_series").html(this.buttons.series.disable),$("#layers").html(this.buttons.layers.disable),$("#measuring").html(this.buttons.measuring.disable),$("#hounsfield").html(this.buttons.hu.disable));if(this.windowLevelPresetsState){b=$("<div></div>");c='<div style="width: 100%; color: #FFF; font-weight: bold; text-align: center">'+MIRROR.language.submenu.presets+"</div>";a=[];a.push($('<div id="presets_default" style="display: inline-block;"></div>').html(this.buttons["default"].inactive));
a.push($('<div id="presets_bone" style="display: inline-block;"></div>').html(this.buttons.bone.inactive));a.push($('<div id="presets_abdomen" style="display: inline-block;"></div>').html(this.buttons.abdomen.inactive));a.push($('<div id="presets_angio" style="display: inline-block;"></div>').html(this.buttons.angio.inactive));a.push($('<div id="presets_brain" style="display: inline-block;"></div>').html(this.buttons.brain.inactive));a.push($('<div id="presets_chest" style="display: inline-block;"></div>').html(this.buttons.chest.inactive));
a.push($('<div id="presets_lungs" style="display: inline-block;"></div>').html(this.buttons.lungs.inactive));b.append(c);for(c=0;c<a.length;c++)b.append(a[c]);this.__submenu(b)}else this.measuringState||this.hounsfieldState||$("#submenu").remove();break;case "button_window_level_presets_default":!this.windowLevelPresetsState||this.windowLevelPresetsDefaultState||this.filmModeState||this.magnifyingGlassState||(this.__toolsWithoutPresets(),$("#presets_default").html(this.buttons["default"].active),
this.windowLevelPresetsDefaultState=!0);for(c in this.layers)this.layers[c].windowLevelPresets("default");break;case "button_window_level_presets_bone":!this.windowLevelPresetsState||this.windowLevelPresetsBoneState||this.filmModeState||this.magnifyingGlassState||(this.__toolsWithoutPresets(),$("#presets_bone").html(this.buttons.bone.active),this.windowLevelPresetsBoneState=!0);for(c in this.layers)this.layers[c].windowLevelPresets("bone");break;case "button_window_level_presets_abdomen":!this.windowLevelPresetsState||
this.windowLevelPresetsAbdomenState||this.filmModeState||this.magnifyingGlassState||(this.__toolsWithoutPresets(),$("#presets_abdomen").html(this.buttons.abdomen.active),this.windowLevelPresetsAbdomenState=!0);for(c in this.layers)this.layers[c].windowLevelPresets("abdomen");break;case "button_window_level_presets_angio":!this.windowLevelPresetsState||this.windowLevelPresetsAngioState||this.filmModeState||this.magnifyingGlassState||(this.__toolsWithoutPresets(),$("#presets_angio").html(this.buttons.angio.active),
this.windowLevelPresetsAngioState=!0);for(c in this.layers)this.layers[c].windowLevelPresets("angio");break;case "button_window_level_presets_brain":!this.windowLevelPresetsState||this.windowLevelPresetsBrainState||this.filmModeState||this.magnifyingGlassState||(this.__toolsWithoutPresets(),$("#presets_brain").html(this.buttons.brain.active),this.windowLevelPresetsBrainState=!0);for(c in this.layers)this.layers[c].windowLevelPresets("brain");break;case "button_window_level_presets_chest":!this.windowLevelPresetsState||
this.windowLevelPresetsChestState||this.filmModeState||this.magnifyingGlassState||(this.__toolsWithoutPresets(),$("#presets_chest").html(this.buttons.chest.active),this.windowLevelPresetsChestState=!0);for(c in this.layers)this.layers[c].windowLevelPresets("chest");break;case "button_window_level_presets_lungs":!this.windowLevelPresetsState||this.windowLevelPresetsLungsState||this.filmModeState||this.magnifyingGlassState||(this.__toolsWithoutPresets(),$("#presets_lungs").html(this.buttons.lungs.active),
this.windowLevelPresetsLungsState=!0);for(c in this.layers)this.layers[c].windowLevelPresets("lungs");break;case "button_close":window.close();break;case "button_close_popup":$("#popup").remove();break;case "button_reset":this.negativeState&&this.__actions("button_negative");if(!(this.magnifyingGlassState||this.measuringState||this.hounsfieldState||this.windowLevelPresetsState))for(c in this.layers)this.layers[c].defaultState();break;case "button_reports":$("#label_title_modal").html(MIRROR.language.modal.report_title);
$("#content_modal").html("content report");break;case "button_email":$("#label_title_modal").html(MIRROR.language.modal.email_title);$("#content_modal").html("content email");break;case "button_info_phone":this.modalContent="";null!==this.layers.layer_1.serieIdCharged?(null!==this.load.series[this.layers.layer_1.serieIdCharged].patientName&&(this.modalContent+=MIRROR.language.dicomInformation.patient_name+": "+this.load.series[this.layers.layer_1.serieIdCharged].patientName+"<br />"),null!==this.load.series[this.layers.layer_1.serieIdCharged].patientRut&&
(this.modalContent+=MIRROR.language.dicomInformation.dni_age+": "+this.load.series[this.layers.layer_1.serieIdCharged].patientRut+"<br />"),null!==this.load.series[this.layers.layer_1.serieIdCharged].patientSex&&(this.modalContent+=MIRROR.language.dicomInformation.sex+": "+this.load.series[this.layers.layer_1.serieIdCharged].patientSex+"<br />"),null!==this.load.studyDescription&&(this.modalContent+=MIRROR.language.dicomInformation.study_desc+": "+this.load.studyDescription+"<br />"),null!==this.load.series[this.layers.layer_1.serieIdCharged].serieDescription&&
(this.modalContent+=MIRROR.language.dicomInformation.serie_desc+": "+this.load.series[this.layers.layer_1.serieIdCharged].serieDescription+"<br />"),null!==this.load.series[this.layers.layer_1.serieIdCharged].serieBodyPart&&(this.modalContent+=MIRROR.language.dicomInformation.body_part+": "+this.load.series[this.layers.layer_1.serieIdCharged].serieBodyPart+"<br />"),null!==this.load.series[this.layers.layer_1.serieIdCharged].serieName&&(this.modalContent+=MIRROR.language.dicomInformation.serie_name+
": "+this.load.series[this.layers.layer_1.serieIdCharged].serieName+"<br />"),null!==this.load.series[this.layers.layer_1.serieIdCharged].modality&&(this.modalContent+=MIRROR.language.dicomInformation.modality+": "+this.load.series[this.layers.layer_1.serieIdCharged].modality+"<br />"),null!==this.load.series[this.layers.layer_1.serieIdCharged].institution&&(this.modalContent+=MIRROR.language.dicomInformation.institution+": "+this.load.series[this.layers.layer_1.serieIdCharged].institution)):this.modalContent+=
MIRROR.language.modal.info_content_no_data;$("#label_title_modal").html(MIRROR.language.modal.info_title);$("#content_modal").html(this.modalContent);break;case "button_info":this.infoState?($("#button_info").css({background:"#4C4C4C","padding-left":"8px","padding-right":"8px",border:"1px #F69322 solid","border-radius":"2px",color:"#FFF"}),this.infoState=!1):($("#button_info").css({background:"#F69322","padding-left":"8px","padding-right":"8px",border:"1px #F69322 solid","border-radius":"2px",color:"#FFF"}),
this.infoState=!0);for(c in this.layers)this.layers[c].displayDicomLayerInformation();break;case "button_submenu_min":this.submenuContent=$("#submenu").children();$("#submenu").remove();b=$("<div></div>");"desktop"===this.environment?b.append('<div style="display: table-cell; width: 5px; height: 70px;"></div><div id="button_submenu_max" style="display: table-cell; cursor: pointer; color: #FFF; background: #F69322; width: 15px; vertical-align: middle; font-family: Oswald, sans-serif; font-size: 20pt; border-top-right-radius: 5px; border-bottom-right-radius: 5px;">></div>'):
b.append('<div style="display: table-cell; width: 5px; height: 60px;"></div><div id="button_submenu_max" style="display: table-cell; cursor: pointer; color: #FFF; background: #F69322; width: 15px; vertical-align: middle; font-family: Oswald, sans-serif; font-size: 20pt; border-top-right-radius: 5px; border-bottom-right-radius: 5px;">></div>');this.__submenu(b);break;case "button_submenu_max":$("#submenu").remove();this.__submenu(this.submenuContent);break;case "button_imitation":if(1<this.totalLayers&&
!this.measuringState&&!this.hounsfieldState)if(this.imitationLayers)for(c in $("#imitation").html(this.buttons.imitation.inactive),this.imitationLayers=!1,this.layers)this.layers[c].selected&&this.layers[c].leadImitation&&(this.layers[c].leadImitation=!1,$("#"+c).css({border:"3px solid #FCBE39"}));else for(c in b=!1,this.layers)!b&&null!==this.layers[c].serieIdCharged&&this.layers[c].selected&&this.layers[c].displayed&&(this.__toolsWithout(),$("#imitation").html(this.buttons.imitation.active),this.imitationLayers=
!0,this.layers[c].leadImitation=!0,$("#"+c).css({border:"3px solid red"}),b=!0)}};MIRROR.maker.prototype.__toolsWithout=function(){if(this.layersState||this.thumbnailsSeriesState||this.windowLevelPresetsState)this.windowLevelPresetsState=this.thumbnailsSeriesState=this.layersState=!1,$("#layers").html(this.buttons.layers.inactive),$("#thumbnails_series").html(this.buttons.series.inactive),$("#window_level_presets").html(this.buttons.presets.inactive),$("#submenu").remove()};
MIRROR.maker.prototype.__toolsWithoutMeasuring=function(){if(this.measuringSegmentState||this.measuringAngleState||this.measuringAreaState)this.measuringAreaState=this.measuringAngleState=this.measuringSegmentState=!1,$("#measuring_segment").html(this.buttons.segment.inactive),$("#measuring_angle").html(this.buttons.angle.inactive),$("#measuring_area").html(this.buttons.area.inactive)};
MIRROR.maker.prototype.__toolsWithoutPresets=function(){if(this.windowLevelPresetsDefaultState||this.windowLevelPresetsBoneState||this.windowLevelPresetsAbdomenState||this.windowLevelPresetsAngioState||this.windowLevelPresetsBrainState||this.windowLevelPresetsChestState||this.windowLevelPresetsLungsState)this.windowLevelPresetsLungsState=this.windowLevelPresetsChestState=this.windowLevelPresetsBrainState=this.windowLevelPresetsAngioState=this.windowLevelPresetsAbdomenState=this.windowLevelPresetsBoneState=
this.windowLevelPresetsDefaultState=!1,$("#presets_default").html(this.buttons["default"].inactive),$("#presets_bone").html(this.buttons.bone.inactive),$("#presets_abdomen").html(this.buttons.abdomen.inactive),$("#presets_angio").html(this.buttons.angio.inactive),$("#presets_brain").html(this.buttons.brain.inactive),$("#presets_chest").html(this.buttons.chest.inactive),$("#presets_lungs").html(this.buttons.lungs.inactive)};
MIRROR.maker.prototype.__setLayers=function(){$("#workspace").html(MIRROR.ui["layers_"+this.totalLayers]);"desktop"!==this.environment&&this.__layersSizeConfiguration();for(var a=1;a<=this.maxTotalLayers;a++)this.layers["layer_"+a]=new MIRROR.layer(this,"layer_"+a),this.layers["layer_"+a].displayed=a<=this.totalLayers?!0:!1,this.layers["layer_"+a].init($("#layer_"+a).width(),$("#layer_"+a).height()),1===a&&(this.layers["layer_"+a].selected=!0)};
MIRROR.maker.prototype.__updateLayers=function(){var a={},b=1,c;for(c in this.layers)this.layers[c].selected&&(a["layer_"+b]=this.layers[c],b++);for(c in this.layers)this.layers[c].selected||(a["layer_"+b]=this.layers[c],b++);this.layers=a;for(b=1;b<=this.maxTotalLayers;b++)b<=this.totalLayers?this.layers["layer_"+b].displayed=!0:(this.layers["layer_"+b].displayed=!1,this.layers["layer_"+b].serieIdCharged=null),this.layers["layer_"+b].updateContext();$("#workspace").html(MIRROR.ui["layers_"+this.totalLayers]);
"desktop"!==this.environment&&this.__layersSizeConfiguration();for(b=1;b<=this.totalLayers;b++)this.layers["layer_"+b].displayed&&this.layers["layer_"+b].updateLayerConfiguration("layer_"+b,$("#layer_"+b).width(),$("#layer_"+b).height());1===this.totalLayers&&this.__actions("button_imitation");this.__checkSeriesDisplayed()};MIRROR.maker.prototype.__loadStudy=function(){this.load=new MIRROR.loader(this,this.studyId);this.load.study()};
MIRROR.maker.prototype.attachSerieToLayer=function(a,b){!this.layers[a].displayed||null!==this.layers[a].serieIdCharged&&this.load.series[this.layers[a].serieIdCharged].charging||(this.layers[a].selected=!0,$("#"+this.layers[a].layerId).css({border:"3px solid #FCBE39"}),this.layers[a].serieIdCharged=b,this.__checkSeriesDisplayed(),this.load.series[b].setMultiplierPaddingNavigatorBar(),this.__displayNavigatorBar(a),this.load.statusSerie(a,b))};
MIRROR.maker.prototype.__orientationChangeLayers=function(){$("#workspace").html(MIRROR.ui["layers_"+this.totalLayers]);this.__layersSizeConfiguration();for(var a in this.layers)this.layers[a].displayed&&this.layers[a].updateLayerConfiguration(a,$("#"+a).width(),$("#"+a).height());for(a=0;a<this.load.totalSeries;a++)this.load.series["serie_"+a].setMultiplierPaddingNavigatorBar();this.__displayNavigatorBar("layer_1")};
MIRROR.maker.prototype.__checkSeriesDisplayed=function(){for(var a in this.load.series){var b=0,c;for(c in this.layers)a===this.layers[c].serieIdCharged&&b++;0<b?$("#"+a).css("border","1px solid #F69322"):$("#"+a).css("border","1px solid #4C4C4C")}};
MIRROR.maker.prototype.globalInformation=function(){var a;a=""+(MIRROR.language.globalInformation.total_series+": "+this.load.totalSeries);a+=" | "+MIRROR.language.globalInformation.total_series_charged+": "+this.load.totalSeriesCharged;a+=" | "+MIRROR.language.globalInformation.total_layers_selected+": "+this.__totalLayersSelectedGlobalInformation();a=this.infoState?a+(' | <div id="button_info" style="display: inline-block; cursor: pointer; background: #F69322; padding-left: 8px; padding-right: 8px; border: 1px #F69322 solid; border-radius: 2px; color: #FFF;">'+
MIRROR.language.globalInformation.info+"</div>"):a+(' | <div id="button_info" style="display: inline-block; cursor: pointer; background: #4C4C4C; padding-left: 8px; padding-right: 8px; border: 1px #F69322 solid; border-radius: 2px; color: #FFF;">'+MIRROR.language.globalInformation.info+"</div>");$("#general_information").html(a)};MIRROR.maker.prototype.__totalLayersSelectedGlobalInformation=function(){var a=0,b;for(b in this.layers)this.layers[b].selected&&a++;return a};
MIRROR.maker.prototype.__updateDOM=function(){"msie"===this.browser?$("#main").html(MIRROR.ui[this.environment]):$("body").html(MIRROR.ui[this.environment]);$("#mirror").html("");$("#mirror").append(MIRROR.ui["toolsbar_"+this.environment]);$("#mirror").append(MIRROR.ui["workspace_"+this.environment]);$("#mirror").append(MIRROR.ui["navigator_"+this.environment]);$("#copyright_year").html(MIRROR.copyrightDate);$("#version").html(MIRROR.version);this.__responsiveSystem();this.__toolsInEnvironment();
this.__toolsButtonsSizeStyle();"desktop"!==this.environment?(0===this.loadingStudyCounterMobile&&this.__loadingStudy(),this.loadingStudyCounterMobile++):this.__loadingStudy()};
MIRROR.maker.prototype.__responsiveSystem=function(){if("desktop"===this.environment){var a=102,b=$(window).height()-3,c=50,d=$(window).height()-31,e=$(window).width()-a-c-14,g=$(window).height()-3,f=$(window).height()-51;$("#toolsbar_"+this.environment).width(a);$("#toolsbar_"+this.environment).height(b);$("#navigator_"+this.environment).width(c);$("#navigator_"+this.environment).height(d);$("#workspace").parent().width(e);$("#workspace").parent().height(g);$("#workspace").height(f);a=$(window).height()-
($("#series_toolsbar").offset().top+8);$("#series_toolsbar").height(a);null!==this.load&&this.load.studyCharged&&$("#series_toolsbar").perfectScrollbar("update");660>$(window).width()?$("#general_information").css("display","none"):$("#general_information").css("display","table-cell");1===this.totalLayers?$("#layer_1").height(f-6):2===this.totalLayers?($("#layer_1").height(f-6),$("#layer_2").height(f-6)):3===this.totalLayers?($("#layer_1").height(f/2-6),$("#layer_2").height(f/2-6),$("#layer_3").height(f-
6)):4===this.totalLayers&&($("#layer_1").height(f/2-6),$("#layer_2").height(f/2-6),$("#layer_3").height(f/2-6),$("#layer_4").height(f/2-6));for(var h in this.layers)this.layers[h].displayed&&this.layers[h].responsiveLayer($("#"+h).width(),$("#"+h).height())}else"landscape"===this.environment?this.isPhone?($(".btn").css("font-size","10px"),$("#general_information").parent().remove(),c=30,a=50,f=$(window).width()-a-c-14,$("#toolsbar_"+this.environment).width(a),$("#toolsbar_"+this.environment).height($(window).height()-
3),$("#navigator_"+this.environment).width(c),$("#navigator_"+this.environment).height($(window).height()-31),$("#workspace").parent().width(f),$("#workspace").parent().height($(window).height()-3),$("#workspace").height($(window).height()-31),$("#button_imitation").remove(),$("#button_layers").remove()):(a=c=50,f=$(window).width()-a-c-14,$("#toolsbar_"+this.environment).width(a),$("#toolsbar_"+this.environment).height($(window).height()-3),$("#navigator_"+this.environment).width(c),$("#navigator_"+
this.environment).height($(window).height()-31),$("#workspace").parent().width(f),$("#workspace").parent().height($(window).height()-3),$("#workspace").height($(window).height()-51)):"portrait"===this.environment&&(this.isPhone?($(".btn").css("font-size","7px"),b=34,d=30,f=$(window).height()-b-d-33,$("#workspace").parent().height(f),$("#workspace").height(f),$("#navigator_"+this.environment).height(31),$("#button_imitation").remove(),$("#button_layers").remove(),$("#copyright").css("font-size","12px")):
(b=52,d=50,f=$(window).height()-b-d-13,$("#workspace").parent().height(f),$("#workspace").height(f)))};
MIRROR.maker.prototype.__loadingStudy=function(){var a='<div id="loading_study" style="display: table; position: absolute; left: 0px; top: 0px; z-index: 1500; width: 100%; height: '+$(window).height()+'px; background: rgba(66, 66, 66, 0.8);"><div style="display: table-cell; vertical-align: middle; text-align: center"><img src="../img/loading.svg" /><br /><span style="color: #F69322; cursor: default; font-family: Oswald, sans-serif; font-size: 20pt; -webkit-user-select: none; -moz-user-select: -moz-none; -ms-user-select: none; user-select: none;">'+MIRROR.language.mirror.loading_study+
"</span></div></div>";$("body").append(a)};MIRROR.maker.prototype.checkIfWindowLevelIsSet=function(a){for(var b=0,c=0;c<a.length;c++)null===a[c].windowWidth&&null===a[c].windowCenter&&b++;b===a.length&&"webgl"===this.renderType&&$("#window_level_presets").remove();"desktop"===this.environment&&(a=$(window).height()-($("#series_toolsbar").offset().top+8),$("#series_toolsbar").height(a))};
MIRROR.maker.prototype.__toolsInEnvironment=function(){var a=[];"desktop"===this.environment?"webgl"===this.renderType?(a.push($('<div id="imitation" style="display: inline-block;"></div>').html(this.buttons.imitation.disable)),a.push($('<div id="rotation" style="display: inline-block;"></div>').html(this.buttons.rotation.inactive)),a.push($('<div id="magnifying_glass" style="display: inline-block;"></div>').html(this.buttons.magnifying_glass.inactive)),a.push($('<div id="negative" style="display: inline-block;"></div>').html(this.buttons.negative.inactive)),
a.push($('<div id="film_mode" style="display: inline-block;"></div>').html(this.buttons.film_mode.inactive)),a.push($('<div id="layers" style="display: inline-block;"></div>').html(this.buttons.layers.inactive)),a.push($('<div id="measuring" style="display: inline-block;"></div>').html(this.buttons.measuring.inactive)),a.push($('<div id="hounsfield" style="display: inline-block;"></div>').html(this.buttons.hu.inactive)),a.push($('<div id="window_level_presets" style="display: inline-block;"></div>').html(this.buttons.presets.inactive)),
a.push($('<div id="reset" style="display: inline-block;"></div>').html(this.buttons.reset.inactive)),a.push($('<div id="close" style="display: inline-block;"></div>').html(this.buttons.close.inactive)),this.reportsState?a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.inactive)):a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.disable)),this.mailState?a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.inactive)):
a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.disable))):"canvas2d"===this.renderType&&(a.push($('<div id="imitation" style="display: inline-block;"></div>').html(this.buttons.imitation.disable)),a.push($('<div id="rotation" style="display: inline-block;"></div>').html(this.buttons.rotation.inactive)),a.push($('<div id="magnifying_glass" style="display: inline-block;"></div>').html(this.buttons.magnifying_glass.inactive)),a.push($('<div id="negative" style="display: inline-block;"></div>').html(this.buttons.negative.inactive)),
a.push($('<div id="film_mode" style="display: inline-block;"></div>').html(this.buttons.film_mode.inactive)),a.push($('<div id="layers" style="display: inline-block;"></div>').html(this.buttons.layers.inactive)),a.push($('<div id="measuring" style="display: inline-block;"></div>').html(this.buttons.measuring.inactive)),a.push($('<div id="hounsfield" style="display: inline-block;"></div>').html(this.buttons.hu.inactive)),a.push($('<div id="reset" style="display: inline-block;"></div>').html(this.buttons.reset.inactive)),
a.push($('<div id="close" style="display: inline-block;"></div>').html(this.buttons.close.inactive)),this.reportsState?a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.inactive)):a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.disable)),this.mailState?a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.inactive)):a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.disable))):
"landscape"===this.environment?"webgl"===this.renderType?this.isPhone?(a.push($('<div id="thumbnails_series" style="display: inline-block;"></div>').html(this.buttons.series.inactive)),a.push($('<div id="negative" style="display: inline-block;"></div>').html(this.buttons.negative.inactive)),a.push($('<div id="film_mode" style="display: inline-block;"></div>').html(this.buttons.film_mode.inactive)),a.push($('<div id="measuring" style="display: inline-block;"></div>').html(this.buttons.measuring.inactive)),
a.push($('<div id="hounsfield" style="display: inline-block;"></div>').html(this.buttons.hu.inactive)),a.push($('<div id="reset" style="display: inline-block;"></div>').html(this.buttons.reset.inactive)),a.push($('<div id="close" style="display: inline-block;"></div>').html(this.buttons.close.inactive)),this.reportsState?a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.inactive)):a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.disable)),
this.mailState?a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.inactive)):a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.disable)),a.push($('<div id="button_info_phone" style="display: inline-block; cursor: pointer; margin-top: 10px; background: #4C4C4C; padding-left: 8px; padding-right: 8px; border: 0px #F69322 solid; border-radius: 2px; color: #FFF;" data-toggle="modal" data-target="#modal"><span class="glyphicon glyphicon-info-sign"></span></div>'))):
(a.push($('<div id="thumbnails_series" style="display: inline-block;"></div>').html(this.buttons.series.inactive)),1===this.totalLayers?a.push($('<div id="imitation" style="display: inline-block;"></div>').html(this.buttons.imitation.disable)):a.push($('<div id="imitation" style="display: inline-block;"></div>').html(this.buttons.imitation.inactive)),a.push($('<div id="negative" style="display: inline-block;"></div>').html(this.buttons.negative.inactive)),a.push($('<div id="film_mode" style="display: inline-block;"></div>').html(this.buttons.film_mode.inactive)),
a.push($('<div id="layers" style="display: inline-block;"></div>').html(this.buttons.layers.inactive)),a.push($('<div id="measuring" style="display: inline-block;"></div>').html(this.buttons.measuring.inactive)),a.push($('<div id="hounsfield" style="display: inline-block;"></div>').html(this.buttons.hu.inactive)),a.push($('<div id="window_level_presets" style="display: inline-block;"></div>').html(this.buttons.presets.inactive)),a.push($('<div id="reset" style="display: inline-block;"></div>').html(this.buttons.reset.inactive)),
a.push($('<div id="close" style="display: inline-block;"></div>').html(this.buttons.close.inactive)),this.reportsState?a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.inactive)):a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.disable)),this.mailState?a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.inactive)):a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.disable))):
"canvas2d"===this.renderType&&(this.isPhone?(a.push($('<div id="thumbnails_series" style="display: inline-block;"></div>').html(this.buttons.series.inactive)),a.push($('<div id="negative" style="display: inline-block;"></div>').html(this.buttons.negative.inactive)),a.push($('<div id="film_mode" style="display: inline-block;"></div>').html(this.buttons.film_mode.inactive)),a.push($('<div id="measuring" style="display: inline-block;"></div>').html(this.buttons.measuring.inactive)),a.push($('<div id="hounsfield" style="display: inline-block;"></div>').html(this.buttons.hu.inactive)),
a.push($('<div id="reset" style="display: inline-block;"></div>').html(this.buttons.reset.inactive)),a.push($('<div id="close" style="display: inline-block;"></div>').html(this.buttons.close.inactive)),this.reportsState?a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.inactive)):a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.disable)),this.mailState?a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.inactive)):
a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.disable)),a.push($('<div id="button_info_phone" style="display: inline-block; cursor: pointer; margin-top: 10px; background: #4C4C4C; padding-left: 8px; padding-right: 8px; border: 0px #F69322 solid; border-radius: 2px; color: #FFF;" data-toggle="modal" data-target="#modal"><span class="glyphicon glyphicon-info-sign"></span></div>'))):(a.push($('<div id="thumbnails_series" style="display: inline-block;"></div>').html(this.buttons.series.inactive)),
1===this.totalLayers?a.push($('<div id="imitation" style="display: inline-block;"></div>').html(this.buttons.imitation.disable)):a.push($('<div id="imitation" style="display: inline-block;"></div>').html(this.buttons.imitation.inactive)),a.push($('<div id="negative" style="display: inline-block;"></div>').html(this.buttons.negative.inactive)),a.push($('<div id="film_mode" style="display: inline-block;"></div>').html(this.buttons.film_mode.inactive)),a.push($('<div id="layers" style="display: inline-block;"></div>').html(this.buttons.layers.inactive)),
a.push($('<div id="measuring" style="display: inline-block;"></div>').html(this.buttons.measuring.inactive)),a.push($('<div id="hounsfield" style="display: inline-block;"></div>').html(this.buttons.hu.inactive)),a.push($('<div id="reset" style="display: inline-block;"></div>').html(this.buttons.reset.inactive)),a.push($('<div id="close" style="display: inline-block;"></div>').html(this.buttons.close.inactive)),this.reportsState?a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.inactive)):
a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.disable)),this.mailState?a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.inactive)):a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.disable)))):"portrait"===this.environment&&("webgl"===this.renderType?this.isPhone?(a.push($('<div id="thumbnails_series" style="display: inline-block;"></div>').html(this.buttons.series.inactive)),
a.push($('<div id="negative" style="display: inline-block;"></div>').html(this.buttons.negative.inactive)),a.push($('<div id="film_mode" style="display: inline-block;"></div>').html(this.buttons.film_mode.inactive)),a.push($('<div id="measuring" style="display: inline-block;"></div>').html(this.buttons.measuring.inactive)),a.push($('<div id="hounsfield" style="display: inline-block;"></div>').html(this.buttons.hu.inactive)),a.push($('<div id="reset" style="display: inline-block;"></div>').html(this.buttons.reset.inactive)),
a.push($('<div id="close" style="display: inline-block;"></div>').html(this.buttons.close.inactive)),this.reportsState?a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.inactive)):a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.disable)),this.mailState?a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.inactive)):a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.disable)),
a.push($('<div style="display: table; height: 25px; float: right;"><div style="display: table-cell; vertical-align: middle;"><div id="button_info_phone" style="display: inline-block; cursor: pointer; float: right; background: #4C4C4C; padding-left: 8px; padding-right: 8px; border: 0px #F69322 solid; border-radius: 2px; color: #FFF;" data-toggle="modal" data-target="#modal"><span class="glyphicon glyphicon-info-sign"></span></div></div></div>'))):(a.push($('<div id="thumbnails_series" style="display: inline-block;"></div>').html(this.buttons.series.inactive)),
1===this.totalLayers?a.push($('<div id="imitation" style="display: inline-block;"></div>').html(this.buttons.imitation.disable)):a.push($('<div id="imitation" style="display: inline-block;"></div>').html(this.buttons.imitation.inactive)),a.push($('<div id="negative" style="display: inline-block;"></div>').html(this.buttons.negative.inactive)),a.push($('<div id="film_mode" style="display: inline-block;"></div>').html(this.buttons.film_mode.inactive)),a.push($('<div id="layers" style="display: inline-block;"></div>').html(this.buttons.layers.inactive)),
a.push($('<div id="measuring" style="display: inline-block;"></div>').html(this.buttons.measuring.inactive)),a.push($('<div id="hounsfield" style="display: inline-block;"></div>').html(this.buttons.hu.inactive)),a.push($('<div id="window_level_presets" style="display: inline-block;"></div>').html(this.buttons.presets.inactive)),a.push($('<div id="reset" style="display: inline-block;"></div>').html(this.buttons.reset.inactive)),a.push($('<div id="close" style="display: inline-block;"></div>').html(this.buttons.close.inactive)),
this.reportsState?a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.inactive)):a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.disable)),this.mailState?a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.inactive)):a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.disable)),this.infoState?a.push($('<div style="display: table; height: 30px; float: right;"><div style="display: table-cell; vertical-align: middle;"><div id="button_info" style="display: inline-block; cursor: pointer; float: right; background: #F69322; padding-left: 8px; padding-right: 8px; border: 1px #F69322 solid; border-radius: 2px; color: #FFF;">'+
MIRROR.language.globalInformation.info+"</div></div></div>")):a.push($('<div style="display: table; height: 30px; float: right;"><div style="display: table-cell; vertical-align: middle;"><div id="button_info" style="display: inline-block; cursor: pointer; float: right; background: #4C4C4C; padding-left: 8px; padding-right: 8px; border: 1px #F69322 solid; border-radius: 2px; color: #FFF;">'+MIRROR.language.globalInformation.info+"</div></div></div>"))):"canvas2d"===this.renderType&&(this.isPhone?(a.push($('<div id="thumbnails_series" style="display: inline-block;"></div>').html(this.buttons.series.inactive)),
a.push($('<div id="negative" style="display: inline-block;"></div>').html(this.buttons.negative.inactive)),a.push($('<div id="film_mode" style="display: inline-block;"></div>').html(this.buttons.film_mode.inactive)),a.push($('<div id="measuring" style="display: inline-block;"></div>').html(this.buttons.measuring.inactive)),a.push($('<div id="hounsfield" style="display: inline-block;"></div>').html(this.buttons.hu.inactive)),a.push($('<div id="reset" style="display: inline-block;"></div>').html(this.buttons.reset.inactive)),
a.push($('<div id="close" style="display: inline-block;"></div>').html(this.buttons.close.inactive)),this.reportsState?a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.inactive)):a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.disable)),this.mailState?a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.inactive)):a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.disable)),
a.push($('<div style="display: table; height: 25px; float: right;"><div style="display: table-cell; vertical-align: middle;"><div id="button_info_phone" style="display: inline-block; cursor: pointer; float: right; background: #4C4C4C; padding-left: 8px; padding-right: 8px; border: 0px #F69322 solid; border-radius: 2px; color: #FFF;" data-toggle="modal" data-target="#modal"><span class="glyphicon glyphicon-info-sign"></span></div></div></div>'))):(a.push($('<div id="thumbnails_series" style="display: inline-block;"></div>').html(this.buttons.series.inactive)),
1===this.totalLayers?a.push($('<div id="imitation" style="display: inline-block;"></div>').html(this.buttons.imitation.disable)):a.push($('<div id="imitation" style="display: inline-block;"></div>').html(this.buttons.imitation.inactive)),a.push($('<div id="negative" style="display: inline-block;"></div>').html(this.buttons.negative.inactive)),a.push($('<div id="film_mode" style="display: inline-block;"></div>').html(this.buttons.film_mode.inactive)),a.push($('<div id="layers" style="display: inline-block;"></div>').html(this.buttons.layers.inactive)),
a.push($('<div id="measuring" style="display: inline-block;"></div>').html(this.buttons.measuring.inactive)),a.push($('<div id="hounsfield" style="display: inline-block;"></div>').html(this.buttons.hu.inactive)),a.push($('<div id="reset" style="display: inline-block;"></div>').html(this.buttons.reset.inactive)),a.push($('<div id="close" style="display: inline-block;"></div>').html(this.buttons.close.inactive)),this.reportsState?a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.inactive)):
a.push($('<div id="reports" style="display: inline-block;"></div>').html(this.buttons.reports.disable)),this.mailState?a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.inactive)):a.push($('<div id="email" style="display: inline-block;"></div>').html(this.buttons.email.disable)),this.infoState?a.push($('<div style="display: table; height: 30px; float: right;"><div style="display: table-cell; vertical-align: middle;"><div id="button_info" style="display: inline-block; cursor: pointer; float: right; background: #F69322; padding-left: 8px; padding-right: 8px; border: 1px #F69322 solid; border-radius: 2px; color: #FFF;">'+
MIRROR.language.globalInformation.info+"</div></div></div>")):a.push($('<div style="display: table; height: 30px; float: right;"><div style="display: table-cell; vertical-align: middle;"><div id="button_info" style="display: inline-block; cursor: pointer; float: right; background: #4C4C4C; padding-left: 8px; padding-right: 8px; border: 1px #F69322 solid; border-radius: 2px; color: #FFF;">'+MIRROR.language.globalInformation.info+"</div></div></div>")))));for(var b=0;b<a.length;b++)$("#buttons_toolsbar").append(a[b])};
MIRROR.maker.prototype.__toolsButtonsSizeStyle=function(){if("desktop"===this.environment){$(".toolBar").each(function(){$(this).parent().css({padding:"2px"})});for(var a in this.buttons)"submenu"===this.buttons[a].where&&(this.buttons[a].inactive.css({"margin-top":"0px","margin-left":"3px"}),this.buttons[a].active.css({"margin-top":"0px","margin-left":"3px"}),this.buttons[a].disable.css({"margin-top":"0px","margin-left":"3px"}));a=$(window).height()-($("#series_toolsbar").offset().top+8);$("#series_toolsbar").height(a)}else if("landscape"===
this.environment)if(this.isPhone)for(a in $(".toolBar").each(function(){$(this).parent().css("display","block")}),this.buttons)"bar"===this.buttons[a].where?(this.buttons[a].active.css({width:"26px",height:"26px","margin-top":"1px","margin-left":"0px"}),this.buttons[a].inactive.css({width:"26px",height:"26px","margin-top":"1px","margin-left":"0px"}),this.buttons[a].disable.css({width:"26px",height:"26px","margin-top":"1px","margin-left":"0px"})):"submenu"===this.buttons[a].where&&(this.buttons[a].inactive.css({width:"40px",
height:"40px","margin-top":"0px","margin-left":"3px"}),this.buttons[a].active.css({width:"40px",height:"40px","margin-top":"0px","margin-left":"3px"}),this.buttons[a].disable.css({width:"40px",height:"40px","margin-top":"0px","margin-left":"3px"}));else for(a in this.buttons)"bar"===this.buttons[a].where?(this.buttons[a].active.css({width:"32px",height:"32px","margin-top":"3px","margin-left":"0px"}),this.buttons[a].inactive.css({width:"32px",height:"32px","margin-top":"3px","margin-left":"0px"}),
this.buttons[a].disable.css({width:"32px",height:"32px","margin-top":"3px","margin-left":"0px"})):"submenu"===this.buttons[a].where&&(this.buttons[a].inactive.css({width:"40px",height:"40px","margin-top":"0px","margin-left":"3px"}),this.buttons[a].active.css({width:"40px",height:"40px","margin-top":"0px","margin-left":"3px"}),this.buttons[a].disable.css({width:"40px",height:"40px","margin-top":"0px","margin-left":"3px"}));else if("portrait"===this.environment)if(this.isPhone)for(a in this.buttons)"bar"===
this.buttons[a].where?(this.buttons[a].active.css({width:"25px",height:"25px","margin-top":"0px","margin-left":"1px"}),this.buttons[a].inactive.css({width:"25px",height:"25px","margin-top":"0px","margin-left":"1px"}),this.buttons[a].disable.css({width:"25px",height:"25px","margin-top":"0px","margin-left":"1px"})):"submenu"===this.buttons[a].where&&(this.buttons[a].active.css({width:"40px",height:"40px","margin-top":"0px","margin-left":"3px"}),this.buttons[a].inactive.css({width:"40px",height:"40px",
"margin-top":"0px","margin-left":"3px"}),this.buttons[a].disable.css({width:"40px",height:"40px","margin-top":"0px","margin-left":"3px"}));else for(a in this.buttons)"bar"===this.buttons[a].where?(this.buttons[a].active.css({width:"32px",height:"32px","margin-top":"0px","margin-left":"3px"}),this.buttons[a].inactive.css({width:"32px",height:"32px","margin-top":"0px","margin-left":"3px"}),this.buttons[a].disable.css({width:"32px",height:"32px","margin-top":"0px","margin-left":"3px"})):"submenu"===
this.buttons[a].where&&(this.buttons[a].inactive.css({width:"40px",height:"40px","margin-top":"0px","margin-left":"3px"}),this.buttons[a].active.css({width:"40px",height:"40px","margin-top":"0px","margin-left":"3px"}),this.buttons[a].disable.css({width:"40px",height:"40px","margin-top":"0px","margin-left":"3px"}))};
MIRROR.maker.prototype.__layersSizeConfiguration=function(){1===this.totalLayers?"landscape"===this.environment?$("#layer_1").height($("#workspace").height()-6):$("#layer_1").height($("#workspace").height()-14):2===this.totalLayers&&("landscape"===this.environment?($("#layer_1").height($("#workspace").height()-6),$("#layer_2").height($("#workspace").height()-6)):($("#layer_1").removeClass("col-xs-6").addClass("col-xs-12").height($("#workspace").height()/2-10),$("#layer_2").removeClass("col-xs-6").addClass("col-xs-12").height($("#workspace").height()/
2-10)))};
MIRROR.maker.prototype.__submenu=function(a){var b="portrait"===this.environment?$('<div id="submenu" style="position: absolute; top: '+($("#toolsbar_"+this.environment).height()+20)+'px; left: 3px; background: #424242; padding: 6px; z-index: 1000; text-align: center; border-top-right-radius: 5px; border-bottom-right-radius: 5px;"></div>'):$('<div id="submenu" style="position: absolute; top: 20px; left: '+($("#toolsbar_"+this.environment).width()+3)+'px; background: #424242; padding: 6px; z-index: 1000; text-align: center; border-top-right-radius: 5px; border-bottom-right-radius: 5px;"></div>');b.html(a);
$("body").append(b);$("#series_thumbnails_submenu").perfectScrollbar();this.__checkSeriesDisplayed()};
MIRROR.maker.prototype.popup=function(a){var b;b=""+('<div id="popup" style="color: #FFF; background: #424242; padding: 20px; border-radius: 6px; text-align: center; display: table; position: absolute; top: '+$(window).height()/2+"px; left: "+$(window).width()/2+'px;">');b+='<div style="display: table-cenll; vertical-align: middle;">';"error_charging"===a&&(b+=MIRROR.language.popup.error_charging);b+="<br /><br /><br /></div>";b+='<div style="display: table-cenll; vertical-align: bottom;">';b+='<button id="button_close_popup" class="btn btn-warning">'+
MIRROR.language.popup.button_close_popup+"</button>";b+="</div>";b+="</div>";$("body").append(b);$("#popup").css({left:$(window).width()/2-$("#popup").width()/2+"px",top:$(window).height()/2-$("#popup").height()/2+"px"})};MIRROR.maker.prototype.__rendering=function(){for(var a in this.layers)this.layers[a].displayed&&null!==this.layers[a].stage&&null!==this.layers[a].renderer&&this.layers[a].render();requestAnimationFrame(this.__rendering.bind(this))};/*
   2015 Toth Limitada
 @license     {@link http://www.toth.cl}
*/
MIRROR.layer.prototype.init=function(a,b){this.__layerConfiguration(a,b);this.__commonEventsHandler();this.hounsfield=new MIRROR.hounsfield(this)};MIRROR.layer.prototype.__layerConfiguration=function(a,b){this.setLayerSize(a,b);this.renderer=PIXI.autoDetectRenderer({antialias:!0});"msie"===this.make.browser&&$("#renderers").append(this.renderer.view);this.displayed&&$("#"+this.layerId).html(MIRROR.ui.void_layer)};MIRROR.layer.prototype.setLayerSize=function(a,b){this.width=a;this.height=b};
MIRROR.layer.prototype.__setupContext=function(){this.stage=new PIXI.Container;this.stage.layer=this;this.stage.interactive=!0;var a=new PIXI.CanvasBuffer(this.width,this.height);a.context.rect(0,0,this.width,this.height);a.context.fillStyle="#000";a.context.fill();a=PIXI.Texture.fromCanvas(a.canvas);this.container=new PIXI.Sprite(a);this.filterSprite=new PIXI.Sprite(a);this.transformationSprite=new PIXI.Sprite(a);this.textureSprite=new PIXI.Sprite(a);"desktop"===this.make.environment?this.transformationSprite.addChild(this.textureSprite):
(this.pivotSprite=new PIXI.Sprite(a),this.pivotSprite.addChild(this.textureSprite),this.transformationSprite.addChild(this.pivotSprite));this.filterSprite.addChild(this.transformationSprite);this.container.addChild(this.filterSprite);"desktop"===this.make.environment&&(this.dicomInformation=new PIXI.Text("",{font:"12px Arial",fill:"#FFF"}),this.layerInformation=new PIXI.Text("",{font:"12px Arial",fill:"#FFF"}),this.container.addChild(this.dicomInformation),this.container.addChild(this.layerInformation),
this.dicomInformation.position.x=10,this.dicomInformation.position.y=5,this.layerInformation.position.x=10,this.layerInformation.position.y=this.height-80);this.stage.addChild(this.container)};MIRROR.layer.prototype.updateContext=function(){this.displayed||(this.selected=!1,null!==this.stage&&this.__destroyContext())};
MIRROR.layer.prototype.__destroyContext=function(){clearInterval(this.filmInterval);this.stage.off("mousedown");this.stage.off("mousemove");this.stage.off("mouseup");this.stage.off("rightdown");this.stage.off("rightup");this.textureSprite.destroy(!0,!1);"desktop"!==this.make.environment&&this.pivotSprite.destroy(!0,!0);this.transformationSprite.destroy(!0,!0);this.filterSprite.destroy(!0,!0);this.container.destroy(!0,!0);this.stage.destroy(!1);delete this.textureSprite;"desktop"!==this.make.environment&&
delete this.pivotSprite;delete this.transformationSprite;delete this.filterSprite;delete this.container;delete this.stage;this.transformationSprite=this.filterSprite=this.container=this.stage=null;"desktop"!==this.make.environment&&(this.pivotSprite=null);this.layerInformation=this.dicomInformation=this.textureSprite=null;"msie"===this.make.browser&&$("#renderers").append(this.renderer.view);this.renderer._lastObjectRendered=this.renderer._tempDisplayObjectParent;this.renderer.view.id=""};
MIRROR.layer.prototype.updateLayerConfiguration=function(a,b,c){this.layerId=a;this.setLayerSize(b,c);"desktop"!==this.make.environment&&null!==this.stage&&this.renderer.resize(this.width,this.height);null!==this.serieIdCharged&&null!==this.stage?(this.renderer.view.id="canvas_"+this.layerId,$("#canvas_"+this.layerId).css({position:"absolute",top:"0px",left:"0px"}),"desktop"!==this.make.environment?("msie"===this.make.browser&&$("#"+this.renderer.view.id).remove(),$("#"+this.layerId).html(this.renderer.view),
this.make.isPhone||($("#"+this.layerId).append('<div id="dicom_information_'+this.layerId+'" style="font-size: 7pt; position: absolute; left: 5px; top: 5px; color: #FFF; -webkit-user-select: none; -moz-user-select: -moz-none; -ms-user-select: none; user-select: none;"></div>'),$("#"+this.layerId).append('<div id="layer_information_'+this.layerId+'" style="font-size: 7pt; position: absolute; left: 5px; top: '+($("#"+this.layerId).height()-65)+'px; color: #FFF; -webkit-user-select: none; -moz-user-select: -moz-none; -ms-user-select: none; user-select: none;"></div>'),
this.dicomLayerInformation(),this.__dicomLayerInformationConfiguration()),this.make.negativeState?($("#"+this.layerId).css("background","#FFF"),$("#dicom_information_"+this.layerId).css("color","#000"),$("#layer_information_"+this.layerId).css("color","#000")):($("#"+this.layerId).css("background","#000"),$("#dicom_information_"+this.layerId).css("color","#FFF"),$("#layer_information_"+this.layerId).css("color","#FFF"))):("msie"===this.make.browser&&$("#"+this.renderer.view.id).remove(),$("#"+this.layerId).html(this.renderer.view),
this.__dicomLayerInformationConfiguration()),this.resizeEnd=!0,this.responsiveLayer(this.width,this.height),this.magnifyingGlass()):$("#"+this.layerId).html(MIRROR.ui.void_layer);1===this.make.totalLayers&&(this.selected=!0);this.selected&&$("#"+this.layerId).css({border:"3px solid #FCBE39"});this.selected&&1<this.make.totalLayers&&this.leadImitation&&this.make.imitationLayers&&$("#"+this.layerId).css({border:"3px solid red"});this.__commonEventsHandler()};
MIRROR.layer.prototype.applySerie=function(a,b,c){null!==this.serieIdCharged&&void 0!==this.serieIdCharged?(this.__resetContext(),this.setLayerSize(b,c),this.renderer.resize(this.width,this.height),this.__setupContext(),this.renderer.view.id="canvas_"+this.layerId,"desktop"===this.make.environment&&(this.dicomInformation.visible=!0,this.layerInformation.visible=!0),"desktop"!==this.make.environment?("msie"===this.make.browser&&$("#"+this.renderer.view.id).remove(),$("#"+this.layerId).html(this.renderer.view),
this.make.isPhone?($("#dicom_information_"+this.layerId).remove(),$("#layer_information_"+this.layerId).remove()):($("#"+this.layerId).append('<div id="dicom_information_'+this.layerId+'" style="font-size: 7pt; position: absolute; left: 5px; top: 5px; color: #FFF; -webkit-user-select: none; -moz-user-select: -moz-none; -ms-user-select: none; user-select: none;"></div>'),$("#"+this.layerId).append('<div id="layer_information_'+this.layerId+'" style="font-size: 7pt; position: absolute; left: 5px; top: '+
($("#"+this.layerId).height()-65)+'px; color: #FFF; -webkit-user-select: none; -moz-user-select: -moz-none; -ms-user-select: none; user-select: none;"></div>'),this.__dicomLayerInformationConfiguration()),this.make.negativeState?($("#"+this.layerId).css("background","#FFF"),$("#dicom_information_"+this.layerId).css("color","#000"),$("#layer_information_"+this.layerId).css("color","#000")):($("#"+this.layerId).css("background","#000"),$("#dicom_information_"+this.layerId).css("color","#FFF"),$("#layer_information_"+
this.layerId).css("color","#FFF"))):("msie"===this.make.browser&&$("#"+this.renderer.view.id).remove(),$("#"+this.layerId).html(this.renderer.view),this.__dicomLayerInformationConfiguration()),$("#canvas_"+this.layerId).css({position:"absolute",top:"0px",left:"0px"}),this.positionInSerie=0,a=new PIXI.Texture(a),this.textureSprite.texture=a,this.__contextToLayerRatio(),this.__transformsEventsHandler()):$("#"+this.layerId).html(MIRROR.ui.void_layer);this.__commonEventsHandler();this.__layerApplyTools();
this.dicomLayerInformation()};
MIRROR.layer.prototype.__contextToLayerRatio=function(){this.transformationSprite.position.x=this.renderer.width/2-this.make.load.series[this.serieIdCharged].dimensions[this.positionInSerie].columns/2;this.transformationSprite.position.y=this.renderer.height/2-this.make.load.series[this.serieIdCharged].dimensions[this.positionInSerie].rows/2;this.transformationSprite.updateTransform();var a=new PIXI.interaction.InteractionData,b=new PIXI.Point(this.renderer.width/2,this.renderer.height/2);a.getLocalPosition(this.stage,
this.globalDown,b);a.getLocalPosition(this.transformationSprite,this.localDown,b);a.getLocalPosition(this.textureSprite,this.localDownTexture,b);this.diffZoom.x=this.globalDown.x-this.localDown.x;this.diffZoom.y=this.globalDown.y-this.localDown.y;this.diffRotation.x=this.globalDown.x-this.localDownTexture.x;this.diffRotation.y=this.globalDown.y-this.localDownTexture.y;this.lastScale=this.lastResponsiveScale=this.scale*=this.__getResponsiveScale();"desktop"===this.make.environment?(this.__zooming(),
this.__rotating()):this.__mobileTransformations()};
MIRROR.layer.prototype.defaultState=function(){if(null!==this.serieIdCharged){"desktop"===this.make.environment?(this.globalDown={x:0,y:0},this.localDown={x:0,y:0},this.localDownTexture={x:0,y:0},this.globalMove={x:0,y:0},this.scale=1,this.ratio=0,this.diffZoom={x:0,y:0},this.pan={x:0,y:0},this.diffPan={x:0,y:0},this.rotate=this.rotation=0,this.diffRotation={x:0,y:0},this.__zooming(),this.__rotating(),this.__contextToLayerRatio()):(this.globalDown={x:0,y:0},this.localDown={x:0,y:0},this.localDownTexture=
{x:0,y:0},this.globalMove={x:0,y:0},this.lastScale=this.scale=1,this.diffZoom={x:0,y:0},this.pan={x:0,y:0},this.rotate=this.rotation=0,this.deltaFilter={x:1,y:1},this.brightnessCSS=this.contrastCSS=1,this.__mobileTransformations(),this.__contextToLayerRatio(),$("#canvas_"+this.layerId).css("-webkit-filter","contrast("+this.contrastCSS+") brightness("+this.brightnessCSS+") invert("+this.negativeCSS+")"));this.transformated=!1;this.transformations=[];this.resizeEnd=!1;this.positionInSerie=0;this.brightness=
1;this.diffBrightness=0;this.contrast=1;this.windowWidth=null!==this.make.load.series[this.serieIdCharged].windowWidth?this.make.load.series[this.serieIdCharged].windowWidth:null;this.windowCenter=null!==this.make.load.series[this.serieIdCharged].windowCenter?this.make.load.series[this.serieIdCharged].windowCenter:null;this.filterSprite.filters=null;"webgl"===this.make.renderType&&null!==this.windowWidth&&null!==this.windowCenter&&(this.brightness=1*(1-this.windowCenter/255),this.contrast=1*(1-this.windowWidth/
255));if(void 0!==this.make.load.series[this.serieIdCharged].serie[this.positionInSerie]){var a=new PIXI.Texture(this.make.load.series[this.serieIdCharged].serie[this.positionInSerie]);this.textureSprite.texture=a}this.navigatorBarIndex();this.__movingLocalizer();this.dicomLayerInformation()}};
MIRROR.layer.prototype.__resetContext=function(){null!==this.serieIdCharged&&("desktop"===this.make.environment?(this.globalDown={x:0,y:0},this.localDown={x:0,y:0},this.localDownTexture={x:0,y:0},this.globalMove={x:0,y:0},this.lastResponsiveScale=this.scale=1,this.ratio=0,this.diffZoom={x:0,y:0},this.pan={x:0,y:0},this.diffPan={x:0,y:0},this.rotate=this.rotation=0,this.diffRotation={x:0,y:0},this.brightness=1,this.diffBrightness=0,this.contrast=1):(this.globalDown={x:0,y:0},this.localDown={x:0,y:0},
this.localDownTexture={x:0,y:0},this.globalMove={x:0,y:0},this.lastResponsiveScale=this.lastScale=this.scale=1,this.ratio=0,this.diffZoom={x:0,y:0},this.pan={x:0,y:0},this.rotate=this.rotation=0,this.deltaFilter={x:1,y:1},this.brightnessCSS=this.contrastCSS=1),this.transformated=!1,this.transformations=[],this.resizeEnd=!1,this.positionInSerie=0,this.windowWidth=null!==this.make.load.series[this.serieIdCharged].windowWidth?this.make.load.series[this.serieIdCharged].windowWidth:null,this.windowCenter=
null!==this.make.load.series[this.serieIdCharged].windowCenter?this.make.load.series[this.serieIdCharged].windowCenter:null,"webgl"===this.make.renderType&&null!==this.windowWidth&&null!==this.windowCenter&&(this.brightness=1*(1-this.windowCenter/255),this.contrast=1*(1-this.windowWidth/255)),this.navigatorBarIndex())};
MIRROR.layer.prototype.responsiveLayer=function(a,b){1===this.make.resizeStart&&null!==this.serieIdCharged&&(this.transformationSprite.visible=!1);null!==this.stage&&(this.setLayerSize(a,b),this.renderer.resize(this.width,this.height));if("desktop"===this.make.environment){if(null!==this.serieIdCharged){this.make.load.series[this.serieIdCharged].setMultiplierPaddingNavigatorBar();$("#navigator_bar_"+this.layerId).height(this.make.load.series[this.serieIdCharged].totalCharging*this.make.load.series[this.serieIdCharged].multiplierPaddingNavigatorBar);
$("#navigator_bar_index_"+this.layerId).css({top:this.positionInSerie*this.make.load.series[this.serieIdCharged].multiplierPaddingNavigatorBar+"px"});var c=new PIXI.CanvasBuffer(this.width,this.height);c.context.rect(0,0,this.width,this.height);this.make.negativeState?(c.context.fillStyle="rgba(255, 255, 255, 1)",$("#"+this.layerId).css("background","#FFF"),this.dicomInformation.style={font:"12px Arial",fill:"#000"},this.layerInformation.style={font:"12px Arial",fill:"#000"}):(c.context.fillStyle=
"rgba(0, 0, 0, 1)",$("#"+this.layerId).css("background","#000"),this.dicomInformation.style={font:"12px Arial",fill:"#FFF"},this.layerInformation.style={font:"12px Arial",fill:"#FFF"});c.context.fill();c=PIXI.Texture.fromCanvas(c.canvas);this.transformationSprite.texture=c;this.filterSprite.texture=c;this.container.texture=c;if(this.resizeEnd){this.transformationSprite.visible=!0;this.globalDown={x:0,y:0};this.localDown=new PIXI.Point(0,0);this.localDownTexture=new PIXI.Point(0,0);this.globalMove=
{x:0,y:0};this.scale=1;this.ratio=0;this.diffZoom={x:0,y:0};this.pan={x:0,y:0};this.diffPan={x:0,y:0};this.rotation=0;this.diffRotation={x:0,y:0};this.__zooming();this.__rotating();this.__contextToLayerRatio();c=new PIXI.interaction.InteractionData;if(this.transformated)for(var d=0;d<this.transformations.length;d++){var e=this.renderer.width/this.transformations[d].lastRendererWidth,g=this.renderer.height/this.transformations[d].lastRendererHeight;if("zoom"===this.transformations[d].type){var f=new PIXI.Point(this.transformations[d].globalDown.x*
e,this.transformations[d].globalDown.y*g);c.getLocalPosition(this.stage,this.globalDown,f);c.getLocalPosition(this.transformationSprite,this.localDown,f);this.diffZoom.x=this.globalDown.x-this.localDown.x;this.diffZoom.y=this.globalDown.y-this.localDown.y;this.scale*=this.transformations[d].ratioAccumulated;this.__zooming()}else"pan"===this.transformations[d].type?(f=new PIXI.Point(this.transformations[d].globalDown.x*e,this.transformations[d].globalDown.y*g),e=new PIXI.Point(this.transformations[d].globalMove.x*
e,this.transformations[d].globalMove.y*g),c.getLocalPosition(this.stage,this.globalDown,f),c.getLocalPosition(this.stage,this.globalMove,e),c.getLocalPosition(this.transformationSprite,this.localDown,f),this.diffPan.x=this.globalDown.x-this.localDown.x,this.diffPan.y=this.globalDown.y-this.localDown.y,this.pan.x=this.globalMove.x-this.globalDown.x,this.pan.y=this.globalMove.y-this.globalDown.y,this.__panning()):"rotation"===this.transformations[d].type&&(f=new PIXI.Point(this.transformations[d].globalDown.x*
e,this.transformations[d].globalDown.y*g),c.getLocalPosition(this.stage,this.globalDown,f),c.getLocalPosition(this.textureSprite,this.localDownTexture,f),this.diffRotation.x=this.globalDown.x-this.localDownTexture.x,this.diffRotation.y=this.globalDown.y-this.localDownTexture.y,this.rotation=this.transformations[d].rotation,this.__rotating())}this.resizeEnd=!1}this.__dicomLayerInformationConfiguration()}}else null!==this.serieIdCharged&&(this.resizeEnd&&(this.transformationSprite.visible=!0,this.globalDown=
{x:0,y:0},this.localDown=new PIXI.Point(0,0),this.localDownTexture=new PIXI.Point(0,0),this.lastScale=this.scale,this.scale=1,this.ratio=0,this.pan={x:0,y:0},this.rotation=0,this.diffZoom={x:0,y:0},this.__mobileTransformations(),this.__contextToLayerRatio(),c=new PIXI.interaction.InteractionData,this.transformated&&(e=this.renderer.width/this.transformations[0].lastRendererWidth,g=this.renderer.height/this.transformations[0].lastRendererHeight,f=new PIXI.Point(this.transformations[0].globalDown.x*
e,this.transformations[0].globalDown.y*g),c.getLocalPosition(this.stage,this.globalDown,f),c.getLocalPosition(this.transformationSprite,this.localDown,f),c.getLocalPosition(this.textureSprite,this.localDownTexture,f),this.diffZoom.x=this.globalDown.x-this.localDown.x,this.diffZoom.y=this.globalDown.y-this.localDown.y,this.pan=this.transformations[0].pan,this.scale=this.transformations[0].scale,this.rotation=this.transformations[0].rotation,this.__mobileTransformations()),this.resizeEnd=!1),this.__dicomLayerInformationConfiguration())};
MIRROR.layer.prototype.__getResponsiveScale=function(){var a=this.make.load.series[this.serieIdCharged].dimensions[this.positionInSerie].columns,b=this.make.load.series[this.serieIdCharged].dimensions[this.positionInSerie].rows,c=this.renderer.width,d=this.renderer.height;if(a>b){if(c>=d)return d/b;if(c<d)return c/a}else if(a<b){if(c>=d)return d/b;if(c<d)return c/a}else if(a===b){if(c>=d)return d/b;if(c<d)return c/a}};
MIRROR.layer.prototype.__layerApplyTools=function(){this.make.negativeState&&this.negative();this.make.magnifyingGlassState&&this.magnifyingGlass();this.make.filmModeState&&this.filmMode();this.make.measuringSegmentState&&this.commonMeasuring();this.make.measuringAngleState&&this.commonMeasuring();this.make.measuringAreaState&&this.commonMeasuring();this.make.windowLevelPresetsDefaultState&&this.windowLevelPresets("default");this.make.windowLevelPresetsBoneState&&this.windowLevelPresets("bone");this.make.windowLevelPresetsAbdomenState&&
this.windowLevelPresets("abdomen");this.make.windowLevelPresetsAngioState&&this.windowLevelPresets("angio");this.make.windowLevelPresetsBrainState&&this.windowLevelPresets("brain");this.make.windowLevelPresetsChestState&&this.windowLevelPresets("chest");this.make.windowLevelPresetsLungsState&&this.windowLevelPresets("lungs")};
MIRROR.layer.prototype.dicomLayerInformation=function(){if("desktop"===this.make.environment){var a="";null!==this.make.load.series[this.serieIdCharged].patientName&&(a+=MIRROR.language.dicomInformation.patient_name+": "+this.make.load.series[this.serieIdCharged].patientName+"\n");null!==this.make.load.series[this.serieIdCharged].patientRut&&(a+=MIRROR.language.dicomInformation.dni_age+": "+this.make.load.series[this.serieIdCharged].patientRut+"\n");null!==this.make.load.series[this.serieIdCharged].patientSex&&
(a+=MIRROR.language.dicomInformation.sex+": "+this.make.load.series[this.serieIdCharged].patientSex+"\n");null!==this.make.load.studyDescription&&(a+=MIRROR.language.dicomInformation.study_desc+": "+this.make.load.studyDescription+"\n");null!==this.make.load.series[this.serieIdCharged].serieDescription&&(a+=MIRROR.language.dicomInformation.serie_desc+": "+this.make.load.series[this.serieIdCharged].serieDescription+"\n");null!==this.make.load.series[this.serieIdCharged].serieBodyPart&&(a+=MIRROR.language.dicomInformation.body_part+
": "+this.make.load.series[this.serieIdCharged].serieBodyPart+"\n");null!==this.make.load.series[this.serieIdCharged].serieName&&(a+=MIRROR.language.dicomInformation.serie_name+": "+this.make.load.series[this.serieIdCharged].serieName+"\n");null!==this.make.load.series[this.serieIdCharged].modality&&(a+=MIRROR.language.dicomInformation.modality+": "+this.make.load.series[this.serieIdCharged].modality+"\n");null!==this.make.load.series[this.serieIdCharged].institution&&(a+=MIRROR.language.dicomInformation.institution+
": "+this.make.load.series[this.serieIdCharged].institution);null!==this.dicomInformation&&(this.dicomInformation.text=a);var a="",b=2;null!==this.serieIdCharged&&(null!==this.windowCenter&&null!==this.windowWidth?a+="WC: "+this.windowCenter.toFixed(2)+" / WW: "+this.windowWidth.toFixed(2)+"\n":b=5);a+=MIRROR.language.layerInformation.brightness+": "+this.brightness.toFixed(2)+" / "+MIRROR.language.layerInformation.contrast+": "+this.contrast.toFixed(b)+"\n";a+=MIRROR.language.layerInformation.scale+
": "+this.scale.toFixed(2)+" / "+MIRROR.language.layerInformation.angle+": "+this.rotation.toFixed(2)+" [rad]\n";a+=MIRROR.language.layerInformation.images+": "+(this.positionInSerie+1)+" / "+this.make.load.series[this.serieIdCharged].totalCharging+"\n";null!==this.serieIdCharged&&null!==this.make.load.series[this.serieIdCharged].sliceThickness&&4<this.make.load.series[this.serieIdCharged].slicePosition.length&&(a+=MIRROR.language.layerInformation.thickness+": "+this.make.load.series[this.serieIdCharged].sliceThickness.toFixed(2)+
" [mm] / "+MIRROR.language.layerInformation.slice_position+": "+this.make.load.series[this.serieIdCharged].slicePosition[this.positionInSerie].toFixed(2)+" [mm]");null!==this.layerInformation&&(this.layerInformation.text=a)}else a="",null!==this.make.load.series[this.serieIdCharged].patientName&&(a+=MIRROR.language.dicomInformation.patient_name+": "+this.make.load.series[this.serieIdCharged].patientName+"<br />"),null!==this.make.load.series[this.serieIdCharged].patientRut&&(a+=MIRROR.language.dicomInformation.dni_age+
": "+this.make.load.series[this.serieIdCharged].patientRut+"<br />"),null!==this.make.load.series[this.serieIdCharged].patientSex&&(a+=MIRROR.language.dicomInformation.sex+": "+this.make.load.series[this.serieIdCharged].patientSex+"<br />"),null!==this.make.load.studyDescription&&(a+=MIRROR.language.dicomInformation.study_desc+": "+this.make.load.studyDescription+"<br />"),null!==this.make.load.series[this.serieIdCharged].serieDescription&&(a+=MIRROR.language.dicomInformation.serie_desc+": "+this.make.load.series[this.serieIdCharged].serieDescription+
"<br />"),null!==this.make.load.series[this.serieIdCharged].serieBodyPart&&(a+=MIRROR.language.dicomInformation.body_part+": "+this.make.load.series[this.serieIdCharged].serieBodyPart+"<br />"),null!==this.make.load.series[this.serieIdCharged].serieName&&(a+=MIRROR.language.dicomInformation.serie_name+": "+this.make.load.series[this.serieIdCharged].serieName+"<br />"),null!==this.make.load.series[this.serieIdCharged].modality&&(a+=MIRROR.language.dicomInformation.modality+": "+this.make.load.series[this.serieIdCharged].modality+
"<br />"),null!==this.make.load.series[this.serieIdCharged].institution&&(a+=MIRROR.language.dicomInformation.institution+": "+this.make.load.series[this.serieIdCharged].institution),$("#dicom_information_"+this.layerId).html(a),a="",null!==this.serieIdCharged&&null!==this.windowCenter&&null!==this.windowWidth&&(a+="WC: "+this.windowCenter.toFixed(2)+" / WW: "+this.windowWidth.toFixed(2)+"<br />"),a+=MIRROR.language.layerInformation.brightness+": "+this.brightnessCSS.toFixed(2)+" / "+MIRROR.language.layerInformation.contrast+
": "+this.contrastCSS.toFixed(2)+"<br />",a+=MIRROR.language.layerInformation.scale+": "+this.scale.toFixed(2)+" / "+MIRROR.language.layerInformation.angle+": "+this.rotation.toFixed(2)+" [rad]<br />",a+=MIRROR.language.layerInformation.images+": "+(this.positionInSerie+1)+" / "+this.make.load.series[this.serieIdCharged].totalCharging+"<br />",null!==this.serieIdCharged&&null!==this.make.load.series[this.serieIdCharged].sliceThickness&&4<this.make.load.series[this.serieIdCharged].slicePosition.length&&
(a+=MIRROR.language.layerInformation.thickness+": "+this.make.load.series[this.serieIdCharged].sliceThickness.toFixed(2)+" [mm] / "+MIRROR.language.layerInformation.slice_position+": "+this.make.load.series[this.serieIdCharged].slicePosition[this.positionInSerie].toFixed(2)+" [mm]"),$("#layer_information_"+this.layerId).html(a)};
MIRROR.layer.prototype.__dicomLayerInformationConfiguration=function(){if(null!==this.stage){var a=3;null!==this.make.load.series[this.serieIdCharged].sliceThickness&&4<this.make.load.series[this.serieIdCharged].slicePosition.length&&a++;null!==this.windowCenter&&null!==this.windowWidth&&a++;"desktop"===this.make.environment?(400<this.height?(this.container.addChild(this.dicomInformation),this.container.addChild(this.layerInformation)):(this.container.removeChild(this.dicomInformation),this.container.removeChild(this.layerInformation)),
5===a?this.layerInformation.position.y=this.renderer.height-80:4===a?this.layerInformation.position.y=this.renderer.height-62:3===a&&(this.layerInformation.position.y=this.renderer.height-52)):5===a?$("#layer_information_"+this.layerId).css("top",$("#"+this.layerId).height()-65+"px"):4===a?$("#layer_information_"+this.layerId).css("top",$("#"+this.layerId).height()-55+"px"):3===a&&$("#layer_information_"+this.layerId).css("top",$("#"+this.layerId).height()-45+"px");this.displayDicomLayerInformation()}};
MIRROR.layer.prototype.displayDicomLayerInformation=function(){null!==this.stage&&("desktop"===this.make.environment?this.make.infoState?(this.dicomInformation.visible=!0,this.layerInformation.visible=!0):(this.dicomInformation.visible=!1,this.layerInformation.visible=!1):this.make.infoState?($("#dicom_information_"+this.layerId).css("display","block"),$("#layer_information_"+this.layerId).css("display","block")):($("#dicom_information_"+this.layerId).css("display","none"),$("#layer_information_"+
this.layerId).css("display","none")))};
MIRROR.layer.prototype.navigatorBar=function(){var a=0,b=0,c=0,d=0;null!==this.serieIdCharged&&(a=this.make.load.series[this.serieIdCharged].totalCharging*this.make.load.series[this.serieIdCharged].multiplierPaddingNavigatorBar,b=this.make.load.series[this.serieIdCharged].multiplierPaddingNavigatorBar,borderBottom=3>b?d=2:d=0,c=this.positionInSerie*this.make.load.series[this.serieIdCharged].multiplierPaddingNavigatorBar);return"portrait"!==this.make.environment?'<div id="navigator_bar_'+this.layerId+
'" style="position:relative; background: #A09F9F; width: 100%; height: '+a+'px;"><div id="navigator_bar_index_'+this.layerId+'" style="position: absolute; left: 0px; top: '+c+"px; background: #F69322; width: 100%; height: "+b+"px; border-top: "+d+"px solid #F69322; border-bottom: "+borderBottom+'px solid #F69322;"></div></div>':'<div id="navigator_bar_'+this.layerId+'" style="position:relative; background: #A09F9F; height: 100%; width: '+a+'px;"><div id="navigator_bar_index_'+this.layerId+'" style="position: absolute; left: '+
c+"px; top: 0px; background: #F69322; width: "+b+"px; height: 100%; border-left: "+d+"px solid #F69322; border-right: "+borderBottom+'px solid #F69322;"></div></div>'};
MIRROR.layer.prototype.navigatorBarIndex=function(){0<$("#navigator_bar_index_"+this.layerId).length&&("portrait"!==this.make.environment?$("#navigator_bar_index_"+this.layerId).css({top:this.positionInSerie*this.make.load.series[this.serieIdCharged].multiplierPaddingNavigatorBar+"px"}):$("#navigator_bar_index_"+this.layerId).css({left:this.positionInSerie*this.make.load.series[this.serieIdCharged].multiplierPaddingNavigatorBar+"px"}))};
MIRROR.layer.prototype.magnifyingGlass=function(){var a=this;if(a.selected&&a.displayed&&null!==a.serieIdCharged)if(a.make.magnifyingGlassState){var b=document.createElement("canvas"),c=b.getContext("2d"),d=document.getElementById(a.layerId),e=null,g=0,f=new PIXI.RenderTexture(a.renderer,a.renderer.width,a.renderer.height);b.setAttribute("id","canvas_magnifying_glass_"+a.layerId);d.appendChild(b);b.width=a.renderer.width;b.height=a.renderer.height;b.style.zIndex=100;b.style.position="absolute";b.style.left=
"0px";b.style.top="0px";1===a.make.totalLayers?g=150:2===a.make.totalLayers?g=110:3!==a.make.totalLayers||"layer_1"!==a.layerId&&"layer_2"!==a.layerId?3===a.make.totalLayers&&"layer_3"===a.layerId?g=110:4===a.make.totalLayers&&(g=80):g=80;$("#"+a.layerId).on("mousemove",function(d){c.clearRect(0,0,b.width,b.height);var k=d.clientX-$(this).offset().left;d=d.clientY-$(this).offset().top;c.save();c.beginPath();c.arc(k,d,g,0,2*Math.PI,!0);c.fill();c.lineWidth=10;c.strokeStyle="#D58512";c.stroke();c.closePath();
c.clip();f.render(a.filterSprite);e=f.getCanvas();c.drawImage(e,2*-k,2*-d,3*a.renderer.width,3*a.renderer.height);c.beginPath();c.arc(k,d,g,0,2*Math.PI,!0);c.lineWidth=2;c.strokeStyle="#D58512";c.stroke();c.closePath();c.restore()})}else $("#"+a.layerId).unbind("mousemove"),$("#canvas_magnifying_glass_"+a.layerId).remove()};
MIRROR.layer.prototype.negative=function(){this.selected&&this.displayed&&null!==this.serieIdCharged&&("desktop"!==this.make.environment?(this.make.negativeState?(this.negativeCSS=1,$("#"+this.layerId).css("background","#FFF"),$("#dicom_information_"+this.layerId).css("color","#000"),$("#layer_information_"+this.layerId).css("color","#000")):(this.negativeCSS=0,$("#"+this.layerId).css("background","#000"),$("#dicom_information_"+this.layerId).css("color","#FFF"),$("#layer_information_"+this.layerId).css("color",
"#FFF")),$("#canvas_"+this.layerId).css("-webkit-filter","contrast("+this.contrastCSS+") brightness("+this.brightnessCSS+") invert("+this.negativeCSS+")")):this.__filtering())};
MIRROR.layer.prototype.filmMode=function(){var a=this;this.selected&&this.displayed&&null!==this.serieIdCharged&&(clearInterval(a.filmInterval),a.filmInterval=setInterval(function(){a.make.filmModeState?(a.moveInSerie(-1),a.positionInSerie>=a.make.load.series[a.serieIdCharged].totalCharging-1&&(a.positionInSerie=0)):clearInterval(a.filmInterval)},null!==a.make.load.series[a.serieIdCharged].frameTime?a.make.load.series[a.serieIdCharged].frameTime:50))};
MIRROR.layer.prototype.commonMeasuring=function(){this.selected&&this.displayed&&null!==this.serieIdCharged&&(null===this.measuring&&(this.measuring=new MIRROR.measuring(this)),this.make.measuringState?(this.measuring.findLastUndoneShapes(),this.measuring.initializedTriggered()):($("#canvas_measuring_"+this.layerId).unbind("mousedown"),$("#canvas_measuring_"+this.layerId).unbind("mousemove"),$("#canvas_measuring_"+this.layerId).unbind("mouseup"),$("#canvas_measuring_"+this.layerId).unbind("touchstart"),
$("#canvas_measuring_"+this.layerId).unbind("touchmove"),$("#canvas_measuring_"+this.layerId).unbind("touchend"),$("#canvas_measuring_"+this.layerId).remove(),$("#"+this.layerId+" h5").remove(),this.measuring=null))};
MIRROR.layer.prototype.windowLevelPresets=function(a){if(this.selected&&this.displayed&&null!==this.serieIdCharged&&null!==this.make.load.series[this.serieIdCharged].windowWidth&&null!==this.make.load.series[this.serieIdCharged].windowCenter){switch(a){case "default":this.windowWidth=this.make.load.series[this.serieIdCharged].windowWidth;this.windowCenter=this.make.load.series[this.serieIdCharged].windowCenter;break;case "bone":this.windowWidth=1500;this.windowCenter=300;break;case "abdomen":this.windowWidth=
400;this.windowCenter=60;break;case "angio":this.windowWidth=600;this.windowCenter=300;break;case "brain":this.windowWidth=80;this.windowCenter=40;break;case "chest":this.windowWidth=400;this.windowCenter=40;break;case "lungs":this.windowWidth=1500,this.windowCenter=-400}this.brightness=1*(1-this.windowCenter/255);this.contrast=1*(1-this.windowWidth/255);this.__filtering()}};
MIRROR.layer.prototype.__transformsImitation=function(a,b){for(var c in this.make.layers)if(c!==this.layerId&&this.make.layers[c].displayed&&this.make.layers[c].selected)if(1===a)if(this.make.rotationState){if(this.make.layers[c].globalDown=this.globalDown,this.make.layers[c].localDownTexture=this.localDownTexture,this.make.layers[c].diffRotation=this.diffRotation,this.make.layers[c].rotation+=this.rotate,this.make.layers[c].__rotating(),"up"===b){var d=this.make.layers[c].globalDown,e=this.make.layers[c].rotation,
g=this.make.layers[c].renderer.width,f=this.make.layers[c].renderer.height,d={type:"rotation",globalDown:d,rotation:e,lastRendererWidth:g,lastRendererHeight:f};this.make.layers[c].transformations.push(d);this.make.layers[c].transformated=!0}}else this.make.rotationState||(this.make.layers[c].globalDown=this.globalDown,this.make.layers[c].globalMove=this.globalMove,"webgl"===this.make.renderType?(null!==this.make.layers[c].windowWidth&&null!==this.make.layers[c].windowCenter?(this.make.layers[c].brightness+=
(this.globalMove.x-this.globalDown.x)/100,this.make.layers[c].contrast+=(this.globalMove.y-this.globalDown.y)/100,this.make.layers[c].windowCenter=255*(1-this.brightness/1),this.make.layers[c].windowWidth=255*(1-this.contrast/1)):(this.make.layers[c].diffBrightness+=this.make.layers[c].globalMove.y-this.make.layers[c].globalDown.y,this.make.layers[c].contrast+=(this.make.layers[c].globalMove.x-this.make.layers[c].globalDown.x)/1E5,this.make.layers[c].brightness=1+Math.min(1E3,Math.max(-150,this.make.layers[c].diffBrightness))/
150,this.make.layers[c].contrast=Math.max(1,Math.min(this.make.layers[c].contrast,10))),this.make.layers[c].brightness+=(this.globalMove.x-this.globalDown.x)/100,this.make.layers[c].contrast+=(this.globalMove.y-this.globalDown.y)/100,this.make.layers[c].windowCenter=255*(1-this.brightness/1),this.make.layers[c].windowWidth=255*(1-this.contrast/1)):"canvas2d"===this.make.renderType&&(this.make.layers[c].diffBrightness+=this.make.layers[c].globalMove.y-this.make.layers[c].globalDown.y,this.make.layers[c].contrast+=
(this.make.layers[c].globalMove.x-this.make.layers[c].globalDown.x)/1E4,this.make.layers[c].brightness=1+Math.min(1E3,Math.max(-150,this.make.layers[c].diffBrightness))/150,this.make.layers[c].contrast=Math.max(1,Math.min(this.make.layers[c].contrast,10))),this.make.layers[c].__filtering());else if(2===a)this.make.layers[c].globalDown=this.globalDown,this.make.layers[c].localDown=this.localDown,this.make.layers[c].globalMove=this.globalMove,this.make.layers[c].pan=this.pan,this.make.layers[c].diffPan=
this.diffPan,this.make.layers[c].__panning(),"up"===b&&(d=this.make.layers[c].globalDown,e=this.make.layers[c].globalMove,g=this.make.layers[c].renderer.width,f=this.make.layers[c].renderer.height,d={type:"pan",globalDown:d,globalMove:e,lastRendererWidth:g,lastRendererHeight:f},this.make.layers[c].transformations.push(d),this.make.layers[c].transformated=!0);else if(3===a)this.make.layers[c].globalDown=this.globalDown,this.make.layers[c].localDown=this.localDown,this.make.layers[c].diffZoom=this.diffZoom,
this.make.layers[c].scale=this.scale,this.make.layers[c].ratioAccumulated=this.ratioAccumulated,this.make.layers[c].__zooming(),"up"===b&&(d=this.make.layers[c].globalDown,e=this.make.layers[c].ratioAccumulated,g=this.make.layers[c].renderer.width,f=this.make.layers[c].renderer.height,d={type:"zoom",globalDown:d,ratioAccumulated:e,lastRendererWidth:g,lastRendererHeight:f},this.make.layers[c].transformations.push(d),this.make.layers[c].transformated=!0,this.make.layers[c].ratioAccumulated=1);else if(4===
a)this.make.layers[c].moveInSerie(b);else if(5===a)this.make.layers[c].globalDown.x=this.globalDown.x,this.make.layers[c].globalDown.y=this.globalDown.y,this.make.layers[c].globalMove.x=this.globalMove.x,this.make.layers[c].globalMove.y=this.globalMove.y,this.make.layers[c].deltaFilter.x+=(this.make.layers[c].globalMove.x-this.make.layers[c].globalDown.x)/100,this.make.layers[c].deltaFilter.y+=(this.make.layers[c].globalMove.y-this.make.layers[c].globalDown.y)/100,this.make.layers[c].contrastCSS=
Math.max(1,Math.min(this.make.layers[c].deltaFilter.x,10)),this.make.layers[c].brightnessCSS=Math.max(0,Math.min(this.make.layers[c].deltaFilter.y,10)),$("#canvas_"+c).css("-webkit-filter","contrast("+this.make.layers[c].contrastCSS+") brightness("+this.make.layers[c].brightnessCSS+") invert("+this.make.layers[c].negativeCSS+")"),this.make.layers[c].dicomLayerInformation();else if(6===a&&(this.make.layers[c].globalDown=this.globalDown,this.make.layers[c].localDown=this.localDown,this.make.layers[c].localDownTexture=
this.localDownTexture,this.make.layers[c].globalMove=this.globalMove,this.make.layers[c].diffZoom=this.diffZoom,this.make.layers[c].pan=this.pan,this.make.layers[c].scale=this.scale,this.make.layers[c].lastScale=this.lastScale,this.make.layers[c].rotation=this.rotation,this.make.layers[c].rotate=this.rotate,this.make.layers[c].__mobileTransformations(),"end"===b)){var d=this.make.layers[c].globalDown,e=this.make.layers[c].rotation,h=this.make.layers[c].rotate,k=this.make.layers[c].pan,n=this.make.layers[c].scale,
l=this.make.layers[c].lastScale,g=this.make.layers[c].renderer.width,f=this.make.layers[c].renderer.height,d={globalDown:d,rotation:e,rotate:h,pan:k,scale:n,lastScale:l,lastRendererWidth:g,lastRendererHeight:f};this.make.layers[c].transformations[0]=d;this.make.layers[c].transformated=!0}};
MIRROR.layer.prototype.__transformsEventsHandler=function(){var a=this;if("desktop"===a.make.environment)a.stage.off("mousedown"),a.stage.off("mouseup"),a.stage.off("rightdown"),a.stage.off("rightup"),a.stage.on("mousedown",a.__downActions),a.stage.on("mouseup",a.__upActions),a.stage.on("rightdown",a.__downActions),a.stage.on("rightup",a.__upActions);else{a.stage.off("touchstart");a.stage.off("touchend");a.stage.on("touchstart",a.__touchStartActions);a.stage.on("touchend",a.__touchEndActions);var b=
document.getElementById("canvas_"+a.layerId);a.hammerManager=new Hammer.Manager(b);a.hammerManager.add(new Hammer.Rotate({threshold:0}));a.hammerManager.add(new Hammer.Pinch({threshold:0})).recognizeWith(a.hammerManager.get("rotate"));a.hammerManager.off("pinchstart pinchmove pinchend");a.hammerManager.on("pinchstart pinchmove",function(b){a.scale=Math.max(.1,Math.min(a.lastScale*b.scale,100))});a.hammerManager.on("pinchend",function(){a.lastScale=a.scale});a.hammerManager.off("rotatestart rotatemove rotateend");
a.hammerManager.on("rotatestart rotatemove",function(b){a.rotation=a.rotate+b.rotation/100});a.hammerManager.on("rotateend",function(){a.rotate=a.rotation})}};
MIRROR.layer.prototype.__downActions=function(a){var b=this.layer;b.make.hounsfieldState&&b.hounsfield.isSomeToolSelected()?b.hounsfield.__pressAction(a):(1===a.data.originalEvent.which&&b.selected?(b.make.rotationState?(b.globalDown=a.data.getLocalPosition(this),b.localDownTexture=a.data.getLocalPosition(b.textureSprite),b.lastY=a.data.getLocalPosition(this).y,b.diffRotation.x=b.globalDown.x-b.localDownTexture.x,b.diffRotation.y=b.globalDown.y-b.localDownTexture.y):b.globalDown=a.data.getLocalPosition(this),
b.eventWhich=1):2===a.data.originalEvent.which&&b.selected?(b.globalDown=a.data.getLocalPosition(this),b.localDown=a.data.getLocalPosition(b.transformationSprite),b.diffPan.x=b.globalDown.x-b.localDown.x,b.diffPan.y=b.globalDown.y-b.localDown.y,b.eventWhich=2):3===a.data.originalEvent.which&&b.selected&&(b.globalDown=a.data.getLocalPosition(this),b.localDown=a.data.getLocalPosition(b.transformationSprite),b.lastY=a.data.getLocalPosition(this).y,b.diffZoom.x=b.globalDown.x-b.localDown.x,b.diffZoom.y=
b.globalDown.y-b.localDown.y,b.eventWhich=3),this.on("mousemove",b.__moveActions))};
MIRROR.layer.prototype.__moveActions=function(a){var b=this.layer;if(1===b.eventWhich&&b.selected)b.make.rotationState?(a=a.data.getLocalPosition(this).y,b.rotate=(a-b.lastY)/200,b.rotation+=b.rotate,b.make.imitationLayers&&b.leadImitation&&b.__transformsImitation(1),b.__rotating(),b.lastY=a):(b.globalMove=a.data.getLocalPosition(this),"webgl"===b.make.renderType?null!==b.windowWidth&&null!==b.windowCenter?(b.brightness+=(b.globalMove.x-b.globalDown.x)/100,b.contrast+=(b.globalMove.y-b.globalDown.y)/
100,b.windowCenter=255*(1-b.brightness/1),b.windowWidth=255*(1-b.contrast/1)):(b.diffBrightness+=b.globalMove.y-b.globalDown.y,b.contrast+=(b.globalMove.x-b.globalDown.x)/1E5,b.brightness=1+Math.min(1E3,Math.max(-150,b.diffBrightness))/150,b.contrast=Math.max(1,Math.min(b.contrast,10))):"canvas2d"===b.make.renderType&&"desktop"===b.make.environment&&(b.diffBrightness+=b.globalMove.y-b.globalDown.y,b.contrast+=(b.globalMove.x-b.globalDown.x)/100,b.brightness=1+Math.min(1E3,Math.max(-150,b.diffBrightness))/
150,b.contrast=Math.max(1,Math.min(b.contrast,10))),b.make.imitationLayers&&b.leadImitation&&b.__transformsImitation(1),b.__filtering(),b.globalDown.x=b.globalMove.x,b.globalDown.y=b.globalMove.y);else if(2===b.eventWhich&&b.selected)b.globalMove=a.data.getLocalPosition(this),b.pan.x=b.globalMove.x-b.globalDown.x,b.pan.y=b.globalMove.y-b.globalDown.y,b.make.imitationLayers&&b.leadImitation&&b.__transformsImitation(2),b.__panning();else if(3===b.eventWhich&&b.selected){a=a.data.getLocalPosition(this).y;
var c=Math.abs(a-b.lastY)/1E3;b.ratio=b.lastY>a?1.03+c:.97-c;b.scale*=b.ratio;b.ratioAccumulated*=b.ratio;b.make.imitationLayers&&b.leadImitation&&b.__transformsImitation(3);b.__zooming();b.lastY=a}};
MIRROR.layer.prototype.__upActions=function(a){var b=this.layer;this.off("mousemove",b.__moveActions);if(b.make.hounsfieldState&&b.hounsfield.isSomeToolSelected())b.hounsfield.__releaseAction(a);else if(1===a.data.originalEvent.which&&b.selected){a=b.globalDown;var c=b.renderer.width,d=b.renderer.height;a={type:"rotation",globalDown:a,rotation:b.rotation,lastRendererWidth:c,lastRendererHeight:d};b.transformations.push(a);b.transformated=!0;b.make.imitationLayers&&b.leadImitation&&b.__transformsImitation(1,
"up")}else if(2===a.data.originalEvent.which&&b.selected){a=b.globalDown;var e=b.globalMove,c=b.renderer.width,d=b.renderer.height;a={type:"pan",globalDown:a,globalMove:e,lastRendererWidth:c,lastRendererHeight:d};b.transformations.push(a);b.transformated=!0;b.make.imitationLayers&&b.leadImitation&&b.__transformsImitation(2,"up")}else 3===a.data.originalEvent.which&&b.selected&&(a=b.globalDown,e=b.ratioAccumulated,c=b.renderer.width,d=b.renderer.height,a={type:"zoom",globalDown:a,ratioAccumulated:e,
lastRendererWidth:c,lastRendererHeight:d},b.transformations.push(a),b.transformated=!0,b.make.imitationLayers&&b.leadImitation&&b.__transformsImitation(3,"up"),b.ratioAccumulated=1)};
MIRROR.layer.prototype.__touchStartActions=function(a){var b=this.layer;if(b.make.hounsfieldState&&b.hounsfield.isSomeToolSelected())b.hounsfield.__pressAction(a);else{switch(a.data.originalEvent.touches.length){case 1:b.globalDown.x=a.data.originalEvent.touches[0].pageX;b.globalDown.y=a.data.originalEvent.touches[0].pageY;break;case 2:var c={},d=new PIXI.Point,e=new PIXI.Point;b.renderer.plugins.interaction.mapPositionToPoint(d,a.data.originalEvent.touches[0].pageX,a.data.originalEvent.touches[0].pageY);
b.renderer.plugins.interaction.mapPositionToPoint(e,a.data.originalEvent.touches[1].pageX,a.data.originalEvent.touches[1].pageY);c.x=(d.x+e.x)/2;c.y=(d.y+e.y)/2;a.data.getLocalPosition(this,b.globalDown,c);a.data.getLocalPosition(b.transformationSprite,b.localDown,c);a.data.getLocalPosition(b.textureSprite,b.localDownTexture,c);b.diffZoom.x=b.globalDown.x-b.localDown.x;b.diffZoom.y=b.globalDown.y-b.localDown.y;b.eventWhich=2;break;case 3:b.globalDown.x=a.data.originalEvent.touches[1].pageX,b.globalDown.y=
a.data.originalEvent.touches[1].pageY}this.on("touchmove",b.__touchMoveActions)}};
MIRROR.layer.prototype.__touchMoveActions=function(a){var b=this.layer;switch(a.data.originalEvent.touches.length){case 1:b.globalMove.x=a.data.originalEvent.touches[0].pageX;b.globalMove.y=a.data.originalEvent.touches[0].pageY;b.deltaFilter.x+=(b.globalMove.x-b.globalDown.x)/100;b.deltaFilter.y+=(b.globalMove.y-b.globalDown.y)/100;b.contrastCSS=Math.max(1,Math.min(b.deltaFilter.x,10));b.brightnessCSS=Math.max(0,Math.min(b.deltaFilter.y,10));b.make.imitationLayers&&b.leadImitation&&b.__transformsImitation(5);
$("#canvas_"+b.layerId).css("-webkit-filter","contrast("+b.contrastCSS+") brightness("+b.brightnessCSS+") invert("+b.negativeCSS+")");b.dicomLayerInformation();b.globalDown.x=b.globalMove.x;b.globalDown.y=b.globalMove.y;break;case 2:var c={},d=new PIXI.Point,e=new PIXI.Point;b.renderer.plugins.interaction.mapPositionToPoint(d,a.data.originalEvent.touches[0].pageX,a.data.originalEvent.touches[0].pageY);b.renderer.plugins.interaction.mapPositionToPoint(e,a.data.originalEvent.touches[1].pageX,a.data.originalEvent.touches[1].pageY);
c.x=(d.x+e.x)/2;c.y=(d.y+e.y)/2;a.data.getLocalPosition(this,b.globalMove,c);b.pan.x=b.globalMove.x-b.globalDown.x;b.pan.y=b.globalMove.y-b.globalDown.y;b.make.imitationLayers&&b.leadImitation&&b.__transformsImitation(6);b.__mobileTransformations();b.eventWhich=2;break;case 3:b.globalMove.x=a.data.originalEvent.touches[1].pageX,b.globalMove.y=a.data.originalEvent.touches[1].pageY,a=b.globalMove.y-b.globalDown.y,c=null,0>a?(c=1,b.moveInSerie(c)):0<a&&(c=-1,b.moveInSerie(c)),b.make.imitationLayers&&
b.leadImitation&&b.__transformsImitation(4,c),b.globalDown.y=b.globalMove.y}};
MIRROR.layer.prototype.__touchEndActions=function(a){var b=this.layer;this.off("touchmove");b.make.hounsfieldState&&b.hounsfield.isSomeToolSelected()?b.hounsfield.__releaseAction(a):(2===b.eventWhich&&(b.transformations[0]={globalDown:b.globalDown,rotation:b.rotation,pan:b.pan,scale:b.scale,lastRendererWidth:b.renderer.width,lastRendererHeight:b.renderer.height},b.transformated=!0,b.make.imitationLayers&&b.leadImitation&&b.__transformsImitation(6,"end")),b.eventWhich=0)};
MIRROR.layer.prototype.__commonEventsHandler=function(){var a=this;$("#"+a.layerId).unbind("mousewheel");$("#"+a.layerId).on("mousewheel",function(b){!(a.make.hounsfieldState&&a.hounsfield.isSomeToolSelected()||a.make.measuringState||a.hounsfield.isSomeToolSelected())&&0<$("#canvas_"+a.layerId).length&&(a.moveInSerie(b.deltaY),a.make.imitationLayers&&a.leadImitation&&a.__transformsImitation(4,b.deltaY))});$("#"+a.layerId).droppable({drop:function(b,c){a.make.attachSerieToLayer(a.layerId,c.draggable.get(0).id)}})};
MIRROR.layer.prototype.moveInSerie=function(a,b){var c=this.make.load.series[this.serieIdCharged].multiplierPaddingNavigatorBar,d=void 0===b?null:(b/c).toFixed(0);if(null!==this.serieIdCharged){-1===a?this.positionInSerie<this.make.load.series[this.serieIdCharged].totalCharging-1&&(void 0!==b&&null!==d&&d<this.make.load.series[this.serieIdCharged].totalCharging-1&&0<d?this.positionInSerie=d-1:void 0===b&&this.positionInSerie++):1===a&&0<this.positionInSerie&&(void 0!==b&&null!==d&&d<this.make.load.series[this.serieIdCharged].totalCharging-
1&&0<d?this.positionInSerie=d-1:void 0===b&&this.positionInSerie--);if(void 0!==this.make.load.series[this.serieIdCharged].serie[this.positionInSerie]){var e=new PIXI.Texture(this.make.load.series[this.serieIdCharged].serie[this.positionInSerie]);this.textureSprite.texture=e;this.make.load.series[this.serieIdCharged].allSameDimensions||(this.resizeEnd=!0,this.responsiveLayer(this.renderer.width,this.renderer.height))}"canvas2d"===this.make.renderType&&"desktop"===this.make.environment&&this.__filtering();
0<$("#navigator_bar_index_"+this.layerId).length&&(void 0!==b?(e=0,e=0>(d-1)*c?0:(d-1)*c>(this.make.load.series[this.serieIdCharged].totalCharging-1)*this.make.load.series[this.serieIdCharged].multiplierPaddingNavigatorBar?(this.make.load.series[this.serieIdCharged].totalCharging-1)*this.make.load.series[this.serieIdCharged].multiplierPaddingNavigatorBar:(d-1)*c,"portrait"!==this.make.environment?$("#navigator_bar_index_"+this.layerId).css({top:e+"px"}):$("#navigator_bar_index_"+this.layerId).css({left:e+
"px"})):"portrait"!==this.make.environment?$("#navigator_bar_index_"+this.layerId).css({top:this.positionInSerie*this.make.load.series[this.serieIdCharged].multiplierPaddingNavigatorBar+"px"}):$("#navigator_bar_index_"+this.layerId).css({left:this.positionInSerie*this.make.load.series[this.serieIdCharged].multiplierPaddingNavigatorBar+"px"}));this.dicomLayerInformation();this.__movingLocalizer()}};
MIRROR.layer.prototype.addLocalizer=function(a){null!==this.serieIdCharged&&null!==this.make.layers[a].serieIdCharged&&1<this.make.totalLayers&&this.layerId!==a?"coronal"!==this.make.load.series[this.make.layers[a].serieIdCharged].orientationPlane&&"sagittal"!==this.make.load.series[this.make.layers[a].serieIdCharged].orientationPlane||this.make.load.series[this.serieIdCharged].frameOfReferenceUID!==this.make.load.series[this.make.layers[a].serieIdCharged].frameOfReferenceUID||"coronal"===this.make.load.series[this.serieIdCharged].orientationPlane||
"sagittal"===this.make.load.series[this.serieIdCharged].orientationPlane||!this.make.load.series[this.serieIdCharged].charged||0!==this.make.load.series[this.serieIdCharged].numberOfFrames?this.removeLocalizer(a):(null===this.make.layers[a].localizer&&(this.make.layers[a].localizer=new PIXI.Graphics,this.make.layers[a].textureSprite.addChild(this.make.layers[a].localizer)),this.make.layers[a].localizer.beginFill(65280),this.make.layers[a].localizer.drawRect(0,0,this.make.layers[a].textureSprite.width,
2),this.make.layers[a].localizer.position.y=this.__coordinatesLocalizer(a)):this.removeLocalizer(a)};
MIRROR.layer.prototype.removeLocalizer=function(a){void 0===a?null!==this.serieIdCharged&&null!==this.stage&&null!==this.localizer&&(this.textureSprite.removeChild(this.localizer),this.localizer=null):null!==this.make.layers[a].serieIdCharged&&null!==this.make.layers[a].renderer&&null!==this.make.layers[a].localizer&&(this.make.layers[a].textureSprite.removeChild(this.make.layers[a].localizer),this.make.layers[a].localizer=null)};
MIRROR.layer.prototype.__movingLocalizer=function(){for(var a in this.make.layers)a!==this.layerId&&null!==this.make.layers[a].localizer&&null!==this.make.layers[a].serieIdCharged&&(this.make.layers[a].localizer.position.y=this.__coordinatesLocalizer(a))};
MIRROR.layer.prototype.__coordinatesLocalizer=function(a){var b=this.make.load.series[this.serieIdCharged].imagePositionPatient[0],c=this.make.load.series[this.serieIdCharged].imagePositionPatient[1],d=this.make.load.series[this.serieIdCharged].slicePosition[this.positionInSerie],e=this.make.load.series[this.serieIdCharged].dimensions[this.positionInSerie].columns*this.make.load.series[this.serieIdCharged].pixelSpacing,g=this.make.load.series[this.make.layers[a].serieIdCharged].imagePositionPatient[0],
f=this.make.load.series[this.make.layers[a].serieIdCharged].imagePositionPatient[1],h=this.make.load.series[this.make.layers[a].serieIdCharged].imagePositionPatient[2],k=this.make.load.series[this.make.layers[a].serieIdCharged].imageOrientationPatient[3],n=this.make.load.series[this.make.layers[a].serieIdCharged].imageOrientationPatient[4],l=this.make.load.series[this.make.layers[a].serieIdCharged].imageOrientationPatient[5],m=b+this.make.load.series[this.serieIdCharged].imageOrientationPatient[3]*
e,p=c+this.make.load.series[this.serieIdCharged].imageOrientationPatient[4]*e,e=d+this.make.load.series[this.serieIdCharged].imageOrientationPatient[5]*e,b=b-g,c=c-f,d=d-h;return parseInt(((k*b+n*c+l*d+(k*(m-g)+n*(p-f)+l*(e-h)))/2/this.make.load.series[this.make.layers[a].serieIdCharged].pixelSpacing+.5).toFixed(0))};
MIRROR.layer.prototype.__zooming=function(){this.transformationSprite.scale.x=this.scale;this.transformationSprite.scale.y=this.scale;this.transformationSprite.position.x=-this.localDown.x*(this.scale-1)+this.diffZoom.x;this.transformationSprite.position.y=-this.localDown.y*(this.scale-1)+this.diffZoom.y;this.transformationSprite.updateTransform();this.dicomLayerInformation()};
MIRROR.layer.prototype.__panning=function(){this.transformationSprite.position.x=this.pan.x+this.diffPan.x-this.localDown.x*(this.scale-1);this.transformationSprite.position.y=this.pan.y+this.diffPan.y-this.localDown.y*(this.scale-1);this.transformationSprite.updateTransform()};
MIRROR.layer.prototype.__rotating=function(){this.textureSprite.pivot.x=-this.localDownTexture.x;this.textureSprite.pivot.y=-this.localDownTexture.y;this.textureSprite.rotation=this.rotation;this.textureSprite.pivot.x=this.localDownTexture.x;this.textureSprite.pivot.y=this.localDownTexture.y;this.transformationSprite.position.x=this.localDownTexture.x+this.diffRotation.x;this.transformationSprite.position.y=this.localDownTexture.y+this.diffRotation.y;this.textureSprite.updateTransform();this.transformationSprite.updateTransform();
this.dicomLayerInformation()};
MIRROR.layer.prototype.__mobileTransformations=function(){this.transformationSprite.scale.x=this.scale;this.transformationSprite.scale.y=this.scale;this.transformationSprite.position.x=this.pan.x+this.diffZoom.x-this.localDown.x*(this.scale-1);this.transformationSprite.position.y=this.pan.y+this.diffZoom.y-this.localDown.y*(this.scale-1);this.textureSprite.pivot.x=-this.localDownTexture.x;this.textureSprite.pivot.y=-this.localDownTexture.y;this.textureSprite.rotation=this.rotation;this.textureSprite.pivot.x=
this.localDownTexture.x;this.textureSprite.pivot.y=this.localDownTexture.y;this.pivotSprite.position.x=this.localDown.x;this.pivotSprite.position.y=this.localDown.y;this.transformationSprite.updateTransform();this.textureSprite.updateTransform();this.pivotSprite.updateTransform();this.dicomLayerInformation()};
MIRROR.layer.prototype.__filtering=function(){if("webgl"===this.make.renderType){var a=null;this.make.negativeState?(a=1,"desktop"===this.make.environment&&(this.dicomInformation.style={font:"12px Arial",fill:"#000"},this.layerInformation.style={font:"12px Arial",fill:"#000"})):(a=0,"desktop"===this.make.environment&&(this.dicomInformation.style={font:"12px Arial",fill:"#FFF"},this.layerInformation.style={font:"12px Arial",fill:"#FFF"}));if(null!==this.windowWidth&&null!==this.windowCenter)var b=
new PIXI.AbstractFilter(null,MIRROR.filter.shader_fragment_windowLevel,{uLowerBound:{type:"1f",value:this.make.load.series[this.serieIdCharged].lowerBound},uUpperBound:{type:"1f",value:this.make.load.series[this.serieIdCharged].upperBound},uNegative:{type:"1f",value:a},uBrightness:{type:"1f",value:this.brightness},uContrast:{type:"1f",value:this.contrast}});else var b=this.brightness*this.contrast,c=128*-this.contrast+128,b=new PIXI.AbstractFilter(null,MIRROR.filter.shader_fragment_brightnessContrast,
{uNegative:{type:"1f",value:a},uMultiplier:{type:"1f",value:b},uAdder:{type:"1f",value:c}});this.filterSprite.filters=[b]}else if("canvas2d"===this.make.renderType){b=this.brightness*this.contrast;c=128*-this.contrast+128;a=new PIXI.CanvasBuffer(this.renderer.width,this.renderer.height);a.context.drawImage(this.make.load.series[this.serieIdCharged].serie[this.positionInSerie].source,0,0,this.make.load.series[this.serieIdCharged].serie[this.positionInSerie].source.width,this.make.load.series[this.serieIdCharged].serie[this.positionInSerie].height);
for(var d=a.context.getImageData(0,0,a.width,a.height),e=0;e<d.data.length;e+=4)d.data[e]=d.data[e]*b+c,d.data[e+1]=d.data[e+1]*b+c,d.data[e+2]=d.data[e+2]*b+c,255<d.data[e]?d.data[e]=255:0>d.data[e]&&(d.data[e]=0),255<d.data[e+1]?d.data[e+1]=255:0>d.data[e+1]&&(d.data[e+1]=0),255<d.data[e+2]?d.data[e+2]=255:0>d.data[e+2]&&(d.data[e+2]=0),this.make.negativeState&&(d.data[e]=255-d.data[e],d.data[e+1]=255-d.data[e+1],d.data[e+2]=255-d.data[e+2]);a.context.putImageData(d,0,0);b=new PIXI.Texture.fromCanvas(a.canvas);
this.textureSprite.texture=b;a=new PIXI.CanvasBuffer(this.renderer.width,this.renderer.height);a.context.rect(0,0,this.renderer.width,this.renderer.height);this.make.negativeState?(a.context.fillStyle="rgba(255, 255, 255, 1)",$("#"+this.layerId).css("background","#FFF"),"desktop"===this.make.environment&&(this.dicomInformation.style={font:"12px Arial",fill:"#000"},this.layerInformation.style={font:"12px Arial",fill:"#000"})):(a.context.fillStyle="rgba(0, 0, 0, 1)",$("#"+this.layerId).css("background",
"#000"),"desktop"===this.make.environment&&(this.dicomInformation.style={font:"12px Arial",fill:"#FFF"},this.layerInformation.style={font:"12px Arial",fill:"#FFF"}));a.context.fill();b=PIXI.Texture.fromCanvas(a.canvas);this.transformationSprite.texture=b;this.filterSprite.texture=b;this.container.texture=b}this.dicomLayerInformation()};MIRROR.layer.prototype.render=function(){this.renderer.render(this.stage)};/*
   2015 Toth Limitada
 @license     {@link http://www.toth.cl}
*/
MIRROR.loader.prototype.study=function(){var a=this;$.post("../services/getStudy.py",{pk:a.studyId},function(b){0<b.length?(a.make.checkIfWindowLevelIsSet(b),a.studyDescription=void 0!==b[0].study_desc||""!==b[0].study_desc?b[0].study_desc:null,a.studyCharged=!0,a.totalSeries=b.length,a.__setSeries(b),a.make.isPhone||a.make.globalInformation(),0<$("#loading_study").length&&$("#loading_study").remove()):(0<$("#loading_study").length&&$("#loading_study").remove(),alert(MIRROR.language.study.no_data))})};
MIRROR.loader.prototype.__setSeries=function(a){if("desktop"===this.make.environment){var b='<div style="width: 90px; height: '+85*this.totalSeries+'px; text-align: center;"></div>';$("#series_toolsbar").append(b)}for(b=0;b<this.totalSeries;b++){this.series["serie_"+b]=new MIRROR.serie(this,"serie_"+b,a[b].pixelSpacing,a[b].windowWidth,a[b].windowCenter,a[b].rescaleSlope,a[b].rescaleIntercept,a[b].dimensions,a[b].reports,a[b].patient_name,a[b].patient_rut,a[b].patient_sex,a[b].name,a[b].institution,
a[b].series_body_part,a[b].series_desc,a[b].modality,a[b].sliceThickness,a[b].frameOfReferenceUID,a[b].totalElements,a[b].bitsStored,a[b].numberOfFrames,a[b].frameTime);this.series["serie_"+b].checkAllSameDimensions();this.series["serie_"+b].setImageOrientationPatient(a[b].imageOrientationPatient);this.series["serie_"+b].setImagePositionPatient(a[b].imagePositionPatient);this.series["serie_"+b].setParametersToEachElement(a[b].images,a[b].dicomPathsImages,a[b].imagesFrame);if("desktop"===this.make.environment)this.make.thumbnails["serie_"+
b]=1<this.series["serie_"+b].imagesURL.length?'<img id="serie_'+b+'" src="../../wado.php?requestType=WADO'+this.series["serie_"+b].imagesURL[(this.series["serie_"+b].imagesURL.length/2).toFixed(0)]+'&columns=80" style=" padding-bottom: 3px; border: 1px solid #4C4C4C;" />':'<img id="serie_'+b+'" src="../../wado.php?requestType=WADO'+this.series["serie_"+b].imagesURL[0]+'&columns=80" style=" padding-bottom: 3px; border: 1px solid #4C4C4C;" />';else{this.make.thumbnails["serie_"+b]=$("<div></div>");
if(null!==this.series["serie_"+b].serieDescription){var c=$('<span style="color: #FFF; font-size: 8pt;">'+this.series["serie_"+b].serieDescription+"</span><br />");this.make.thumbnails["serie_"+b].append(c)}c=1<this.series["serie_"+b].imagesURL.length?$('<img id="serie_'+b+'" src="../../wado.php?requestType=WADO'+this.series["serie_"+b].imagesURL[(this.series["serie_"+b].imagesURL.length/2).toFixed(0)]+'&columns=80" style=" padding-bottom: 3px; border: 1px solid #4C4C4C;" /><br />'):$('<img id="serie_'+
b+'" src="../../wado.php?requestType=WADO'+this.series["serie_"+b].imagesURL[0]+'&columns=80" style=" padding-bottom: 3px; border: 1px solid #4C4C4C;" /><br />');this.make.thumbnails["serie_"+b].append(c)}"desktop"===this.make.environment&&($("#series_toolsbar").children().append(this.make.thumbnails["serie_"+b]),c="",null!==this.series["serie_"+b].serieBodyPart&&(c+='<span style="text-decoration: underline;">'+MIRROR.language.toolsbar.thumbnails.body_part+"</span>: "+this.series["serie_"+b].serieBodyPart+
"<br />"),null!==this.series["serie_"+b].serieName&&(c+='<span style="text-decoration: underline;">'+MIRROR.language.toolsbar.thumbnails.name_serie+"</span>: "+this.series["serie_"+b].serieName+"<br />"),null!==this.series["serie_"+b].serieDescription&&(c+='<span style="text-decoration: underline;">'+MIRROR.language.toolsbar.thumbnails.serie_desc+"</span>: "+this.series["serie_"+b].serieDescription+"<br />"),0<this.series["serie_"+b].imagesURL.length&&(c+='<span style="text-decoration: underline;">'+
MIRROR.language.toolsbar.thumbnails.total_images+"</span>: "+this.series["serie_"+b].imagesURL.length+"<br />"),$("#serie_"+b).tothtip($("<div>"+c+"</div>")));this.series["serie_"+b].commonEventsHandler()}"desktop"===this.make.environment&&$("#series_toolsbar").perfectScrollbar()};
MIRROR.loader.prototype.statusSerie=function(a,b){var c=this;if(c.series[b].charged)c.make.layers[a].applySerie(c.series[b].serie[0],$("#"+a).width(),$("#"+a).height()),0<$("#navigator_bar_"+a).length&&("portrait"!==c.make.environment?$("#navigator_bar_"+a).height(c.series[b].totalCharging*c.series[b].multiplierPaddingNavigatorBar):$("#navigator_bar_"+a).width(c.series[b].totalCharging*c.series[b].multiplierPaddingNavigatorBar));else if("desktop"===c.make.environment)if(c.series[b].charging)if(void 0===
c.series[b].serie[0])var d=setInterval(function(){void 0!==c.series[b].serie[0]&&(c.make.layers[a].applySerie(c.series[b].serie[0],$("#"+a).width(),$("#"+a).height()),clearInterval(d))},10);else c.make.layers[a].applySerie(c.series[b].serie[0],$("#"+a).width(),$("#"+a).height());else c.series[b].charged=!1,c.series[b].totalCharging=0,c.series[b].totalChargingWithError=0,c.series[b].charging=!0,c.tailCharging.push(b),c.charging=!0,c.make.layersState&&($("#submenu").remove(),c.make.layersState=!1),
$("#layers").html(c.make.buttons.layers.disable),$("#"+a).children().children().children().html(MIRROR.language.workspace.loading),c.__chargeSerie(a,b,function(){c.tailCharging.shift();0===c.tailCharging.length&&(c.charging=!1,$("#layers").html(c.make.buttons.layers.inactive));c.series[b].charging=!1;c.series[b].totalCharging===c.series[b].imagesURL.length&&(c.series[b].charged=!0,c.totalSeriesCharged++,c.series[b].chargedWithError=!1);c.make.layers[a].dicomLayerInformation();c.make.globalInformation()});
else"desktop"!==c.make.environment&&(c.blockAttachSerieMobile=!0,0<$("#series_thumbnails_submenu").length&&$("#series_thumbnails_submenu").append('<div id="blockAttachSerie" style="display: table; position: absolute; left: 0px; top: 0px; width: 100%; height: '+$("#series_thumbnails_submenu").height()+'px; background: rgba(66, 66, 66, 0.8);"><div style="display: table-cell; vertical-align: middle"><img src="../img/loading.svg" /></div></div>'),c.series[b].charged=!1,c.series[b].totalCharging=0,c.series[b].totalChargingWithError=
0,c.tailCharging.push(b),c.charging=!0,c.make.layersState&&($("#submenu").remove(),c.make.layersState=!1),$("#layers").html(c.make.buttons.layers.disable),$("#"+a).children().children().children().html(MIRROR.language.workspace.loading),c.__chargeSerieSlow(a,b,function(){c.tailCharging.shift();0===c.tailCharging.length&&(c.charging=!1,$("#layers").html(c.make.buttons.layers.inactive));clearInterval(c.intervalChargeSerie);c.blockAttachSerieMobile=!1;c.series[b].totalCharging===c.series[b].imagesURL.length&&
(c.series[b].charged=!0,c.totalSeriesCharged++,c.series[b].chargedWithError=!1);0<$("#blockAttachSerie").length&&$("#blockAttachSerie").remove();c.make.isPhone||(c.make.layers[a].dicomLayerInformation(),c.make.globalInformation())}))};
MIRROR.loader.prototype.__chargeSerie=function(a,b,c){for(var d=this,e=0;e<d.series[b].imagesURL.length;e++)void 0!==d.series[b].serie[e]&&d.series[b].serie[e].destroy(),d.series[b].serie[e]=new PIXI.BaseTexture.fromImage("../../wado.php?requestType=WADO"+d.series[b].imagesURL[e]),d.series[b].serie[e].on("loaded",function(e,f){return function(){f.series[b].totalCharging++;0<$("#navigator_bar_"+a).length&&("portrait"!==d.make.environment?$("#navigator_bar_"+a).height(f.series[b].totalCharging*f.series[b].multiplierPaddingNavigatorBar):
$("#navigator_bar_"+a).width(f.series[b].totalCharging*f.series[b].multiplierPaddingNavigatorBar));for(var h in f.make.layers)f.make.layers[h].serieIdCharged===b&&a!==h&&(f.make.layers[h].dicomLayerInformation(),0<$("#navigator_bar_"+h).length&&("portrait"!==d.make.environment?$("#navigator_bar_"+h).height(f.series[b].totalCharging*f.series[b].multiplierPaddingNavigatorBar):$("#navigator_bar_"+h).width(f.series[b].totalCharging*f.series[b].multiplierPaddingNavigatorBar)));0===e&&(f.make.layers[a].applySerie(f.series[b].serie[0],
$("#"+a).width(),$("#"+a).height()),1===f.series[b].imagesURL.length&&c());f.series[b].totalCharging===f.series[b].imagesURL.length&&c();f.make.layers[a].dicomLayerInformation()}}(e,d)),d.series[b].serie[e].once("error",function(a,d){return function(){d.series[b].chargedWidthError=!0;d.series[b].totalChargingWithError++;1===d.series[b].totalChargingWithError&&c()}}(e,d))};
MIRROR.loader.prototype.__chargeSerieSlow=function(a,b,c){var d=this,e=0;d.intervalChargeSerie=setInterval(function(){void 0!==d.series[b].serie[e]&&d.series[b].serie[e].destroy();d.series[b].serie[e]=new PIXI.BaseTexture.fromImage("../../wado.php?requestType=WADO"+d.series[b].imagesURL[e]);d.series[b].serie[e].on("loaded",function(e,f){return function(){f.charging=!0;f.make.layersState&&$("#submenu").remove();$("#layers").html(f.make.buttons.layers.disable);f.series[b].totalCharging++;f.make.layers[a].dicomLayerInformation();
0<$("#navigator_bar_"+a).length&&("portrait"!==d.make.environment?$("#navigator_bar_"+a).height(f.series[b].totalCharging*f.series[b].multiplierPaddingNavigatorBar):$("#navigator_bar_"+a).width(f.series[b].totalCharging*f.series[b].multiplierPaddingNavigatorBar));0===e?(f.make.layers[a].applySerie(f.series[b].serie[0],$("#"+a).width(),$("#"+a).height()),1===f.series[b].imagesURL.length&&c()):f.series[b].totalCharging===f.series[b].imagesURL.length&&c();f.make.layers[a].dicomLayerInformation()}}(e,
d));d.series[b].serie[e].once("error",function(a,d){return function(){d.series[b].chargedWidthError=!0;d.series[b].totalChargingWithError++;1===d.series[b].totalChargingWithError&&c()}}(e,d));e++},175)};/*
   2015 Toth Limitada
 @license     {@link http://www.toth.cl}
*/
MIRROR.serie.prototype.checkAllSameDimensions=function(){for(var a=0,b=0;b<this.dimensions.length;b++)this.dimensions[0].columns===this.dimensions[b].columns&&this.dimensions[0].rows===this.dimensions[b].rows&&a++;this.allSameDimensions=a===this.dimensions.length?!0:!1};
MIRROR.serie.prototype.setParametersToEachElement=function(a,b,c){for(var d=0;d<a.length;d++)this.imagesURL[d]=a[d],this.dicomsPath[d]=b[d],this.imagesFrame[d]=c[d],null!==this.orientationPlane&&6===this.imageOrientationPatient.length&&3===this.imagePositionPatient.length&&("axial"===this.orientationPlane?this.slicePosition[d]=this.normalVector.x*this.imagePositionPatient[0]+this.normalVector.y*this.imagePositionPatient[1]+this.normalVector.z*(this.imagePositionPatient[2]+d*this.spaceBetweenSlices*
this.imagePositionPatientDirection):"sagittal"===this.orientationPlane?this.slicePosition[d]=this.normalVector.x*(this.imagePositionPatient[0]+d*this.spaceBetweenSlices*this.imagePositionPatientDirection)+this.normalVector.y*this.imagePositionPatient[1]+this.normalVector.z*this.imagePositionPatient[2]:"coronal"===this.orientationPlane&&(this.slicePosition[d]=this.normalVector.x*this.imagePositionPatient[0]+this.normalVector.y*(this.imagePositionPatient[1]+d*this.spaceBetweenSlices*this.imagePositionPatientDirection)+
this.normalVector.z*this.imagePositionPatient[2]))};MIRROR.serie.prototype.setImageOrientationPatient=function(a){if(null!==a&&6===a.length){for(var b=0;b<a.length;b++)this.imageOrientationPatient[b]=void 0===a[b]||""===a[b]||null===a[b]?null:parseFloat(a[b]);this.__setNormalVector();this.__setOrientationPlane()}};
MIRROR.serie.prototype.__setNormalVector=function(){this.normalVector.x=this.imageOrientationPatient[1]*this.imageOrientationPatient[5]-this.imageOrientationPatient[2]*this.imageOrientationPatient[4];this.normalVector.y=this.imageOrientationPatient[2]*this.imageOrientationPatient[3]-this.imageOrientationPatient[0]*this.imageOrientationPatient[5];this.normalVector.z=this.imageOrientationPatient[0]*this.imageOrientationPatient[4]-this.imageOrientationPatient[1]*this.imageOrientationPatient[3]};
MIRROR.serie.prototype.__setOrientationPlane=function(){var a=parseFloat(this.imageOrientationPatient[0].toFixed(0)),b=parseFloat(this.imageOrientationPatient[1].toFixed(0)),c=parseFloat(this.imageOrientationPatient[5].toFixed(0));this.orientationPlane=1!==a&&-1!==a||1!==c&&-1!==c?1!==b&&-1!==b||1!==c&&-1!==c?"axial":"sagittal":"coronal"};
MIRROR.serie.prototype.setImagePositionPatient=function(a){if(null!==a&&2===a.length&&3===a[0].length&&3===a[1].length){for(var b=0;b<a[0].length;b++)this.imagePositionPatient[b]=void 0===a[0][b]||""===a[0][b]||null===a[0][b]?null:parseFloat(a[0][b]);this.__setSpaceBetweenSlices(a);this.__setImagePositionPatientDirection(a)}};
MIRROR.serie.prototype.__setSpaceBetweenSlices=function(a){this.spaceBetweenSlices=Math.abs(this.normalVector.x*a[0][0]+this.normalVector.y*a[0][1]+this.normalVector.z*a[0][2]-(this.normalVector.x*a[1][0]+this.normalVector.y*a[1][1]+this.normalVector.z*a[1][2]))};
MIRROR.serie.prototype.__setImagePositionPatientDirection=function(a){"axial"===this.orientationPlane?parseFloat(a[0][2])>parseFloat(a[1][2])?this.imagePositionPatientDirection=-1:this.imagePositionPatientDirection=1:"coronal"===this.orientationPlane?parseFloat(a[0][1])>parseFloat(a[1][1])?this.imagePositionPatientDirection=-1:this.imagePositionPatientDirection=1:"sagittal"===this.orientationPlane&&(parseFloat(a[0][0])>parseFloat(a[1][0])?this.imagePositionPatientDirection=-1:this.imagePositionPatientDirection=
1)};MIRROR.serie.prototype.setMultiplierPaddingNavigatorBar=function(){this.multiplierPaddingNavigatorBar="portrait"!==this.load.make.environment?$("#navigator_"+this.load.make.environment).height()/this.imagesURL.length:$("#navigator_"+this.load.make.environment).width()/this.imagesURL.length};MIRROR.serie.prototype.commonEventsHandler=function(){$("#"+this.serieId).draggable({containment:"html",helper:"clone",appendTo:"body",zIndex:1E3})};/*
   2015 Toth Limitada
 @license     {@link http://www.toth.cl}
*/
MIRROR.measuring.prototype.initializedTriggered=function(){0===$("#canvas_measuring_"+this.layer.layerId).length&&(document.getElementById(this.layer.layerId).appendChild(this.canvas),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),"desktop"===this.layer.make.environment?($("#canvas_measuring_"+this.layer.layerId).on("mousedown",{measuring:this},this.__downActions),$("#canvas_measuring_"+this.layer.layerId).on("mousemove",{measuring:this},this.__moveActions),$("#canvas_measuring_"+
this.layer.layerId).on("mouseup",{measuring:this},this.__upActions)):($("#canvas_measuring_"+this.layer.layerId).bind("touchstart",{measuring:this},this.__downActions),$("#canvas_measuring_"+this.layer.layerId).bind("touchmove",{measuring:this},this.__moveActions),$("#canvas_measuring_"+this.layer.layerId).bind("touchend",{measuring:this},this.__upActions)))};
MIRROR.measuring.prototype.__downActions=function(a){var b=a.data.measuring,c={};c.x=("desktop"===b.layer.make.environment?a.clientX:a.originalEvent.touches[0].pageX)-$(this).offset().left;c.y=("desktop"===b.layer.make.environment?a.clientY:a.originalEvent.touches[0].pageY)-$(this).offset().top;b.down=!0;b.point=b.__findPoint(c.x,c.y);if(b.point)b.shapes[b.shapes.length-1].done||b.__checkingIfIdenticalForCloseArea(b.shapes.length-1,c)&&b.shapes[b.shapes.length-1].points.push(c);else{if(0===b.shapes.length||
b.shapes[b.shapes.length-1].done)a=new b.shape,b.shapes.push(a),b.shapes[b.shapes.length-1].type=b.layer.make.measuringTool,b.shapes[b.shapes.length-1].making=!0,b.shapes[b.shapes.length-1].points.push(c);b.shapes[b.shapes.length-1].points.push(c);b.__paintEdges();b.__paintPoints();b.__paintLabels()}};
MIRROR.measuring.prototype.__moveActions=function(a){var b=a.data.measuring;"desktop"!==b.layer.make.environment&&a.preventDefault();if(!b.point&&b.down){if(0!==b.shapes.length){var c={};c.x=("desktop"===b.layer.make.environment?a.clientX:a.originalEvent.touches[0].pageX)-$(this).offset().left;c.y=("desktop"===b.layer.make.environment?a.clientY:a.originalEvent.touches[0].pageY)-$(this).offset().top;b.__paintEdges();b.__paintPoints();b.__paintLabels();1<b.shapes[b.shapes.length-1].points.length&&(b.context.beginPath(),
b.context.moveTo(b.shapes[b.shapes.length-1].points[b.shapes[b.shapes.length-1].points.length-2].x,b.shapes[b.shapes.length-1].points[b.shapes[b.shapes.length-1].points.length-2].y),b.context.lineTo(c.x,c.y),b.context.lineWidth="2",b.context.strokeStyle="rgba(213, 133, 18, 1)",b.context.stroke(),b.context.closePath(),b.shapes[b.shapes.length-1].points[b.shapes[b.shapes.length-1].points.length-1]=c)}}else!1!==b.point&&b.down?(c={},c.x=("desktop"===b.layer.make.environment?a.clientX:a.originalEvent.touches[0].pageX)-
$(this).offset().left,c.y=("desktop"===b.layer.make.environment?a.clientY:a.originalEvent.touches[0].pageY)-$(this).offset().top,"area"===b.shapes[b.point.indexShape].type?b.point.indexPoint!==b.shapes[b.point.indexShape].points.length-1&&0!==b.point.indexPoint||!b.__checkingIfIdenticalForCloseArea(b.point.indexShape,b.shapes[b.point.indexShape].points[b.shapes[b.point.indexShape].points.length-1])?(b.shapes[b.point.indexShape].points[b.point.indexPoint].x=c.x,b.shapes[b.point.indexShape].points[b.point.indexPoint].y=
c.y):(b.shapes[b.point.indexShape].points[0].x=c.x,b.shapes[b.point.indexShape].points[0].y=c.y,b.shapes[b.point.indexShape].points[b.shapes[b.point.indexShape].points.length-1].x=c.x,b.shapes[b.point.indexShape].points[b.shapes[b.point.indexShape].points.length-1].y=c.y):(b.shapes[b.point.indexShape].points[b.point.indexPoint].x=c.x,b.shapes[b.point.indexShape].points[b.point.indexPoint].y=c.y),b.__paintEdges(),b.__paintPoints(),b.__paintLabels(),b.__calculate(b.point.indexShape)):"desktop"!==b.layer.make.environment||
0===b.shapes.length||b.down||b.shapes[b.shapes.length-1].done||(c={},c.x=("desktop"===b.layer.make.environment?a.clientX:a.originalEvent.touches[0].pageX)-$(this).offset().left,c.y=("desktop"===b.layer.make.environment?a.clientY:a.originalEvent.touches[0].pageY)-$(this).offset().top,b.__paintEdges(),b.__paintPoints(),b.__paintLabels(),b.context.beginPath(),b.context.moveTo(b.shapes[b.shapes.length-1].points[b.shapes[b.shapes.length-1].points.length-1].x,b.shapes[b.shapes.length-1].points[b.shapes[b.shapes.length-
1].points.length-1].y),b.context.lineTo(c.x,c.y),b.context.lineWidth="2",b.context.strokeStyle="rgba(213, 133, 18, 1)",b.context.stroke(),b.context.closePath(),b.__calculate(b.shapes.length-1,c))};MIRROR.measuring.prototype.__upActions=function(a){a=a.data.measuring;a.__checkingIfIdentical(a.shapes.length-1)&&a.shapes[a.shapes.length-1].points.pop();a.__checkingIfDone();a.down=!1};
MIRROR.measuring.prototype.__checkingIfIdentical=function(a){return 2===this.shapes[a].points.length&&this.shapes[a].points[1].x>=this.shapes[a].points[0].x-15&&this.shapes[a].points[1].x<=this.shapes[a].points[0].x+15&&this.shapes[a].points[1].y>=this.shapes[a].points[0].y-15&&this.shapes[a].points[1].y<=this.shapes[a].points[0].y+15?!0:!1};
MIRROR.measuring.prototype.__checkingIfIdenticalForCloseArea=function(a,b){return 1<this.shapes[a].points.length&&b.x>=this.shapes[a].points[0].x-15&&b.x<=this.shapes[a].points[0].x+15&&b.y>=this.shapes[a].points[0].y-15&&b.y<=this.shapes[a].points[0].y+15?!0:!1};
MIRROR.measuring.prototype.__checkingIfDone=function(){this.__checkingIfIdentical(this.shapes.length-1)||("segment"===this.layer.make.measuringTool&&2===this.shapes[this.shapes.length-1].points.length||"angle"===this.layer.make.measuringTool&&3===this.shapes[this.shapes.length-1].points.length?(this.shapes[this.shapes.length-1].done=!0,this.shapes[this.shapes.length-1].making=!1,this.__paintEdges(),this.__paintPoints(),this.__paintLabels()):"area"===this.layer.make.measuringTool&&1<this.shapes[this.shapes.length-
1].points.length&&this.shapes[this.shapes.length-1].points[this.shapes[this.shapes.length-1].points.length-1].x>=this.shapes[this.shapes.length-1].points[0].x-15&&this.shapes[this.shapes.length-1].points[this.shapes[this.shapes.length-1].points.length-1].x<=this.shapes[this.shapes.length-1].points[0].x+15&&this.shapes[this.shapes.length-1].points[this.shapes[this.shapes.length-1].points.length-1].y>=this.shapes[this.shapes.length-1].points[0].y-15&&this.shapes[this.shapes.length-1].points[this.shapes[this.shapes.length-
1].points.length-1].y<=this.shapes[this.shapes.length-1].points[0].y+15&&(this.shapes[this.shapes.length-1].points[this.shapes[this.shapes.length-1].points.length-1].x=this.shapes[this.shapes.length-1].points[0].x,this.shapes[this.shapes.length-1].points[this.shapes[this.shapes.length-1].points.length-1].y=this.shapes[this.shapes.length-1].points[0].y,this.shapes[this.shapes.length-1].done=!0,this.shapes[this.shapes.length-1].making=!1,this.__paintEdges(),this.__paintPoints(),this.__paintLabels()))};
MIRROR.measuring.prototype.findLastUndoneShapes=function(){0<this.shapes.length&&!this.shapes[this.shapes.length-1].done&&this.shapes[this.shapes.length-1].type!==this.layer.make.measuringTool&&(this.shapes.pop(),this.__paintEdges(),this.__paintPoints(),this.__paintLabels())};
MIRROR.measuring.prototype.__findPoint=function(a,b){if(0!==this.shapes.length)for(var c=0;c<this.shapes.length;c++)for(var d=0;d<this.shapes[c].points.length;d++)if(a>=this.shapes[c].points[d].x-15&&a<=this.shapes[c].points[d].x+15&&b>=this.shapes[c].points[d].y-15&&b<=this.shapes[c].points[d].y+15)return{indexShape:c,indexPoint:d};return!1};
MIRROR.measuring.prototype.__paintEdges=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);$("#"+this.layer.layerId+" h5").remove();for(var a=0;a<this.shapes.length;a++){this.context.beginPath();this.context.moveTo(this.shapes[a].points[0].x,this.shapes[a].points[0].y);for(var b=1;b<this.shapes[a].points.length;b++)this.context.lineTo(this.shapes[a].points[b].x,this.shapes[a].points[b].y);this.context.lineWidth="2";"segment"===this.shapes[a].type||"angle"===this.shapes[a].type?
this.context.fillStyle="rgba(255, 255, 255, 0)":"area"===this.shapes[a].type&&(this.context.fillStyle="rgba(213, 133, 18, 0.3)");this.context.fill();this.context.strokeStyle=this.shapes[a].done||this.shapes[a].making?"rgba(213, 133, 18, 1)":"rgba(213, 133, 18, 0)";this.context.stroke()}};
MIRROR.measuring.prototype.__paintPoints=function(){for(var a=0;a<this.shapes.length;a++)for(var b=0;b<this.shapes[a].points.length;b++)this.context.beginPath(),this.context.arc(this.shapes[a].points[b].x,this.shapes[a].points[b].y,3,0,2*Math.PI,!0),this.context.fillStyle="#D58512",this.context.fill(),this.context.closePath()};
MIRROR.measuring.prototype.__paintLabels=function(){for(var a=0;a<this.shapes.length;a++)("segment"===this.shapes[a].type&&2===this.shapes[a].points.length&&!this.__checkingIfIdentical(a)||"angle"===this.shapes[a].type&&3===this.shapes[a].points.length||"area"===this.shapes[a].type&&this.shapes[a].done)&&this.__calculate(a)};
MIRROR.measuring.prototype.__calculate=function(a,b){if("segment"===this.shapes[a].type){if(1===this.shapes[a].points.length)var c=(b.y-this.shapes[a].points[0].y)/(b.x-this.shapes[a].points[0].x),d=((b.x+this.shapes[a].points[0].x)/2).toFixed(0),e=((b.y+this.shapes[a].points[0].y)/2).toFixed(0),g=this.shapes[a].points[0].x-b.x,f=this.shapes[a].points[0].y-b.y;else c=(this.shapes[a].points[1].y-this.shapes[a].points[0].y)/(this.shapes[a].points[1].x-this.shapes[a].points[0].x),d=((this.shapes[a].points[1].x+
this.shapes[a].points[0].x)/2).toFixed(0),e=((this.shapes[a].points[1].y+this.shapes[a].points[0].y)/2).toFixed(0),g=this.shapes[a].points[0].x-this.shapes[a].points[1].x,f=this.shapes[a].points[0].y-this.shapes[a].points[1].y;var h=null!==this.layer.make.load.series[this.layer.serieIdCharged].pixelSpacing?this.layer.make.load.series[this.layer.serieIdCharged].pixelSpacing:1;this.shapes[a].calcule=Math.sqrt(g*g+f*f)/this.layer.scale*h;e=0<c?parseInt(e)-20:parseInt(e)+5;$("#"+this.layer.layerId).append('<h5><span style="z-index: 200; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+
e+"px; left: "+d+'px;">'+this.shapes[a].calcule.toFixed(0)+""+(null!==this.layer.make.load.series[this.layer.serieIdCharged].pixelSpacing?"[mm]":"[px]")+"</span></h5>")}else if("angle"===this.shapes[a].type)1<this.shapes[a].points.length&&(2===this.shapes[a].points.length?(c=(this.shapes[a].points[0].x-b.x)*(this.shapes[a].points[0].x-b.x)+(this.shapes[a].points[0].y-b.y)*(this.shapes[a].points[0].y-b.y),c=Math.sqrt(c),d=(this.shapes[a].points[1].x-b.x)*(this.shapes[a].points[1].x-b.x)+(this.shapes[a].points[1].y-
b.y)*(this.shapes[a].points[1].y-b.y)):(c=(this.shapes[a].points[0].x-this.shapes[a].points[2].x)*(this.shapes[a].points[0].x-this.shapes[a].points[2].x)+(this.shapes[a].points[0].y-this.shapes[a].points[2].y)*(this.shapes[a].points[0].y-this.shapes[a].points[2].y),c=Math.sqrt(c),d=(this.shapes[a].points[1].x-this.shapes[a].points[2].x)*(this.shapes[a].points[1].x-this.shapes[a].points[2].x)+(this.shapes[a].points[1].y-this.shapes[a].points[2].y)*(this.shapes[a].points[1].y-this.shapes[a].points[2].y)),
d=Math.sqrt(d),e=(this.shapes[a].points[0].x-this.shapes[a].points[1].x)*(this.shapes[a].points[0].x-this.shapes[a].points[1].x)+(this.shapes[a].points[0].y-this.shapes[a].points[1].y)*(this.shapes[a].points[0].y-this.shapes[a].points[1].y),e=Math.sqrt(e),c=Math.acos((e*e+d*d-c*c)/(2*e*d)),this.shapes[a].calcule=180/Math.PI*c,$("#"+this.layer.layerId).append('<h5><span style="z-index: 200; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+
(this.shapes[a].points[1].y+5)+"px; left: "+(this.shapes[a].points[1].x+5)+'px;">'+this.shapes[a].calcule.toFixed(0)+"[\u00b0]</span></h5>"));else if("area"===this.shapes[a].type&&this.shapes[a].points[0].x===this.shapes[a].points[this.shapes[a].points.length-1].x&&this.shapes[a].points[0].y===this.shapes[a].points[this.shapes[a].points.length-1].y&&1<this.shapes[a].points.length){c=0;for(d=1;d<this.shapes[a].points.length;d++)e=math.matrix([[this.shapes[a].points[d-1].x*(null!==this.layer.make.load.series[this.layer.serieIdCharged].pixelSpacing?
this.layer.make.load.series[this.layer.serieIdCharged].pixelSpacing:1)/this.layer.scale,this.shapes[a].points[d].x*(null!==this.layer.make.load.series[this.layer.serieIdCharged].pixelSpacing?this.layer.make.load.series[this.layer.serieIdCharged].pixelSpacing:1)/this.layer.scale],[this.shapes[a].points[d-1].y*(null!==this.layer.make.load.series[this.layer.serieIdCharged].pixelSpacing?this.layer.make.load.series[this.layer.serieIdCharged].pixelSpacing:1)/this.layer.scale,this.shapes[a].points[d].y*
(null!==this.layer.make.load.series[this.layer.serieIdCharged].pixelSpacing?this.layer.make.load.series[this.layer.serieIdCharged].pixelSpacing:1)/this.layer.scale]]),e=math.det(e),c+=e;this.shapes[a].calcule=.5*Math.abs(c);$("#"+this.layer.layerId).append('<h5><span style="z-index: 200; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(this.shapes[a].points[0].y+5)+"px; left: "+(this.shapes[a].points[0].x+5)+'px;">'+this.shapes[a].calcule.toFixed(0)+
""+(null!==this.layer.make.load.series[this.layer.serieIdCharged].pixelSpacing?"[mm&sup2;]":"[px&sup2;]")+"</span></h5>")}};/*
   2015 Toth Limitada
 @license     {@link http://www.toth.cl}
*/
MIRROR.hounsfield.Point=function(a,b,c){this.parentShape=b;this.circle=new PIXI.Graphics;this.circle.beginFill(13993234);this.circle.drawCircle(0,0,3);this.circle.endFill();this.circle.x=a.stage.x;this.circle.y=a.stage.y;this.child={x:a.child.x,y:a.child.y};c.layer.stage.addChild(this.circle);this.isNear=function(a){return a.stage.x>=this.circle.x-15&&a.stage.x<=this.circle.x+15&&a.stage.y>=this.circle.y-15&&a.stage.y<=this.circle.y+15};this.isNearOfPoint=function(a){return a.circle.x>=this.circle.x-
15&&a.circle.x<=this.circle.x+15&&a.circle.y>=this.circle.y-15&&a.circle.y<=this.circle.y+15};this.moveTo=function(a){this.circle.x=a.stage.x;this.circle.y=a.stage.y;this.child.x=a.child.x;this.child.y=a.child.y;this.parentShape.pointUpdated()};this.destroy=function(){c.layer.stage.removeChild(this.circle);var a=this.parentShape.points.indexOf(this);this.parentShape.points.splice(a,1)}};
MIRROR.hounsfield.ShapePoint=function(a,b){this.shapeType="ShapePoint";this.$label=null;this.done=!0;this.points=[new MIRROR.hounsfield.Point(a,this,b)];this.graphics=new PIXI.Graphics;b.layer.stage.addChild(this.graphics);this.destroy=function(){this.removeLabel();for(var a=this.points.length-1;0<=a;a--)this.points[a].destroy();b.layer.stage.removeChild(this.graphics);a=b.shapes.indexOf(this);b.shapes.splice(a,1)};this.__closeShape=function(){this.done=!0;this.pointUpdated()};this.closeOrDelete=
function(){};this.pointUpdated=function(){this.removeLabel()};this.releaseOnPosition=function(){};this.fetchHounsfield=function(){this.removeLabel();var a=b.layer.make.load.series[b.layer.serieIdCharged].dimensions[0].columns,d=b.layer.make.load.series[b.layer.serieIdCharged].dimensions[0].rows,e=this.points[0].child.x,g=this.points[0].child.y;if(!(0>e||e>=a||0>g||g>=d)){var a=a*g+e,a=[[a,a]],f=this.labelBuilder(this.points[0].circle.x+10,this.points[0].circle.y+10);b.getHounsfieldValues(a).done(function(a){a.hounsfield?
f(MIRROR.language.hounsfield.hu+": "+a.hounsfield.avg):f(MIRROR.language.hounsfield.intensity+": "+a.intensity.avg)}).fail(function(a,b){f("");console.log("Error: "+a);b.retry()})}};this.labelBuilder=function(a,d){function e(){setTimeout(function(){h||(g.html(f+="."),e())},500)}this.removeLabel();this.$label=$('<h5><span style="z-index: 200; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid #505050; position: absolute; top: '+d+"px; left: "+a+'px;"></span></h5>');
var g=$("span",this.$label);$("#"+b.layer.layerId).append(this.$label);var f="..";g.html(f);e();var h=!1;return function(a){h=!0;g.html(a)}};this.removeLabel=function(){this.$label&&(this.$label.detach(),this.$label=null)}};
MIRROR.hounsfield.ShapeEllipse=function(a,b){MIRROR.hounsfield.ShapePoint.call(this,a,b);this.shapeType="ShapeEllipse";this.points.push(new MIRROR.hounsfield.Point(a,this,b));this.pointUpdated=function(){this.removeLabel();var a=this.points[0],b=this.points[1],e=a.circle.x-b.circle.x,b=a.circle.y-b.circle.y;this.graphics.clear();this.graphics.lineStyle(2,13993234,1);this.graphics.beginFill(13993234,.3);this.graphics.drawEllipse(0,0,e,b);this.graphics.endFill();this.graphics.x=a.circle.x;this.graphics.y=
a.circle.y};this.releaseOnPosition=function(){var a=this.points[1];if(this.points[0].isNearOfPoint(a)){var d=b.layer.scale;a.moveTo({stage:{x:a.circle.x+15,y:a.circle.y+15},child:{x:a.child.x+15/d,y:a.child.y+15/d}});this.pointUpdated()}};this.moveShapeTo=function(a){var b=this.points[0],e=this.points[1];e.moveTo({stage:{x:e.circle.x+(a.stage.x-b.circle.x),y:e.circle.y+(a.stage.y-b.circle.y)},child:{x:e.child.x+(a.child.x-b.child.x),y:e.child.y+(a.child.y-b.child.y)}});b.moveTo(a)};this.fetchHounsfield=
function(){for(var a=b.layer.make.load.series[b.layer.serieIdCharged].dimensions[0].columns,d=b.layer.make.load.series[b.layer.serieIdCharged].dimensions[0].rows,e=b.layer.rotation,g=this.points[0].child,f=this.points[1].child,f=this.__rotatePoint(f.x,f.y,g.x,g.y,e),h=Math.abs(f.x-g.x),k=Math.abs(f.y-g.y),f=g.x,n=g.y+k,l=this.__rotatePoint(g.x+h,g.y,g.x,g.y,-e),n=this.__rotatePoint(f,n,g.x,g.y,-e),f=Math.max(Math.abs(g.x-l.x),Math.abs(g.x-n.x)),n=Math.max(Math.abs(g.y-l.y),Math.abs(g.y-n.y)),l=[],
d=this.__ellipseChecker(g,h,k,a,d,e),e=Math.floor(g.y-n);e<=g.y+n;e++){for(var k=h=-1,m=Math.floor(g.x-f);m<=g.x+f;m++)d(m,e)&&(k=a*e+m,h=-1===h?k:h);-1!==h&&-1!==k&&(m=l[l.length-1],(!m||m[0]!==h&&m[1]!==k)&&l.push([h,k]))}if(0!==l.length){var a=this.points[0].circle.x+Math.abs(this.points[0].circle.x-this.points[1].circle.x)+5,p=this.labelBuilder(a,this.points[0].circle.y+10);b.getHounsfieldValues(l).done(function(a){a.hounsfield?p(MIRROR.language.hounsfield.HUavg+": "+a.hounsfield.avg+"<br>"+MIRROR.language.hounsfield.HUmin+
": "+a.hounsfield.min+"<br>"+MIRROR.language.hounsfield.HUmax+": "+a.hounsfield.max):p(MIRROR.language.hounsfield.Iavg+": "+a.intensity.avg+"<br>"+MIRROR.language.hounsfield.Imin+": "+a.intensity.min+"<br>"+MIRROR.language.hounsfield.Imax+": "+a.intensity.max)}).fail(function(a){p("");console.log("Error: "+a);xhr.retry()})}};this.__ellipseChecker=function(a,b,e,g,f,h){var k=b*b,n=e*e,l=Math.cos(-h),m=Math.sin(-h);return function(b,d){if(0<=b&&b<g&&0<=d&&d<f){var e=l*(b-a.x)+m*(d-a.y),h=m*(b-a.x)-
l*(d-a.y);return 1>=e*e/k+h*h/n}return!1}};this.__rotatePoint=function(a,b,e,g,f){return{x:Math.cos(f)*(a-e)-Math.sin(f)*(b-g)+e,y:Math.sin(f)*(a-e)+Math.cos(f)*(b-g)+g}}};MIRROR.hounsfield.ShapeEllipse.prototype=Object.create(MIRROR.hounsfield.ShapePoint.prototype);
MIRROR.hounsfield.ShapePolygon=function(a,b){MIRROR.hounsfield.ShapePoint.call(this,a,b);this.shapeType="ShapePolygon";this.done=!1;this.addPoint=function(a){a=new MIRROR.hounsfield.Point(a,this,b);this.points.push(a);this.pointUpdated();return a};this.closeOrDelete=function(){this.__isValidPolygon()?this.done||(this.__closeShape(),this.fetchHounsfield()):this.destroy()};this.pointUpdated=function(){this.removeLabel();b.layer.stage.removeChild(this.graphics);this.graphics=new PIXI.Graphics;this.graphics.clear();
this.graphics.beginFill(13993234,.3);for(var a=[],d=0;d<this.points.length;d++)a.push(this.points[d].circle.x),a.push(this.points[d].circle.y);this.graphics.drawPolygon(a);this.graphics.endFill();this.graphics.lineStyle(2,13993234,1);this.graphics.moveTo(this.points[0].circle.x,this.points[0].circle.y);for(d=1;d<this.points.length;d++)this.graphics.lineTo(this.points[d].circle.x,this.points[d].circle.y);this.done&&this.graphics.lineTo(this.points[0].circle.x,this.points[0].circle.y);b.layer.stage.addChild(this.graphics)};
this.__closeShape=function(){this.__isValidPolygon()&&(this.done=!0,this.pointUpdated())};this.__isValidPolygon=function(){return 3<=this.points.length};this.releaseOnPosition=function(a){a=this.points.indexOf(a);-1!==a&&0!==a&&(a=this.points[this.points.length-1],this.points[0].isNearOfPoint(a)&&(a.destroy(),this.__isValidPolygon()&&this.__closeShape(),this.pointUpdated()))};this.fetchHounsfield=function(){this.removeLabel();var a=b.layer.make.load.series[b.layer.serieIdCharged].dimensions[0].columns,
d=b.layer.make.load.series[b.layer.serieIdCharged].dimensions[0].rows,e=9999999999,g=0,f=9999999999,h=0,k=[];this.points.forEach(function(a){var b=a.child.x,c=a.child.y;e=b<e?b:e;f=c<f?c:f;g=b>g?b:g;h=c>h?c:h;k.push(a.child.x,a.child.y)});for(var n=new PIXI.Polygon(k),l=[],m=f;m<=h;m++){for(var p=-1,r=-1,q=e;q<=g;q++)0<=q&&0<=m&&q<a&&m<d&&n.contains(q,m)&&(r=a*m+q,p=-1===p?r:p);-1!==p&&-1!==r&&(q=l[l.length-1],(!q||q[0]!==p&&q[1]!==r)&&l.push([p,r]))}if(0!==l.length){var t=this.labelBuilder(this.points[0].circle.x+
10,this.points[0].circle.y+10);b.getHounsfieldValues(l).done(function(a){a.hounsfield?t(MIRROR.language.hounsfield.HUavg+": "+a.hounsfield.avg+"<br>"+MIRROR.language.hounsfield.HUmin+": "+a.hounsfield.min+"<br>"+MIRROR.language.hounsfield.HUmax+": "+a.hounsfield.max+"<br>"):t(MIRROR.language.hounsfield.Iavg+": "+a.intensity.avg+"<br>"+MIRROR.language.hounsfield.Imin+": "+a.intensity.min+"<br>"+MIRROR.language.hounsfield.Imax+": "+a.intensity.max)}).fail(function(a){t("");console.log("Error: "+a);
xhr.retry()})}}};MIRROR.hounsfield.ShapePolygon.prototype=Object.create(MIRROR.hounsfield.ShapePoint.prototype);MIRROR.hounsfield.prototype.initialize=function(){this.selectedTool=this.TOOL.NONE;this.shapes=[];this.selectedPoint=this.currentShape=null};MIRROR.hounsfield.prototype.clear=function(){this.unselectTool();for(var a=this.shapes.length-1;0<=a;a--)this.shapes[a].destroy();this.selectedPoint=this.currentShape=null};
MIRROR.hounsfield.prototype.getHounsfieldValues=function(a){var b=this.layer.make.load.series[this.layer.serieIdCharged],c=b.dicomsPath[this.layer.positionInSerie],b=b.imagesFrame[this.layer.positionInSerie],d=$.Deferred();$.ajax({url:"../services/extractIntensity.py",type:"post",datatype:"json",data:{path:c,frame:b,rowsArray:JSON.stringify(a)}}).done(function(a){d.resolve(a)}).fail(function(b){console.error("Unable to get the dicom information of: ",a);d.reject(b)});return d.promise()};
MIRROR.hounsfield.prototype.selectPointTool=function(){this.__selectTool(this.TOOL.POINT)};MIRROR.hounsfield.prototype.isPointToolSelected=function(){return this.selectedTool===this.TOOL.POINT};MIRROR.hounsfield.prototype.selectElipseTool=function(){this.__selectTool(this.TOOL.ELIPSE)};MIRROR.hounsfield.prototype.isElipseToolSelected=function(){return this.selectedTool===this.TOOL.ELIPSE};MIRROR.hounsfield.prototype.selectPolygonTool=function(){this.__selectTool(this.TOOL.POLYGON)};
MIRROR.hounsfield.prototype.isPolygonToolSelected=function(){return this.selectedTool===this.TOOL.POLYGON};MIRROR.hounsfield.prototype.isSomeToolSelected=function(){return this.selectedTool!==this.TOOL.NONE};MIRROR.hounsfield.prototype.__selectTool=function(a){if(this.selectedTool!==a){for(var b=this.shapes.length-1;0<=b;b--)this.shapes[b].closeOrDelete();this.selectedTool=a}};MIRROR.hounsfield.prototype.unselectTool=function(){this.selectedTool=this.TOOL.NONE};
MIRROR.hounsfield.prototype.parseMouseData=function(a){var b=a.data.getLocalPosition(this.layer.textureSprite);a=a.data.getLocalPosition(this.layer.stage);return{stage:{x:Math.floor(a.x),y:Math.floor(a.y)},child:{x:Math.floor(b.x),y:Math.floor(b.y)}}};
MIRROR.hounsfield.prototype.__pressAction=function(a){a=this.parseMouseData(a);this.currentShape=(this.selectedPoint=this.__findPoint(a))?this.selectedPoint.parentShape:this.shapes[this.shapes.length-1];if(this.isPointToolSelected())this.selectedPoint||(this.currentShape=new MIRROR.hounsfield.ShapePoint(a,this),this.shapes.push(this.currentShape),this.selectedPoint=this.currentShape.points[0]),this.layer.stage.on("mousemove",this.__moveAction.bind(this)),this.layer.stage.on("touchmove",this.__moveAction.bind(this));
else if(this.isElipseToolSelected())this.selectedPoint||(this.currentShape=new MIRROR.hounsfield.ShapeEllipse(a,this),this.shapes.push(this.currentShape),this.selectedPoint=this.currentShape.points[1]),this.layer.stage.on("mousemove",this.__moveAction.bind(this)),this.layer.stage.on("touchmove",this.__moveAction.bind(this));else if(this.isPolygonToolSelected()){if(this.selectedPoint)this.selectedPoint.child===this.currentShape.points[0].child&&this.currentShape.__closeShape();else{if(!this.currentShape||
this.currentShape.done)this.currentShape=new MIRROR.hounsfield.ShapePolygon(a,this),this.shapes.push(this.currentShape);this.selectedPoint=this.currentShape.addPoint(a)}this.layer.stage.on("mousemove",this.__moveAction.bind(this));this.layer.stage.on("touchmove",this.__moveAction.bind(this))}};
MIRROR.hounsfield.prototype.__moveAction=function(a){a=this.parseMouseData(a);"ShapeEllipse"===this.selectedPoint.parentShape.shapeType&&this.currentShape.points[0]===this.selectedPoint?this.selectedPoint.parentShape.moveShapeTo(a):this.selectedPoint.moveTo(a)};
MIRROR.hounsfield.prototype.__releaseAction=function(a){this.parseMouseData(a);this.layer.stage.off("mousemove");this.layer.stage.off("touchmove");this.currentShape&&(this.currentShape.releaseOnPosition(this.selectedPoint),this.currentShape.done&&this.currentShape.fetchHounsfield())};MIRROR.hounsfield.prototype.__findPoint=function(a){for(var b=0;b<this.shapes.length;b++)for(var c=this.shapes[b],d=0;d<c.points.length;d++){var e=c.points[d];if(e.isNear(a))return e}return null};